/*! For license information please see main.js.LICENSE.txt */
(()=>{var t={125:t=>{t.exports=function t(e,n,i){function o(s,a){if(!n[s]){if(!e[s]){if(r)return r(s,!0);throw new Error("Cannot find module '"+s+"'")}var l=n[s]={exports:{}};e[s][0].call(l.exports,(function(t){return o(e[s][1][t]||t)}),l,l.exports,t,e,n,i)}return n[s].exports}for(var r=void 0,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(t,e,n){e.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(t,e,n){e.exports={version:t("../package.json").version,AABB:t("./collision/AABB"),ArrayCollisionMatrix:t("./collision/ArrayCollisionMatrix"),Body:t("./objects/Body"),Box:t("./shapes/Box"),Broadphase:t("./collision/Broadphase"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),Narrowphase:t("./world/Narrowphase"),ConeTwistConstraint:t("./constraints/ConeTwistConstraint"),ContactMaterial:t("./material/ContactMaterial"),ConvexPolyhedron:t("./shapes/ConvexPolyhedron"),Cylinder:t("./shapes/Cylinder"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventTarget:t("./utils/EventTarget"),FrictionEquation:t("./equations/FrictionEquation"),GSSolver:t("./solver/GSSolver"),GridBroadphase:t("./collision/GridBroadphase"),Heightfield:t("./shapes/Heightfield"),HingeConstraint:t("./constraints/HingeConstraint"),LockConstraint:t("./constraints/LockConstraint"),Mat3:t("./math/Mat3"),Material:t("./material/Material"),NaiveBroadphase:t("./collision/NaiveBroadphase"),ObjectCollisionMatrix:t("./collision/ObjectCollisionMatrix"),Pool:t("./utils/Pool"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),PointToPointConstraint:t("./constraints/PointToPointConstraint"),Quaternion:t("./math/Quaternion"),Ray:t("./collision/Ray"),RaycastVehicle:t("./objects/RaycastVehicle"),RaycastResult:t("./collision/RaycastResult"),RigidVehicle:t("./objects/RigidVehicle"),RotationalEquation:t("./equations/RotationalEquation"),RotationalMotorEquation:t("./equations/RotationalMotorEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),SPHSystem:t("./objects/SPHSystem"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Sphere:t("./shapes/Sphere"),SplitSolver:t("./solver/SplitSolver"),Spring:t("./objects/Spring"),Trimesh:t("./shapes/Trimesh"),Vec3:t("./math/Vec3"),Vec3Pool:t("./utils/Vec3Pool"),World:t("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(t,e,n){var i=t("../math/Vec3");function o(t){t=t||{},this.lowerBound=new i,t.lowerBound&&this.lowerBound.copy(t.lowerBound),this.upperBound=new i,t.upperBound&&this.upperBound.copy(t.upperBound)}t("../utils/Utils"),e.exports=o;var r=new i;o.prototype.setFromPoints=function(t,e,n,i){var o=this.lowerBound,s=this.upperBound,a=n;o.copy(t[0]),a&&a.vmult(o,o),s.copy(o);for(var l=1;l<t.length;l++){var c=t[l];a&&(a.vmult(c,r),c=r),c.x>s.x&&(s.x=c.x),c.x<o.x&&(o.x=c.x),c.y>s.y&&(s.y=c.y),c.y<o.y&&(o.y=c.y),c.z>s.z&&(s.z=c.z),c.z<o.z&&(o.z=c.z)}return e&&(e.vadd(o,o),e.vadd(s,s)),i&&(o.x-=i,o.y-=i,o.z-=i,s.x+=i,s.y+=i,s.z+=i),this},o.prototype.copy=function(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this},o.prototype.clone=function(){return(new o).copy(this)},o.prototype.extend=function(t){var e=t.lowerBound.x;this.lowerBound.x>e&&(this.lowerBound.x=e);var n=t.upperBound.x;this.upperBound.x<n&&(this.upperBound.x=n),e=t.lowerBound.y,this.lowerBound.y>e&&(this.lowerBound.y=e),n=t.upperBound.y,this.upperBound.y<n&&(this.upperBound.y=n),e=t.lowerBound.z,this.lowerBound.z>e&&(this.lowerBound.z=e),n=t.upperBound.z,this.upperBound.z<n&&(this.upperBound.z=n)},o.prototype.overlaps=function(t){var e=this.lowerBound,n=this.upperBound,i=t.lowerBound,o=t.upperBound;return(i.x<=n.x&&n.x<=o.x||e.x<=o.x&&o.x<=n.x)&&(i.y<=n.y&&n.y<=o.y||e.y<=o.y&&o.y<=n.y)&&(i.z<=n.z&&n.z<=o.z||e.z<=o.z&&o.z<=n.z)},o.prototype.contains=function(t){var e=this.lowerBound,n=this.upperBound,i=t.lowerBound,o=t.upperBound;return e.x<=i.x&&n.x>=o.x&&e.y<=i.y&&n.y>=o.y&&e.z<=i.z&&n.z>=o.z},o.prototype.getCorners=function(t,e,n,i,o,r,s,a){var l=this.lowerBound,c=this.upperBound;t.copy(l),e.set(c.x,l.y,l.z),n.set(c.x,c.y,l.z),i.set(l.x,c.y,c.z),o.set(c.x,l.y,l.z),r.set(l.x,c.y,l.z),s.set(l.x,l.y,c.z),a.copy(c)};var s=[new i,new i,new i,new i,new i,new i,new i,new i];o.prototype.toLocalFrame=function(t,e){var n=s,i=n[0],o=n[1],r=n[2],a=n[3],l=n[4],c=n[5],p=n[6],h=n[7];this.getCorners(i,o,r,a,l,c,p,h);for(var u=0;8!==u;u++){var d=n[u];t.pointToLocal(d,d)}return e.setFromPoints(n)},o.prototype.toWorldFrame=function(t,e){var n=s,i=n[0],o=n[1],r=n[2],a=n[3],l=n[4],c=n[5],p=n[6],h=n[7];this.getCorners(i,o,r,a,l,c,p,h);for(var u=0;8!==u;u++){var d=n[u];t.pointToWorld(d,d)}return e.setFromPoints(n)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(t,e,n){function i(){this.matrix=[]}e.exports=i,i.prototype.get=function(t,e){if(t=t.index,(e=e.index)>t){var n=e;e=t,t=n}return this.matrix[(t*(t+1)>>1)+e-1]},i.prototype.set=function(t,e,n){if(t=t.index,(e=e.index)>t){var i=e;e=t,t=i}this.matrix[(t*(t+1)>>1)+e-1]=n?1:0},i.prototype.reset=function(){for(var t=0,e=this.matrix.length;t!==e;t++)this.matrix[t]=0},i.prototype.setNumObjects=function(t){this.matrix.length=t*(t-1)>>1}},{}],5:[function(t,e,n){var i=t("../objects/Body"),o=t("../math/Vec3"),r=t("../math/Quaternion");function s(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}t("../shapes/Shape"),t("../shapes/Plane"),e.exports=s,s.prototype.collisionPairs=function(t,e,n){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var a=i.STATIC|i.KINEMATIC;s.prototype.needBroadphaseCollision=function(t,e){return 0!=(t.collisionFilterGroup&e.collisionFilterMask)&&0!=(e.collisionFilterGroup&t.collisionFilterMask)&&(0==(t.type&a)&&t.sleepState!==i.SLEEPING||0==(e.type&a)&&e.sleepState!==i.SLEEPING)},s.prototype.intersectionTest=function(t,e,n,i){this.useBoundingBoxes?this.doBoundingBoxBroadphase(t,e,n,i):this.doBoundingSphereBroadphase(t,e,n,i)};var l=new o;new o,new r,new o,s.prototype.doBoundingSphereBroadphase=function(t,e,n,i){var o=l;e.position.vsub(t.position,o);var r=Math.pow(t.boundingRadius+e.boundingRadius,2);o.norm2()<r&&(n.push(t),i.push(e))},s.prototype.doBoundingBoxBroadphase=function(t,e,n,i){t.aabbNeedsUpdate&&t.computeAABB(),e.aabbNeedsUpdate&&e.computeAABB(),t.aabb.overlaps(e.aabb)&&(n.push(t),i.push(e))};var c={keys:[]},p=[],h=[];s.prototype.makePairsUnique=function(t,e){for(var n=c,i=p,o=h,r=t.length,s=0;s!==r;s++)i[s]=t[s],o[s]=e[s];for(t.length=0,e.length=0,s=0;s!==r;s++){var a=i[s].id,l=o[s].id;n[u=a<l?a+","+l:l+","+a]=s,n.keys.push(u)}for(s=0;s!==n.keys.length;s++){var u=n.keys.pop(),d=n[u];t.push(i[d]),e.push(o[d]),delete n[u]}},s.prototype.setWorld=function(t){};var u=new o;s.boundingSphereCheck=function(t,e){var n=u;return t.position.vsub(e.position,n),Math.pow(t.shape.boundingSphereRadius+e.shape.boundingSphereRadius,2)>n.norm2()},s.prototype.aabbQuery=function(t,e,n){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(t,e,n){e.exports=s;var i=t("./Broadphase"),o=t("../math/Vec3"),r=t("../shapes/Shape");function s(t,e,n,r,s){i.apply(this),this.nx=n||10,this.ny=r||10,this.nz=s||10,this.aabbMin=t||new o(100,100,100),this.aabbMax=e||new o(-100,-100,-100);var a=this.nx*this.ny*this.nz;if(a<=0)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=a,this.binLengths.length=a;for(var l=0;l<a;l++)this.bins[l]=[],this.binLengths[l]=0}s.prototype=new i,s.prototype.constructor=s;var a=new o;new o,s.prototype.collisionPairs=function(t,e,n){for(var i=t.numObjects(),o=t.bodies,s=this.aabbMax,l=this.aabbMin,c=this.nx,p=this.ny,h=this.nz,u=p*h,d=h,v=s.x,m=s.y,g=s.z,f=l.x,x=l.y,b=l.z,w=c/(v-f),y=p/(m-x),_=h/(g-b),P=(v-f)/c,C=(m-x)/p,z=(g-b)/h,E=.5*Math.sqrt(P*P+C*C+z*z),S=r.types,A=S.SPHERE,M=S.PLANE,L=(S.BOX,S.COMPOUND,S.CONVEXPOLYHEDRON,this.bins),k=this.binLengths,V=this.bins.length,B=0;B!==V;B++)k[B]=0;var R=Math.ceil;function T(t,e,n,i,o,r,s){var a=(t-f)*w|0,l=(e-x)*y|0,v=(n-b)*_|0,m=R((i-f)*w),g=R((o-x)*y),P=R((r-b)*_);a<0?a=0:a>=c&&(a=c-1),l<0?l=0:l>=p&&(l=p-1),v<0?v=0:v>=h&&(v=h-1),m<0?m=0:m>=c&&(m=c-1),g<0?g=0:g>=p&&(g=p-1),P<0?P=0:P>=h&&(P=h-1),l*=d,v*=1,m*=u,g*=d,P*=1;for(var C=a*=u;C<=m;C+=u)for(var z=l;z<=g;z+=d)for(var E=v;E<=P;E+=1){var S=C+z+E;L[S][k[S]++]=s}}for(l=Math.min,s=Math.max,B=0;B!==i;B++){var I=(et=o[B]).shape;switch(I.type){case A:var F=et.position.x,q=et.position.y,N=et.position.z,j=I.radius;T(F-j,q-j,N-j,F+j,q+j,N+j,et);break;case M:I.worldNormalNeedsUpdate&&I.computeWorldNormal(et.quaternion);var D=I.worldNormal,O=f+.5*P-et.position.x,U=x+.5*C-et.position.y,W=b+.5*z-et.position.z,G=a;G.set(O,U,W);for(var H=0,K=0;H!==c;H++,K+=u,G.y=U,G.x+=P)for(var Y=0,X=0;Y!==p;Y++,X+=d,G.z=W,G.y+=C)for(var Z=0,$=0;Z!==h;Z++,$+=1,G.z+=z)if(G.dot(D)<E){var Q=K+X+$;L[Q][k[Q]++]=et}break;default:et.aabbNeedsUpdate&&et.computeAABB(),T(et.aabb.lowerBound.x,et.aabb.lowerBound.y,et.aabb.lowerBound.z,et.aabb.upperBound.x,et.aabb.upperBound.y,et.aabb.upperBound.z,et)}}for(B=0;B!==V;B++){var J=k[B];if(J>1){var tt=L[B];for(H=0;H!==J;H++){var et=tt[H];for(Y=0;Y!==H;Y++){var nt=tt[Y];this.needBroadphaseCollision(et,nt)&&this.intersectionTest(et,nt,e,n)}}}}this.makePairsUnique(e,n)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(t,e,n){e.exports=r;var i=t("./Broadphase"),o=t("./AABB");function r(){i.apply(this)}r.prototype=new i,r.prototype.constructor=r,r.prototype.collisionPairs=function(t,e,n){var i,o,r,s,a=t.bodies,l=a.length;for(i=0;i!==l;i++)for(o=0;o!==i;o++)r=a[i],s=a[o],this.needBroadphaseCollision(r,s)&&this.intersectionTest(r,s,e,n)},new o,r.prototype.aabbQuery=function(t,e,n){n=n||[];for(var i=0;i<t.bodies.length;i++){var o=t.bodies[i];o.aabbNeedsUpdate&&o.computeAABB(),o.aabb.overlaps(e)&&n.push(o)}return n}},{"./AABB":3,"./Broadphase":5}],8:[function(t,e,n){function i(){this.matrix={}}e.exports=i,i.prototype.get=function(t,e){if(t=t.id,(e=e.id)>t){var n=e;e=t,t=n}return t+"-"+e in this.matrix},i.prototype.set=function(t,e,n){if(t=t.id,(e=e.id)>t){var i=e;e=t,t=i}n?this.matrix[t+"-"+e]=!0:delete this.matrix[t+"-"+e]},i.prototype.reset=function(){this.matrix={}},i.prototype.setNumObjects=function(t){}},{}],9:[function(t,e,n){e.exports=c;var i=t("../math/Vec3"),o=t("../math/Quaternion"),r=t("../math/Transform"),s=(t("../shapes/ConvexPolyhedron"),t("../shapes/Box"),t("../collision/RaycastResult")),a=t("../shapes/Shape"),l=t("../collision/AABB");function c(t,e){this.from=t?t.clone():new i,this.to=e?e.clone():new i,this._direction=new i,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=c.ANY,this.result=new s,this.hasHit=!1,this.callback=function(t){}}c.prototype.constructor=c,c.CLOSEST=1,c.ANY=2,c.ALL=4;var p=new l,h=[];c.prototype.intersectWorld=function(t,e){return this.mode=e.mode||c.ANY,this.result=e.result||new s,this.skipBackfaces=!!e.skipBackfaces,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:-1,e.from&&this.from.copy(e.from),e.to&&this.to.copy(e.to),this.callback=e.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(p),h.length=0,t.broadphase.aabbQuery(t,p,h),this.intersectBodies(h),this.hasHit};var u=new i,d=new i;function v(t,e,n,i){i.vsub(e,R),n.vsub(e,u),t.vsub(e,d);var o,r,s=R.dot(R),a=R.dot(u),l=R.dot(d),c=u.dot(u),p=u.dot(d);return(o=c*l-a*p)>=0&&(r=s*p-a*l)>=0&&o+r<s*c-a*a}c.pointInTriangle=v;var m=new i,g=new o;c.prototype.intersectBody=function(t,e){e&&(this.result=e,this._updateDirection());var n=this.checkCollisionResponse;if((!n||t.collisionResponse)&&0!=(this.collisionFilterGroup&t.collisionFilterMask)&&0!=(t.collisionFilterGroup&this.collisionFilterMask))for(var i=m,o=g,r=0,s=t.shapes.length;r<s;r++){var a=t.shapes[r];if((!n||a.collisionResponse)&&(t.quaternion.mult(t.shapeOrientations[r],o),t.quaternion.vmult(t.shapeOffsets[r],i),i.vadd(t.position,i),this.intersectShape(a,o,i,t),this.result._shouldStop))break}},c.prototype.intersectBodies=function(t,e){e&&(this.result=e,this._updateDirection());for(var n=0,i=t.length;!this.result._shouldStop&&n<i;n++)this.intersectBody(t[n])},c.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},c.prototype.intersectShape=function(t,e,n,i){if(!(function(t,e,n){n.vsub(t,R);var i=R.dot(e);return e.mult(i,T),T.vadd(t,T),n.distanceTo(T)}(this.from,this._direction,n)>t.boundingSphereRadius)){var o=this[t.type];o&&o.call(this,t,e,n,i)}},new i,new i;var f=new i,x=new i,b=new i,w=new i;new i,new s,c.prototype.intersectBox=function(t,e,n,i){return this.intersectConvex(t.convexPolyhedronRepresentation,e,n,i)},c.prototype[a.types.BOX]=c.prototype.intersectBox,c.prototype.intersectPlane=function(t,e,n,o){var r=this.from,s=this.to,a=this._direction,l=new i(0,0,1);e.vmult(l,l);var c=new i;r.vsub(n,c);var p=c.dot(l);if(s.vsub(n,c),!(p*c.dot(l)>0||r.distanceTo(s)<p)){var h=l.dot(a);if(!(Math.abs(h)<this.precision)){var u=new i,d=new i,v=new i;r.vsub(n,u);var m=-l.dot(u)/h;a.scale(m,d),r.vadd(d,v),this.reportIntersection(l,v,t,o,-1)}}},c.prototype[a.types.PLANE]=c.prototype.intersectPlane,c.prototype.getAABB=function(t){var e=this.to,n=this.from;t.lowerBound.x=Math.min(e.x,n.x),t.lowerBound.y=Math.min(e.y,n.y),t.lowerBound.z=Math.min(e.z,n.z),t.upperBound.x=Math.max(e.x,n.x),t.upperBound.y=Math.max(e.y,n.y),t.upperBound.z=Math.max(e.z,n.z)};var y={faceList:[0]};c.prototype.intersectHeightfield=function(t,e,n,o){t.data,t.elementSize;var s=new i,a=new c(this.from,this.to);r.pointToLocalFrame(n,e,a.from,a.from),r.pointToLocalFrame(n,e,a.to,a.to);var l=[],p=null,h=null,u=null,d=null,v=t.getIndexOfPosition(a.from.x,a.from.y,l,!1);if(v&&(p=l[0],h=l[1],u=l[0],d=l[1]),(v=t.getIndexOfPosition(a.to.x,a.to.y,l,!1))&&((null===p||l[0]<p)&&(p=l[0]),(null===u||l[0]>u)&&(u=l[0]),(null===h||l[1]<h)&&(h=l[1]),(null===d||l[1]>d)&&(d=l[1])),null!==p){var m=[];t.getRectMinMax(p,h,u,d,m);for(var g=p;g<=u;g++)for(var f=h;f<=d;f++){if(this.result._shouldStop)return;if(t.getConvexTrianglePillar(g,f,!1),r.pointToWorldFrame(n,e,t.pillarOffset,s),this.intersectConvex(t.pillarConvex,e,s,o,y),this.result._shouldStop)return;t.getConvexTrianglePillar(g,f,!0),r.pointToWorldFrame(n,e,t.pillarOffset,s),this.intersectConvex(t.pillarConvex,e,s,o,y)}}},c.prototype[a.types.HEIGHTFIELD]=c.prototype.intersectHeightfield;var _=new i,P=new i;c.prototype.intersectSphere=function(t,e,n,i){var o=this.from,r=this.to,s=t.radius,a=Math.pow(r.x-o.x,2)+Math.pow(r.y-o.y,2)+Math.pow(r.z-o.z,2),l=2*((r.x-o.x)*(o.x-n.x)+(r.y-o.y)*(o.y-n.y)+(r.z-o.z)*(o.z-n.z)),c=Math.pow(o.x-n.x,2)+Math.pow(o.y-n.y,2)+Math.pow(o.z-n.z,2)-Math.pow(s,2),p=Math.pow(l,2)-4*a*c,h=_,u=P;if(!(p<0))if(0===p)o.lerp(r,p,h),h.vsub(n,u),u.normalize(),this.reportIntersection(u,h,t,i,-1);else{var d=(-l-Math.sqrt(p))/(2*a),v=(-l+Math.sqrt(p))/(2*a);if(d>=0&&d<=1&&(o.lerp(r,d,h),h.vsub(n,u),u.normalize(),this.reportIntersection(u,h,t,i,-1)),this.result._shouldStop)return;v>=0&&v<=1&&(o.lerp(r,v,h),h.vsub(n,u),u.normalize(),this.reportIntersection(u,h,t,i,-1))}},c.prototype[a.types.SPHERE]=c.prototype.intersectSphere;var C=new i,z=(new i,new i,new i);c.prototype.intersectConvex=function(t,e,n,i,o){for(var r=C,s=z,a=o&&o.faceList||null,l=t.faces,c=t.vertices,p=t.faceNormals,h=this._direction,u=this.from,d=this.to,m=u.distanceTo(d),g=a?a.length:l.length,y=this.result,_=0;!y._shouldStop&&_<g;_++){var P=a?a[_]:_,E=l[P],S=p[P],A=e,M=n;s.copy(c[E[0]]),A.vmult(s,s),s.vadd(M,s),s.vsub(u,s),A.vmult(S,r);var L=h.dot(r);if(!(Math.abs(L)<this.precision)){var k=r.dot(s)/L;if(!(k<0)){h.mult(k,f),f.vadd(u,f),x.copy(c[E[0]]),A.vmult(x,x),M.vadd(x,x);for(var V=1;!y._shouldStop&&V<E.length-1;V++){b.copy(c[E[V]]),w.copy(c[E[V+1]]),A.vmult(b,b),A.vmult(w,w),M.vadd(b,b),M.vadd(w,w);var B=f.distanceTo(u);!v(f,x,b,w)&&!v(f,b,x,w)||B>m||this.reportIntersection(r,f,t,i,P)}}}}},c.prototype[a.types.CONVEXPOLYHEDRON]=c.prototype.intersectConvex;var E=new i,S=new i,A=new i,M=new i,L=new i,k=new i,V=(new l,[]),B=new r;c.prototype.intersectTrimesh=function(t,e,n,i,o){var s=E,a=V,l=B,c=z,p=S,h=A,u=M,d=k,m=L,g=(o&&o.faceList,t.indices),y=(t.vertices,t.faceNormals,this.from),_=this.to,P=this._direction;l.position.copy(n),l.quaternion.copy(e),r.vectorToLocalFrame(n,e,P,p),r.pointToLocalFrame(n,e,y,h),r.pointToLocalFrame(n,e,_,u);var C=h.distanceSquared(u);t.tree.rayQuery(this,l,a);for(var R=0,T=a.length;!this.result._shouldStop&&R!==T;R++){var I=a[R];t.getNormal(I,s),t.getVertex(g[3*I],x),x.vsub(h,c);var F=p.dot(s),q=s.dot(c)/F;if(!(q<0)){p.scale(q,f),f.vadd(h,f),t.getVertex(g[3*I+1],b),t.getVertex(g[3*I+2],w);var N=f.distanceSquared(h);!v(f,b,x,w)&&!v(f,x,b,w)||N>C||(r.vectorToWorldFrame(e,s,m),r.pointToWorldFrame(n,e,f,d),this.reportIntersection(m,d,t,i,I))}}a.length=0},c.prototype[a.types.TRIMESH]=c.prototype.intersectTrimesh,c.prototype.reportIntersection=function(t,e,n,i,o){var r=this.from,s=this.to,a=r.distanceTo(e),l=this.result;if(!(this.skipBackfaces&&t.dot(this._direction)>0))switch(l.hitFaceIndex=void 0!==o?o:-1,this.mode){case c.ALL:this.hasHit=!0,l.set(r,s,t,e,n,i,a),l.hasHit=!0,this.callback(l);break;case c.CLOSEST:(a<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(r,s,t,e,n,i,a));break;case c.ANY:this.hasHit=!0,l.hasHit=!0,l.set(r,s,t,e,n,i,a),l._shouldStop=!0}};var R=new i,T=new i},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(t,e,n){var i=t("../math/Vec3");function o(){this.rayFromWorld=new i,this.rayToWorld=new i,this.hitNormalWorld=new i,this.hitPointWorld=new i,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}e.exports=o,o.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},o.prototype.abort=function(){this._shouldStop=!0},o.prototype.set=function(t,e,n,i,o,r,s){this.rayFromWorld.copy(t),this.rayToWorld.copy(e),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=o,this.body=r,this.distance=s}},{"../math/Vec3":30}],11:[function(t,e,n){t("../shapes/Shape");var i=t("../collision/Broadphase");function o(t){i.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var e=this.axisList;this._addBodyHandler=function(t){e.push(t.body)},this._removeBodyHandler=function(t){var n=e.indexOf(t.body);-1!==n&&e.splice(n,1)},t&&this.setWorld(t)}e.exports=o,o.prototype=new i,o.prototype.setWorld=function(t){this.axisList.length=0;for(var e=0;e<t.bodies.length;e++)this.axisList.push(t.bodies[e]);t.removeEventListener("addBody",this._addBodyHandler),t.removeEventListener("removeBody",this._removeBodyHandler),t.addEventListener("addBody",this._addBodyHandler),t.addEventListener("removeBody",this._removeBodyHandler),this.world=t,this.dirty=!0},o.insertionSortX=function(t){for(var e=1,n=t.length;e<n;e++){for(var i=t[e],o=e-1;o>=0&&!(t[o].aabb.lowerBound.x<=i.aabb.lowerBound.x);o--)t[o+1]=t[o];t[o+1]=i}return t},o.insertionSortY=function(t){for(var e=1,n=t.length;e<n;e++){for(var i=t[e],o=e-1;o>=0&&!(t[o].aabb.lowerBound.y<=i.aabb.lowerBound.y);o--)t[o+1]=t[o];t[o+1]=i}return t},o.insertionSortZ=function(t){for(var e=1,n=t.length;e<n;e++){for(var i=t[e],o=e-1;o>=0&&!(t[o].aabb.lowerBound.z<=i.aabb.lowerBound.z);o--)t[o+1]=t[o];t[o+1]=i}return t},o.prototype.collisionPairs=function(t,e,n){var i,r,s=this.axisList,a=s.length,l=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),i=0;i!==a;i++){var c=s[i];for(r=i+1;r<a;r++){var p=s[r];if(this.needBroadphaseCollision(c,p)){if(!o.checkBounds(c,p,l))break;this.intersectionTest(c,p,e,n)}}}},o.prototype.sortList=function(){for(var t=this.axisList,e=this.axisIndex,n=t.length,i=0;i!==n;i++){var r=t[i];r.aabbNeedsUpdate&&r.computeAABB()}0===e?o.insertionSortX(t):1===e?o.insertionSortY(t):2===e&&o.insertionSortZ(t)},o.checkBounds=function(t,e,n){var i,o;0===n?(i=t.position.x,o=e.position.x):1===n?(i=t.position.y,o=e.position.y):2===n&&(i=t.position.z,o=e.position.z);var r=t.boundingRadius;return o-e.boundingRadius<i+r},o.prototype.autoDetectAxis=function(){for(var t=0,e=0,n=0,i=0,o=0,r=0,s=this.axisList,a=s.length,l=1/a,c=0;c!==a;c++){var p=s[c],h=p.position.x;t+=h,e+=h*h;var u=p.position.y;n+=u,i+=u*u;var d=p.position.z;o+=d,r+=d*d}var v=e-t*t*l,m=i-n*n*l,g=r-o*o*l;this.axisIndex=v>m?v>g?0:2:m>g?1:2},o.prototype.aabbQuery=function(t,e,n){n=n||[],this.dirty&&(this.sortList(),this.dirty=!1);var i=this.axisIndex,o="x";1===i&&(o="y"),2===i&&(o="z");for(var r=this.axisList,s=(e.lowerBound[o],e.upperBound[o],0);s<r.length;s++){var a=r[s];a.aabbNeedsUpdate&&a.computeAABB(),a.aabb.overlaps(e)&&n.push(a)}return n}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(t,e,n){e.exports=a,t("./Constraint");var i=t("./PointToPointConstraint"),o=t("../equations/ConeEquation"),r=t("../equations/RotationalEquation"),s=(t("../equations/ContactEquation"),t("../math/Vec3"));function a(t,e,n){var a=void 0!==(n=n||{}).maxForce?n.maxForce:1e6,l=n.pivotA?n.pivotA.clone():new s,c=n.pivotB?n.pivotB.clone():new s;this.axisA=n.axisA?n.axisA.clone():new s,this.axisB=n.axisB?n.axisB.clone():new s,i.call(this,t,l,e,c,a),this.collideConnected=!!n.collideConnected,this.angle=void 0!==n.angle?n.angle:0;var p=this.coneEquation=new o(t,e,n),h=this.twistEquation=new r(t,e,n);this.twistAngle=void 0!==n.twistAngle?n.twistAngle:0,p.maxForce=0,p.minForce=-a,h.maxForce=0,h.minForce=-a,this.equations.push(p,h)}a.prototype=new i,a.constructor=a,new s,new s,a.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=this.coneEquation,o=this.twistEquation;i.prototype.update.call(this),t.vectorToWorldFrame(this.axisA,n.axisA),e.vectorToWorldFrame(this.axisB,n.axisB),this.axisA.tangents(o.axisA,o.axisA),t.vectorToWorldFrame(o.axisA,o.axisA),this.axisB.tangents(o.axisB,o.axisB),e.vectorToWorldFrame(o.axisB,o.axisB),n.angle=this.angle,o.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(t,e,n){e.exports=o;var i=t("../utils/Utils");function o(t,e,n){n=i.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.id=o.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}o.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},o.prototype.enable=function(){for(var t=this.equations,e=0;e<t.length;e++)t[e].enabled=!0},o.prototype.disable=function(){for(var t=this.equations,e=0;e<t.length;e++)t[e].enabled=!1},o.idCounter=0},{"../utils/Utils":53}],14:[function(t,e,n){e.exports=r;var i=t("./Constraint"),o=t("../equations/ContactEquation");function r(t,e,n,r){i.call(this,t,e),void 0===n&&(n=t.position.distanceTo(e.position)),void 0===r&&(r=1e6),this.distance=n;var s=this.distanceEquation=new o(t,e);this.equations.push(s),s.minForce=-r,s.maxForce=r}r.prototype=new i,r.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=this.distanceEquation,i=.5*this.distance,o=n.ni;e.position.vsub(t.position,o),o.normalize(),o.mult(i,n.ri),o.mult(-i,n.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(t,e,n){e.exports=a,t("./Constraint");var i=t("./PointToPointConstraint"),o=t("../equations/RotationalEquation"),r=t("../equations/RotationalMotorEquation"),s=(t("../equations/ContactEquation"),t("../math/Vec3"));function a(t,e,n){var a=void 0!==(n=n||{}).maxForce?n.maxForce:1e6,l=n.pivotA?n.pivotA.clone():new s,c=n.pivotB?n.pivotB.clone():new s;i.call(this,t,l,e,c,a),(this.axisA=n.axisA?n.axisA.clone():new s(1,0,0)).normalize(),(this.axisB=n.axisB?n.axisB.clone():new s(1,0,0)).normalize();var p=this.rotationalEquation1=new o(t,e,n),h=this.rotationalEquation2=new o(t,e,n),u=this.motorEquation=new r(t,e,a);u.enabled=!1,this.equations.push(p,h,u)}a.prototype=new i,a.constructor=a,a.prototype.enableMotor=function(){this.motorEquation.enabled=!0},a.prototype.disableMotor=function(){this.motorEquation.enabled=!1},a.prototype.setMotorSpeed=function(t){this.motorEquation.targetVelocity=t},a.prototype.setMotorMaxForce=function(t){this.motorEquation.maxForce=t,this.motorEquation.minForce=-t};var l=new s,c=new s;a.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=this.motorEquation,o=this.rotationalEquation1,r=this.rotationalEquation2,s=l,a=c,p=this.axisA,h=this.axisB;i.prototype.update.call(this),t.quaternion.vmult(p,s),e.quaternion.vmult(h,a),s.tangents(o.axisA,r.axisA),o.axisB.copy(a),r.axisB.copy(a),this.motorEquation.enabled&&(t.quaternion.vmult(this.axisA,n.axisA),e.quaternion.vmult(this.axisB,n.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(t,e,n){e.exports=s,t("./Constraint");var i=t("./PointToPointConstraint"),o=t("../equations/RotationalEquation"),r=(t("../equations/RotationalMotorEquation"),t("../equations/ContactEquation"),t("../math/Vec3"));function s(t,e,n){var s=void 0!==(n=n||{}).maxForce?n.maxForce:1e6,a=new r,l=new r,c=new r;t.position.vadd(e.position,c),c.scale(.5,c),e.pointToLocalFrame(c,l),t.pointToLocalFrame(c,a),i.call(this,t,a,e,l,s);var p=this.rotationalEquation1=new o(t,e,n),h=this.rotationalEquation2=new o(t,e,n),u=this.rotationalEquation3=new o(t,e,n);this.equations.push(p,h,u)}s.prototype=new i,s.constructor=s,new r,new r,s.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=(this.motorEquation,this.rotationalEquation1),o=this.rotationalEquation2,s=this.rotationalEquation3;i.prototype.update.call(this),t.vectorToWorldFrame(r.UNIT_X,n.axisA),e.vectorToWorldFrame(r.UNIT_Y,n.axisB),t.vectorToWorldFrame(r.UNIT_Y,o.axisA),e.vectorToWorldFrame(r.UNIT_Z,o.axisB),t.vectorToWorldFrame(r.UNIT_Z,s.axisA),e.vectorToWorldFrame(r.UNIT_X,s.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(t,e,n){e.exports=s;var i=t("./Constraint"),o=t("../equations/ContactEquation"),r=t("../math/Vec3");function s(t,e,n,s,a){i.call(this,t,n),a=void 0!==a?a:1e6,this.pivotA=e?e.clone():new r,this.pivotB=s?s.clone():new r;var l=this.equationX=new o(t,n),c=this.equationY=new o(t,n),p=this.equationZ=new o(t,n);this.equations.push(l,c,p),l.minForce=c.minForce=p.minForce=-a,l.maxForce=c.maxForce=p.maxForce=a,l.ni.set(1,0,0),c.ni.set(0,1,0),p.ni.set(0,0,1)}s.prototype=new i,s.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=this.equationX,i=this.equationY,o=this.equationZ;t.quaternion.vmult(this.pivotA,n.ri),e.quaternion.vmult(this.pivotB,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),o.ri.copy(n.ri),o.rj.copy(n.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(t,e,n){e.exports=r;var i=t("../math/Vec3"),o=(t("../math/Mat3"),t("./Equation"));function r(t,e,n){var r=void 0!==(n=n||{}).maxForce?n.maxForce:1e6;o.call(this,t,e,-r,r),this.axisA=n.axisA?n.axisA.clone():new i(1,0,0),this.axisB=n.axisB?n.axisB.clone():new i(0,1,0),this.angle=void 0!==n.angle?n.angle:0}r.prototype=new o,r.prototype.constructor=r;var s=new i,a=new i;r.prototype.computeB=function(t){var e=this.a,n=this.b,i=this.axisA,o=this.axisB,r=s,l=a,c=this.jacobianElementA,p=this.jacobianElementB;return i.cross(o,r),o.cross(i,l),c.rotational.copy(l),p.rotational.copy(r),-(Math.cos(this.angle)-i.dot(o))*e-this.computeGW()*n-t*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(t,e,n){e.exports=r;var i=t("./Equation"),o=t("../math/Vec3");function r(t,e,n){n=void 0!==n?n:1e6,i.call(this,t,e,0,n),this.restitution=0,this.ri=new o,this.rj=new o,this.ni=new o}t("../math/Mat3"),r.prototype=new i,r.prototype.constructor=r;var s=new o,a=new o,l=new o;r.prototype.computeB=function(t){var e=this.a,n=this.b,i=this.bi,o=this.bj,r=this.ri,c=this.rj,p=s,h=a,u=i.velocity,d=i.angularVelocity,v=(i.force,i.torque,o.velocity),m=o.angularVelocity,g=(o.force,o.torque,l),f=this.jacobianElementA,x=this.jacobianElementB,b=this.ni;r.cross(b,p),c.cross(b,h),b.negate(f.spatial),p.negate(f.rotational),x.spatial.copy(b),x.rotational.copy(h),g.copy(o.position),g.vadd(c,g),g.vsub(i.position,g),g.vsub(r,g);var w=b.dot(g),y=this.restitution+1;return-w*e-(y*v.dot(b)-y*u.dot(b)+m.dot(h)-d.dot(p))*n-t*this.computeGiMf()};var c=new o,p=new o,h=new o,u=new o,d=new o;r.prototype.getImpactVelocityAlongNormal=function(){var t=c,e=p,n=h,i=u,o=d;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,i),this.bi.getVelocityAtWorldPoint(n,t),this.bj.getVelocityAtWorldPoint(i,e),t.vsub(e,o),this.ni.dot(o)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(t,e,n){e.exports=r;var i=t("../math/JacobianElement"),o=t("../math/Vec3");function r(t,e,n,o){this.id=r.id++,this.minForce=void 0===n?-1e6:n,this.maxForce=void 0===o?1e6:o,this.bi=t,this.bj=e,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new i,this.jacobianElementB=new i,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}r.prototype.constructor=r,r.id=0,r.prototype.setSpookParams=function(t,e,n){var i=e,o=t,r=n;this.a=4/(r*(1+4*i)),this.b=4*i/(1+4*i),this.eps=4/(r*r*o*(1+4*i))},r.prototype.computeB=function(t,e,n){var i=this.computeGW();return-this.computeGq()*t-i*e-this.computeGiMf()*n},r.prototype.computeGq=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,o=n.position,r=i.position;return t.spatial.dot(o)+e.spatial.dot(r)};var s=new o;r.prototype.computeGW=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,o=n.velocity,r=i.velocity,a=n.angularVelocity||s,l=i.angularVelocity||s;return t.multiplyVectors(o,a)+e.multiplyVectors(r,l)},r.prototype.computeGWlambda=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,o=n.vlambda,r=i.vlambda,a=n.wlambda||s,l=i.wlambda||s;return t.multiplyVectors(o,a)+e.multiplyVectors(r,l)};var a=new o,l=new o,c=new o,p=new o;r.prototype.computeGiMf=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,o=n.force,r=n.torque,s=i.force,h=i.torque,u=n.invMassSolve,d=i.invMassSolve;return n.invInertiaWorldSolve?n.invInertiaWorldSolve.vmult(r,c):c.set(0,0,0),i.invInertiaWorldSolve?i.invInertiaWorldSolve.vmult(h,p):p.set(0,0,0),o.mult(u,a),s.mult(d,l),t.multiplyVectors(a,c)+e.multiplyVectors(l,p)};var h=new o;r.prototype.computeGiMGt=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,o=n.invMassSolve,r=i.invMassSolve,s=n.invInertiaWorldSolve,a=i.invInertiaWorldSolve,l=o+r;return s&&(s.vmult(t.rotational,h),l+=h.dot(t.rotational)),a&&(a.vmult(e.rotational,h),l+=h.dot(e.rotational)),l};var u=new o;new o,new o,new o,new o,new o,r.prototype.addToWlambda=function(t){var e=this.jacobianElementA,n=this.jacobianElementB,i=this.bi,o=this.bj,r=u;e.spatial.mult(i.invMassSolve*t,r),i.vlambda.vadd(r,i.vlambda),n.spatial.mult(o.invMassSolve*t,r),o.vlambda.vadd(r,o.vlambda),i.invInertiaWorldSolve&&(i.invInertiaWorldSolve.vmult(e.rotational,r),r.mult(t,r),i.wlambda.vadd(r,i.wlambda)),o.invInertiaWorldSolve&&(o.invInertiaWorldSolve.vmult(n.rotational,r),r.mult(t,r),o.wlambda.vadd(r,o.wlambda))},r.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(t,e,n){e.exports=r;var i=t("./Equation"),o=t("../math/Vec3");function r(t,e,n){i.call(this,t,e,-n,n),this.ri=new o,this.rj=new o,this.t=new o}t("../math/Mat3"),r.prototype=new i,r.prototype.constructor=r;var s=new o,a=new o;r.prototype.computeB=function(t){this.a;var e=this.b,n=(this.bi,this.bj,this.ri),i=this.rj,o=s,r=a,l=this.t;n.cross(l,o),i.cross(l,r);var c=this.jacobianElementA,p=this.jacobianElementB;return l.negate(c.spatial),o.negate(c.rotational),p.spatial.copy(l),p.rotational.copy(r),-this.computeGW()*e-t*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(t,e,n){e.exports=r;var i=t("../math/Vec3"),o=(t("../math/Mat3"),t("./Equation"));function r(t,e,n){var r=void 0!==(n=n||{}).maxForce?n.maxForce:1e6;o.call(this,t,e,-r,r),this.axisA=n.axisA?n.axisA.clone():new i(1,0,0),this.axisB=n.axisB?n.axisB.clone():new i(0,1,0),this.maxAngle=Math.PI/2}r.prototype=new o,r.prototype.constructor=r;var s=new i,a=new i;r.prototype.computeB=function(t){var e=this.a,n=this.b,i=this.axisA,o=this.axisB,r=s,l=a,c=this.jacobianElementA,p=this.jacobianElementB;return i.cross(o,r),o.cross(i,l),c.rotational.copy(l),p.rotational.copy(r),-(Math.cos(this.maxAngle)-i.dot(o))*e-this.computeGW()*n-t*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(t,e,n){e.exports=r;var i=t("../math/Vec3"),o=(t("../math/Mat3"),t("./Equation"));function r(t,e,n){n=void 0!==n?n:1e6,o.call(this,t,e,-n,n),this.axisA=new i,this.axisB=new i,this.targetVelocity=0}r.prototype=new o,r.prototype.constructor=r,r.prototype.computeB=function(t){this.a;var e=this.b,n=(this.bi,this.bj,this.axisA),i=this.axisB,o=this.jacobianElementA,r=this.jacobianElementB;return o.rotational.copy(n),i.negate(r.rotational),-(this.computeGW()-this.targetVelocity)*e-t*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(t,e,n){var i=t("../utils/Utils");function o(t,e,n){n=i.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=o.idCounter++,this.materials=[t,e],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}e.exports=o,o.idCounter=0},{"../utils/Utils":53}],25:[function(t,e,n){function i(t){var e="";"string"==typeof(t=t||{})?(e=t,t={}):"object"==typeof t&&(e=""),this.name=e,this.id=i.idCounter++,this.friction=void 0!==t.friction?t.friction:-1,this.restitution=void 0!==t.restitution?t.restitution:-1}e.exports=i,i.idCounter=0},{}],26:[function(t,e,n){e.exports=o;var i=t("./Vec3");function o(){this.spatial=new i,this.rotational=new i}o.prototype.multiplyElement=function(t){return t.spatial.dot(this.spatial)+t.rotational.dot(this.rotational)},o.prototype.multiplyVectors=function(t,e){return t.dot(this.spatial)+e.dot(this.rotational)}},{"./Vec3":30}],27:[function(t,e,n){e.exports=o;var i=t("./Vec3");function o(t){this.elements=t||[0,0,0,0,0,0,0,0,0]}o.prototype.identity=function(){var t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1},o.prototype.setZero=function(){var t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0},o.prototype.setTrace=function(t){var e=this.elements;e[0]=t.x,e[4]=t.y,e[8]=t.z},o.prototype.getTrace=function(t){t=t||new i;var e=this.elements;t.x=e[0],t.y=e[4],t.z=e[8]},o.prototype.vmult=function(t,e){e=e||new i;var n=this.elements,o=t.x,r=t.y,s=t.z;return e.x=n[0]*o+n[1]*r+n[2]*s,e.y=n[3]*o+n[4]*r+n[5]*s,e.z=n[6]*o+n[7]*r+n[8]*s,e},o.prototype.smult=function(t){for(var e=0;e<this.elements.length;e++)this.elements[e]*=t},o.prototype.mmult=function(t,e){for(var n=e||new o,i=0;i<3;i++)for(var r=0;r<3;r++){for(var s=0,a=0;a<3;a++)s+=t.elements[i+3*a]*this.elements[a+3*r];n.elements[i+3*r]=s}return n},o.prototype.scale=function(t,e){e=e||new o;for(var n=this.elements,i=e.elements,r=0;3!==r;r++)i[3*r+0]=t.x*n[3*r+0],i[3*r+1]=t.y*n[3*r+1],i[3*r+2]=t.z*n[3*r+2];return e},o.prototype.solve=function(t,e){e=e||new i;for(var n,o=[],r=0;r<12;r++)o.push(0);for(r=0;r<3;r++)for(n=0;n<3;n++)o[r+4*n]=this.elements[r+3*n];o[3]=t.x,o[7]=t.y,o[11]=t.z;var s,a,l=3,c=l;do{if(0===o[(r=c-l)+4*r])for(n=r+1;n<c;n++)if(0!==o[r+4*n]){s=4;do{o[(a=4-s)+4*r]+=o[a+4*n]}while(--s);break}if(0!==o[r+4*r])for(n=r+1;n<c;n++){var p=o[r+4*n]/o[r+4*r];s=4;do{o[(a=4-s)+4*n]=a<=r?0:o[a+4*n]-o[a+4*r]*p}while(--s)}}while(--l);if(e.z=o[11]/o[10],e.y=(o[7]-o[6]*e.z)/o[5],e.x=(o[3]-o[2]*e.z-o[1]*e.y)/o[0],isNaN(e.x)||isNaN(e.y)||isNaN(e.z)||e.x===1/0||e.y===1/0||e.z===1/0)throw"Could not solve equation! Got x=["+e.toString()+"], b=["+t.toString()+"], A=["+this.toString()+"]";return e},o.prototype.e=function(t,e,n){if(void 0===n)return this.elements[e+3*t];this.elements[e+3*t]=n},o.prototype.copy=function(t){for(var e=0;e<t.elements.length;e++)this.elements[e]=t.elements[e];return this},o.prototype.toString=function(){for(var t="",e=0;e<9;e++)t+=this.elements[e]+",";return t},o.prototype.reverse=function(t){t=t||new o;for(var e,n=[],i=0;i<18;i++)n.push(0);for(i=0;i<3;i++)for(e=0;e<3;e++)n[i+6*e]=this.elements[i+3*e];n[3]=1,n[9]=0,n[15]=0,n[4]=0,n[10]=1,n[16]=0,n[5]=0,n[11]=0,n[17]=1;var r,s,a=3,l=a;do{if(0===n[(i=l-a)+6*i])for(e=i+1;e<l;e++)if(0!==n[i+6*e]){r=6;do{n[(s=6-r)+6*i]+=n[s+6*e]}while(--r);break}if(0!==n[i+6*i])for(e=i+1;e<l;e++){var c=n[i+6*e]/n[i+6*i];r=6;do{n[(s=6-r)+6*e]=s<=i?0:n[s+6*e]-n[s+6*i]*c}while(--r)}}while(--a);i=2;do{e=i-1;do{c=n[i+6*e]/n[i+6*i],r=6;do{n[(s=6-r)+6*e]=n[s+6*e]-n[s+6*i]*c}while(--r)}while(e--)}while(--i);i=2;do{c=1/n[i+6*i],r=6;do{n[(s=6-r)+6*i]=n[s+6*i]*c}while(--r)}while(i--);i=2;do{e=2;do{if(s=n[3+e+6*i],isNaN(s)||s===1/0)throw"Could not reverse! A=["+this.toString()+"]";t.e(i,e,s)}while(e--)}while(i--);return t},o.prototype.setRotationFromQuaternion=function(t){var e=t.x,n=t.y,i=t.z,o=t.w,r=e+e,s=n+n,a=i+i,l=e*r,c=e*s,p=e*a,h=n*s,u=n*a,d=i*a,v=o*r,m=o*s,g=o*a,f=this.elements;return f[0]=1-(h+d),f[1]=c-g,f[2]=p+m,f[3]=c+g,f[4]=1-(l+d),f[5]=u-v,f[6]=p-m,f[7]=u+v,f[8]=1-(l+h),this},o.prototype.transpose=function(t){for(var e=(t=t||new o).elements,n=this.elements,i=0;3!==i;i++)for(var r=0;3!==r;r++)e[3*i+r]=n[3*r+i];return t}},{"./Vec3":30}],28:[function(t,e,n){e.exports=o;var i=t("./Vec3");function o(t,e,n,i){this.x=void 0!==t?t:0,this.y=void 0!==e?e:0,this.z=void 0!==n?n:0,this.w=void 0!==i?i:1}o.prototype.set=function(t,e,n,i){this.x=t,this.y=e,this.z=n,this.w=i},o.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},o.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},o.prototype.setFromAxisAngle=function(t,e){var n=Math.sin(.5*e);this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(.5*e)},o.prototype.toAxisAngle=function(t){t=t||new i,this.normalize();var e=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(t.x=this.x,t.y=this.y,t.z=this.z):(t.x=this.x/n,t.y=this.y/n,t.z=this.z/n),[t,e]};var r=new i,s=new i;o.prototype.setFromVectors=function(t,e){if(t.isAntiparallelTo(e)){var n=r,i=s;t.tangents(n,i),this.setFromAxisAngle(n,Math.PI)}else{var o=t.cross(e);this.x=o.x,this.y=o.y,this.z=o.z,this.w=Math.sqrt(Math.pow(t.norm(),2)*Math.pow(e.norm(),2))+t.dot(e),this.normalize()}};var a=new i,l=new i,c=new i;o.prototype.mult=function(t,e){e=e||new o;var n=this.w,i=a,r=l,s=c;return i.set(this.x,this.y,this.z),r.set(t.x,t.y,t.z),e.w=n*t.w-i.dot(r),i.cross(r,s),e.x=n*r.x+t.w*i.x+s.x,e.y=n*r.y+t.w*i.y+s.y,e.z=n*r.z+t.w*i.z+s.z,e},o.prototype.inverse=function(t){var e=this.x,n=this.y,i=this.z,r=this.w;t=t||new o,this.conjugate(t);var s=1/(e*e+n*n+i*i+r*r);return t.x*=s,t.y*=s,t.z*=s,t.w*=s,t},o.prototype.conjugate=function(t){return(t=t||new o).x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t},o.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t)},o.prototype.normalizeFast=function(){var t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t)},o.prototype.vmult=function(t,e){e=e||new i;var n=t.x,o=t.y,r=t.z,s=this.x,a=this.y,l=this.z,c=this.w,p=c*n+a*r-l*o,h=c*o+l*n-s*r,u=c*r+s*o-a*n,d=-s*n-a*o-l*r;return e.x=p*c+d*-s+h*-l-u*-a,e.y=h*c+d*-a+u*-s-p*-l,e.z=u*c+d*-l+p*-a-h*-s,e},o.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},o.prototype.toEuler=function(t,e){var n,i,o;e=e||"YZX";var r=this.x,s=this.y,a=this.z,l=this.w;if("YZX"!==e)throw new Error("Euler order "+e+" not supported yet.");var c=r*s+a*l;if(c>.499&&(n=2*Math.atan2(r,l),i=Math.PI/2,o=0),c<-.499&&(n=-2*Math.atan2(r,l),i=-Math.PI/2,o=0),isNaN(n)){var p=r*r,h=s*s,u=a*a;n=Math.atan2(2*s*l-2*r*a,1-2*h-2*u),i=Math.asin(2*c),o=Math.atan2(2*r*l-2*s*a,1-2*p-2*u)}t.y=n,t.z=i,t.x=o},o.prototype.setFromEuler=function(t,e,n,i){i=i||"XYZ";var o=Math.cos(t/2),r=Math.cos(e/2),s=Math.cos(n/2),a=Math.sin(t/2),l=Math.sin(e/2),c=Math.sin(n/2);return"XYZ"===i?(this.x=a*r*s+o*l*c,this.y=o*l*s-a*r*c,this.z=o*r*c+a*l*s,this.w=o*r*s-a*l*c):"YXZ"===i?(this.x=a*r*s+o*l*c,this.y=o*l*s-a*r*c,this.z=o*r*c-a*l*s,this.w=o*r*s+a*l*c):"ZXY"===i?(this.x=a*r*s-o*l*c,this.y=o*l*s+a*r*c,this.z=o*r*c+a*l*s,this.w=o*r*s-a*l*c):"ZYX"===i?(this.x=a*r*s-o*l*c,this.y=o*l*s+a*r*c,this.z=o*r*c-a*l*s,this.w=o*r*s+a*l*c):"YZX"===i?(this.x=a*r*s+o*l*c,this.y=o*l*s+a*r*c,this.z=o*r*c-a*l*s,this.w=o*r*s-a*l*c):"XZY"===i&&(this.x=a*r*s-o*l*c,this.y=o*l*s-a*r*c,this.z=o*r*c+a*l*s,this.w=o*r*s+a*l*c),this},o.prototype.clone=function(){return new o(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(t,e,n){var i=t("./Vec3"),o=t("./Quaternion");function r(t){t=t||{},this.position=new i,t.position&&this.position.copy(t.position),this.quaternion=new o,t.quaternion&&this.quaternion.copy(t.quaternion)}e.exports=r;var s=new o;r.pointToLocalFrame=function(t,e,n,o){return o=o||new i,n.vsub(t,o),e.conjugate(s),s.vmult(o,o),o},r.prototype.pointToLocal=function(t,e){return r.pointToLocalFrame(this.position,this.quaternion,t,e)},r.pointToWorldFrame=function(t,e,n,o){return o=o||new i,e.vmult(n,o),o.vadd(t,o),o},r.prototype.pointToWorld=function(t,e){return r.pointToWorldFrame(this.position,this.quaternion,t,e)},r.prototype.vectorToWorldFrame=function(t,e){return e=e||new i,this.quaternion.vmult(t,e),e},r.vectorToWorldFrame=function(t,e,n){return t.vmult(e,n),n},r.vectorToLocalFrame=function(t,e,n,o){return o=o||new i,e.w*=-1,e.vmult(n,o),e.w*=-1,o}},{"./Quaternion":28,"./Vec3":30}],30:[function(t,e,n){e.exports=o;var i=t("./Mat3");function o(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0}o.ZERO=new o(0,0,0),o.UNIT_X=new o(1,0,0),o.UNIT_Y=new o(0,1,0),o.UNIT_Z=new o(0,0,1),o.prototype.cross=function(t,e){var n=t.x,i=t.y,r=t.z,s=this.x,a=this.y,l=this.z;return(e=e||new o).x=a*r-l*i,e.y=l*n-s*r,e.z=s*i-a*n,e},o.prototype.set=function(t,e,n){return this.x=t,this.y=e,this.z=n,this},o.prototype.setZero=function(){this.x=this.y=this.z=0},o.prototype.vadd=function(t,e){if(!e)return new o(this.x+t.x,this.y+t.y,this.z+t.z);e.x=t.x+this.x,e.y=t.y+this.y,e.z=t.z+this.z},o.prototype.vsub=function(t,e){if(!e)return new o(this.x-t.x,this.y-t.y,this.z-t.z);e.x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z},o.prototype.crossmat=function(){return new i([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},o.prototype.normalize=function(){var t=this.x,e=this.y,n=this.z,i=Math.sqrt(t*t+e*e+n*n);if(i>0){var o=1/i;this.x*=o,this.y*=o,this.z*=o}else this.x=0,this.y=0,this.z=0;return i},o.prototype.unit=function(t){t=t||new o;var e=this.x,n=this.y,i=this.z,r=Math.sqrt(e*e+n*n+i*i);return r>0?(r=1/r,t.x=e*r,t.y=n*r,t.z=i*r):(t.x=1,t.y=0,t.z=0),t},o.prototype.norm=function(){var t=this.x,e=this.y,n=this.z;return Math.sqrt(t*t+e*e+n*n)},o.prototype.length=o.prototype.norm,o.prototype.norm2=function(){return this.dot(this)},o.prototype.lengthSquared=o.prototype.norm2,o.prototype.distanceTo=function(t){var e=this.x,n=this.y,i=this.z,o=t.x,r=t.y,s=t.z;return Math.sqrt((o-e)*(o-e)+(r-n)*(r-n)+(s-i)*(s-i))},o.prototype.distanceSquared=function(t){var e=this.x,n=this.y,i=this.z,o=t.x,r=t.y,s=t.z;return(o-e)*(o-e)+(r-n)*(r-n)+(s-i)*(s-i)},o.prototype.mult=function(t,e){e=e||new o;var n=this.x,i=this.y,r=this.z;return e.x=t*n,e.y=t*i,e.z=t*r,e},o.prototype.scale=o.prototype.mult,o.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},o.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},o.prototype.negate=function(t){return(t=t||new o).x=-this.x,t.y=-this.y,t.z=-this.z,t};var r=new o,s=new o;o.prototype.tangents=function(t,e){var n=this.norm();if(n>0){var i=r,o=1/n;i.set(this.x*o,this.y*o,this.z*o);var a=s;Math.abs(i.x)<.9?(a.set(1,0,0),i.cross(a,t)):(a.set(0,1,0),i.cross(a,t)),i.cross(t,e)}else t.set(1,0,0),e.set(0,1,0)},o.prototype.toString=function(){return this.x+","+this.y+","+this.z},o.prototype.toArray=function(){return[this.x,this.y,this.z]},o.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},o.prototype.lerp=function(t,e,n){var i=this.x,o=this.y,r=this.z;n.x=i+(t.x-i)*e,n.y=o+(t.y-o)*e,n.z=r+(t.z-r)*e},o.prototype.almostEquals=function(t,e){return void 0===e&&(e=1e-6),!(Math.abs(this.x-t.x)>e||Math.abs(this.y-t.y)>e||Math.abs(this.z-t.z)>e)},o.prototype.almostZero=function(t){return void 0===t&&(t=1e-6),!(Math.abs(this.x)>t||Math.abs(this.y)>t||Math.abs(this.z)>t)};var a=new o;o.prototype.isAntiparallelTo=function(t,e){return this.negate(a),a.almostEquals(t,e)},o.prototype.clone=function(){return new o(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(t,e,n){e.exports=c;var i=t("../utils/EventTarget"),o=(t("../shapes/Shape"),t("../math/Vec3")),r=t("../math/Mat3"),s=t("../math/Quaternion"),a=(t("../material/Material"),t("../collision/AABB")),l=t("../shapes/Box");function c(t){t=t||{},i.apply(this),this.id=c.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new o,this.collisionFilterGroup="number"==typeof t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof t.collisionFilterMask?t.collisionFilterMask:1,this.collisionResponse=!0,this.position=new o,t.position&&this.position.copy(t.position),this.previousPosition=new o,this.initPosition=new o,this.velocity=new o,t.velocity&&this.velocity.copy(t.velocity),this.initVelocity=new o,this.force=new o;var e="number"==typeof t.mass?t.mass:0;this.mass=e,this.invMass=e>0?1/e:0,this.material=t.material||null,this.linearDamping="number"==typeof t.linearDamping?t.linearDamping:.01,this.type=e<=0?c.STATIC:c.DYNAMIC,typeof t.type==typeof c.STATIC&&(this.type=t.type),this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.sleepState=0,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new o,this.quaternion=new s,t.quaternion&&this.quaternion.copy(t.quaternion),this.initQuaternion=new s,this.angularVelocity=new o,t.angularVelocity&&this.angularVelocity.copy(t.angularVelocity),this.initAngularVelocity=new o,this.interpolatedPosition=new o,this.interpolatedQuaternion=new s,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new o,this.invInertia=new o,this.invInertiaWorld=new r,this.invMassSolve=0,this.invInertiaSolve=new o,this.invInertiaWorldSolve=new r,this.fixedRotation=void 0!==t.fixedRotation&&t.fixedRotation,this.angularDamping=void 0!==t.angularDamping?t.angularDamping:.01,this.aabb=new a,this.aabbNeedsUpdate=!0,this.wlambda=new o,t.shape&&this.addShape(t.shape),this.updateMassProperties()}c.prototype=new i,c.prototype.constructor=c,c.DYNAMIC=1,c.STATIC=2,c.KINEMATIC=4,c.AWAKE=0,c.SLEEPY=1,c.SLEEPING=2,c.idCounter=0,c.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=0,t===c.SLEEPING&&this.dispatchEvent({type:"wakeup"})},c.prototype.sleep=function(){this.sleepState=c.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},c.sleepyEvent={type:"sleepy"},c.sleepEvent={type:"sleep"},c.prototype.sleepTick=function(t){if(this.allowSleep){var e=this.sleepState,n=this.velocity.norm2()+this.angularVelocity.norm2(),i=Math.pow(this.sleepSpeedLimit,2);e===c.AWAKE&&n<i?(this.sleepState=c.SLEEPY,this.timeLastSleepy=t,this.dispatchEvent(c.sleepyEvent)):e===c.SLEEPY&&n>i?this.wakeUp():e===c.SLEEPY&&t-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(c.sleepEvent))}},c.prototype.updateSolveMassProperties=function(){this.sleepState===c.SLEEPING||this.type===c.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},c.prototype.pointToLocalFrame=function(t,e){return e=e||new o,t.vsub(this.position,e),this.quaternion.conjugate().vmult(e,e),e},c.prototype.vectorToLocalFrame=function(t,e){return e=e||new o,this.quaternion.conjugate().vmult(t,e),e},c.prototype.pointToWorldFrame=function(t,e){return e=e||new o,this.quaternion.vmult(t,e),e.vadd(this.position,e),e},c.prototype.vectorToWorldFrame=function(t,e){return e=e||new o,this.quaternion.vmult(t,e),e};var p=new o,h=new s;c.prototype.addShape=function(t,e,n){var i=new o,r=new s;return e&&i.copy(e),n&&r.copy(n),this.shapes.push(t),this.shapeOffsets.push(i),this.shapeOrientations.push(r),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},c.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=this.shapeOffsets,n=t.length,i=0,o=0;o!==n;o++){var r=t[o];r.updateBoundingSphereRadius();var s=e[o].norm(),a=r.boundingSphereRadius;s+a>i&&(i=s+a)}this.boundingRadius=i};var u=new a;c.prototype.computeAABB=function(){for(var t=this.shapes,e=this.shapeOffsets,n=this.shapeOrientations,i=t.length,o=p,r=h,s=this.quaternion,a=this.aabb,l=u,c=0;c!==i;c++){var d=t[c];n[c].mult(s,r),r.vmult(e[c],o),o.vadd(this.position,o),d.calculateWorldAABB(o,r,l.lowerBound,l.upperBound),0===c?a.copy(l):a.extend(l)}this.aabbNeedsUpdate=!1};var d=new r,v=new r;new r,c.prototype.updateInertiaWorld=function(t){var e=this.invInertia;if(e.x!==e.y||e.y!==e.z||t){var n=d,i=v;n.setRotationFromQuaternion(this.quaternion),n.transpose(i),n.scale(e,n),n.mmult(i,this.invInertiaWorld)}};var m=new o,g=new o;c.prototype.applyForce=function(t,e){if(this.type===c.DYNAMIC){var n=m;e.vsub(this.position,n);var i=g;n.cross(t,i),this.force.vadd(t,this.force),this.torque.vadd(i,this.torque)}};var f=new o,x=new o;c.prototype.applyLocalForce=function(t,e){if(this.type===c.DYNAMIC){var n=f,i=x;this.vectorToWorldFrame(t,n),this.pointToWorldFrame(e,i),this.applyForce(n,i)}};var b=new o,w=new o,y=new o;c.prototype.applyImpulse=function(t,e){if(this.type===c.DYNAMIC){var n=b;e.vsub(this.position,n);var i=w;i.copy(t),i.mult(this.invMass,i),this.velocity.vadd(i,this.velocity);var o=y;n.cross(t,o),this.invInertiaWorld.vmult(o,o),this.angularVelocity.vadd(o,this.angularVelocity)}};var _=new o,P=new o;c.prototype.applyLocalImpulse=function(t,e){if(this.type===c.DYNAMIC){var n=_,i=P;this.vectorToWorldFrame(t,n),this.pointToWorldFrame(e,i),this.applyImpulse(n,i)}};var C=new o;c.prototype.updateMassProperties=function(){var t=C;this.invMass=this.mass>0?1/this.mass:0;var e=this.inertia,n=this.fixedRotation;this.computeAABB(),t.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),l.calculateInertia(t,this.mass,e),this.invInertia.set(e.x>0&&!n?1/e.x:0,e.y>0&&!n?1/e.y:0,e.z>0&&!n?1/e.z:0),this.updateInertiaWorld(!0)},c.prototype.getVelocityAtWorldPoint=function(t,e){var n=new o;return t.vsub(this.position,n),this.angularVelocity.cross(n,e),this.velocity.vadd(e,e),e}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(t,e,n){t("./Body");var i=t("../math/Vec3"),o=t("../math/Quaternion"),r=(t("../collision/RaycastResult"),t("../collision/Ray")),s=t("../objects/WheelInfo");function a(t){this.chassisBody=t.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==t.indexRightAxis?t.indexRightAxis:1,this.indexForwardAxis=void 0!==t.indexForwardAxis?t.indexForwardAxis:0,this.indexUpAxis=void 0!==t.indexUpAxis?t.indexUpAxis:2}e.exports=a,new i,new i,new i;var l=new i,c=new i,p=new i;new r,a.prototype.addWheel=function(t){var e=new s(t=t||{}),n=this.wheelInfos.length;return this.wheelInfos.push(e),n},a.prototype.setSteeringValue=function(t,e){this.wheelInfos[e].steering=t},new i,a.prototype.applyEngineForce=function(t,e){this.wheelInfos[e].engineForce=t},a.prototype.setBrake=function(t,e){this.wheelInfos[e].brake=t},a.prototype.addToWorld=function(t){this.constraints,t.add(this.chassisBody);var e=this;this.preStepCallback=function(){e.updateVehicle(t.dt)},t.addEventListener("preStep",this.preStepCallback),this.world=t},a.prototype.getVehicleAxisWorld=function(t,e){e.set(0===t?1:0,1===t?1:0,2===t?1:0),this.chassisBody.vectorToWorldFrame(e,e)},a.prototype.updateVehicle=function(t){for(var e=this.wheelInfos,n=e.length,o=this.chassisBody,r=0;r<n;r++)this.updateWheelTransform(r);this.currentVehicleSpeedKmHour=3.6*o.velocity.norm();var s=new i;for(this.getVehicleAxisWorld(this.indexForwardAxis,s),s.dot(o.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1),r=0;r<n;r++)this.castRay(e[r]);this.updateSuspension(t);var a=new i,l=new i;for(r=0;r<n;r++){var c=(d=e[r]).suspensionForce;c>d.maxSuspensionForce&&(c=d.maxSuspensionForce),d.raycastResult.hitNormalWorld.scale(c*t,a),d.raycastResult.hitPointWorld.vsub(o.position,l),o.applyImpulse(a,d.raycastResult.hitPointWorld)}this.updateFriction(t);var p=new i,h=new i,u=new i;for(r=0;r<n;r++){var d=e[r];o.getVelocityAtWorldPoint(d.chassisConnectionPointWorld,u);var v=1;if(1===this.indexUpAxis&&(v=-1),d.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,h);var m=h.dot(d.raycastResult.hitNormalWorld);d.raycastResult.hitNormalWorld.scale(m,p),h.vsub(p,h);var g=h.dot(u);d.deltaRotation=v*g*t/d.radius}!d.sliding&&d.isInContact||0===d.engineForce||!d.useCustomSlidingRotationalSpeed||(d.deltaRotation=(d.engineForce>0?1:-1)*d.customSlidingRotationalSpeed*t),Math.abs(d.brake)>Math.abs(d.engineForce)&&(d.deltaRotation=0),d.rotation+=d.deltaRotation,d.deltaRotation*=.99}},a.prototype.updateSuspension=function(t){for(var e=this.chassisBody.mass,n=this.wheelInfos,i=n.length,o=0;o<i;o++){var r=n[o];if(r.isInContact){var s,a=r.suspensionRestLength-r.suspensionLength;s=r.suspensionStiffness*a*r.clippedInvContactDotSuspension;var l=r.suspensionRelativeVelocity;s-=(l<0?r.dampingCompression:r.dampingRelaxation)*l,r.suspensionForce=s*e,r.suspensionForce<0&&(r.suspensionForce=0)}else r.suspensionForce=0}},a.prototype.removeFromWorld=function(t){this.constraints,t.remove(this.chassisBody),t.removeEventListener("preStep",this.preStepCallback),this.world=null};var h=new i,u=new i;a.prototype.castRay=function(t){var e=h,n=u;this.updateWheelTransformWorld(t);var o=this.chassisBody,r=-1,s=t.suspensionRestLength+t.radius;t.directionWorld.scale(s,e);var a=t.chassisConnectionPointWorld;a.vadd(e,n);var l=t.raycastResult;l.reset();var c=o.collisionResponse;o.collisionResponse=!1,this.world.rayTest(a,n,l),o.collisionResponse=c;var p=l.body;if(t.raycastResult.groundObject=0,p){r=l.distance,t.raycastResult.hitNormalWorld=l.hitNormalWorld,t.isInContact=!0;var d=l.distance;t.suspensionLength=d-t.radius;var v=t.suspensionRestLength-t.maxSuspensionTravel,m=t.suspensionRestLength+t.maxSuspensionTravel;t.suspensionLength<v&&(t.suspensionLength=v),t.suspensionLength>m&&(t.suspensionLength=m,t.raycastResult.reset());var g=t.raycastResult.hitNormalWorld.dot(t.directionWorld),f=new i;o.getVelocityAtWorldPoint(t.raycastResult.hitPointWorld,f);var x=t.raycastResult.hitNormalWorld.dot(f);if(g>=-.1)t.suspensionRelativeVelocity=0,t.clippedInvContactDotSuspension=10;else{var b=-1/g;t.suspensionRelativeVelocity=x*b,t.clippedInvContactDotSuspension=b}}else t.suspensionLength=t.suspensionRestLength+0*t.maxSuspensionTravel,t.suspensionRelativeVelocity=0,t.directionWorld.scale(-1,t.raycastResult.hitNormalWorld),t.clippedInvContactDotSuspension=1;return r},a.prototype.updateWheelTransformWorld=function(t){t.isInContact=!1;var e=this.chassisBody;e.pointToWorldFrame(t.chassisConnectionPointLocal,t.chassisConnectionPointWorld),e.vectorToWorldFrame(t.directionLocal,t.directionWorld),e.vectorToWorldFrame(t.axleLocal,t.axleWorld)},a.prototype.updateWheelTransform=function(t){var e=l,n=c,i=p,r=this.wheelInfos[t];this.updateWheelTransformWorld(r),r.directionLocal.scale(-1,e),n.copy(r.axleLocal),e.cross(n,i),i.normalize(),n.normalize();var s=r.steering,a=new o;a.setFromAxisAngle(e,s);var h=new o;h.setFromAxisAngle(n,r.rotation);var u=r.worldTransform.quaternion;this.chassisBody.quaternion.mult(a,u),u.mult(h,u),u.normalize();var d=r.worldTransform.position;d.copy(r.directionWorld),d.scale(r.suspensionLength,d),d.vadd(r.chassisConnectionPointWorld,d)};var d=[new i(1,0,0),new i(0,1,0),new i(0,0,1)];a.prototype.getWheelTransformWorld=function(t){return this.wheelInfos[t].worldTransform};var v=new i,m=[],g=[];a.prototype.updateFriction=function(t){for(var e=v,n=this.wheelInfos,o=n.length,r=this.chassisBody,s=g,a=m,l=0;l<o;l++)u=(E=n[l]).raycastResult.body,E.sideImpulse=0,E.forwardImpulse=0,s[l]||(s[l]=new i),a[l]||(a[l]=new i);for(l=0;l<o;l++)if(u=(E=n[l]).raycastResult.body){var c=a[l];this.getWheelTransformWorld(l).vectorToWorldFrame(d[this.indexRightAxis],c);var p=E.raycastResult.hitNormalWorld,h=c.dot(p);p.scale(h,e),c.vsub(e,c),c.normalize(),p.cross(c,s[l]),s[l].normalize(),E.sideImpulse=M(r,E.raycastResult.hitPointWorld,u,E.raycastResult.hitPointWorld,c),E.sideImpulse*=1}for(this.sliding=!1,l=0;l<o;l++){var u=(E=n[l]).raycastResult.body,f=0;if(E.slipInfo=1,u){var x=E.brake?E.brake:0;f=w(r,u,E.raycastResult.hitPointWorld,s[l],x);var b=x/(f+=E.engineForce*t);E.slipInfo*=b}if(E.forwardImpulse=0,E.skidInfo=1,u){E.skidInfo=1;var y=E.suspensionForce*t*E.frictionSlip,_=y*y;E.forwardImpulse=f;var P=.5*E.forwardImpulse,C=1*E.sideImpulse,z=P*P+C*C;E.sliding=!1,z>_&&(this.sliding=!0,E.sliding=!0,b=y/Math.sqrt(z),E.skidInfo*=b)}}if(this.sliding)for(l=0;l<o;l++)0!==(E=n[l]).sideImpulse&&E.skidInfo<1&&(E.forwardImpulse*=E.skidInfo,E.sideImpulse*=E.skidInfo);for(l=0;l<o;l++){var E=n[l],S=new i;if(S.copy(E.raycastResult.hitPointWorld),0!==E.forwardImpulse){var A=new i;s[l].scale(E.forwardImpulse,A),r.applyImpulse(A,S)}if(0!==E.sideImpulse){u=E.raycastResult.body;var L=new i;L.copy(E.raycastResult.hitPointWorld);var k=new i;a[l].scale(E.sideImpulse,k),r.pointToLocalFrame(S,S),S["xyz"[this.indexUpAxis]]*=E.rollInfluence,r.pointToWorldFrame(S,S),r.applyImpulse(k,S),k.scale(-1,k),u.applyImpulse(k,L)}}};var f=new i,x=new i,b=new i;function w(t,e,n,i,o){var r=0,s=n,a=f,l=x,c=b;return t.getVelocityAtWorldPoint(s,a),e.getVelocityAtWorldPoint(s,l),a.vsub(l,c),o<(r=-i.dot(c)*(1/(z(t,n,i)+z(e,n,i))))&&(r=o),r<-o&&(r=-o),r}var y=new i,_=new i,P=new i,C=new i;function z(t,e,n){var i=y,o=_,r=P,s=C;return e.vsub(t.position,i),i.cross(n,o),t.invInertiaWorld.vmult(o,s),s.cross(i,r),t.invMass+n.dot(r)}var E=new i,S=new i,A=new i;function M(t,e,n,i,o,r){if(o.norm2()>1.1)return 0;var s=E,a=S,l=A;return t.getVelocityAtWorldPoint(e,s),n.getVelocityAtWorldPoint(i,a),s.vsub(a,l),-.2*o.dot(l)*(1/(t.invMass+n.invMass))}},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(t,e,n){var i=t("./Body"),o=t("../shapes/Sphere"),r=t("../shapes/Box"),s=t("../math/Vec3"),a=t("../constraints/HingeConstraint");function l(t){if(this.wheelBodies=[],this.coordinateSystem=void 0===t.coordinateSystem?new s(1,2,3):t.coordinateSystem.clone(),this.chassisBody=t.chassisBody,!this.chassisBody){var e=new r(new s(5,2,.5));this.chassisBody=new i(1,e)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}e.exports=l,l.prototype.addWheel=function(t){var e=(t=t||{}).body;e||(e=new i(1,new o(1.2))),this.wheelBodies.push(e),this.wheelForces.push(0),new s;var n=void 0!==t.position?t.position.clone():new s,r=new s;this.chassisBody.pointToWorldFrame(n,r),e.position.set(r.x,r.y,r.z);var l=void 0!==t.axis?t.axis.clone():new s(0,1,0);this.wheelAxes.push(l);var c=new a(this.chassisBody,e,{pivotA:n,axisA:l,pivotB:s.ZERO,axisB:l,collideConnected:!1});return this.constraints.push(c),this.wheelBodies.length-1},l.prototype.setSteeringValue=function(t,e){var n=this.wheelAxes[e],i=Math.cos(t),o=Math.sin(t),r=n.x,s=n.y;this.constraints[e].axisA.set(i*r-o*s,o*r+i*s,0)},l.prototype.setMotorSpeed=function(t,e){var n=this.constraints[e];n.enableMotor(),n.motorTargetVelocity=t},l.prototype.disableMotor=function(t){this.constraints[t].disableMotor()};var c=new s;l.prototype.setWheelForce=function(t,e){this.wheelForces[e]=t},l.prototype.applyWheelForce=function(t,e){var n=this.wheelAxes[e],i=this.wheelBodies[e],o=i.torque;n.scale(t,c),i.vectorToWorldFrame(c,c),o.vadd(c,o)},l.prototype.addToWorld=function(t){for(var e=this.constraints,n=this.wheelBodies.concat([this.chassisBody]),i=0;i<n.length;i++)t.add(n[i]);for(i=0;i<e.length;i++)t.addConstraint(e[i]);t.addEventListener("preStep",this._update.bind(this))},l.prototype._update=function(){for(var t=this.wheelForces,e=0;e<t.length;e++)this.applyWheelForce(t[e],e)},l.prototype.removeFromWorld=function(t){for(var e=this.constraints,n=this.wheelBodies.concat([this.chassisBody]),i=0;i<n.length;i++)t.remove(n[i]);for(i=0;i<e.length;i++)t.removeConstraint(e[i])};var p=new s;l.prototype.getWheelSpeed=function(t){var e=this.wheelAxes[t],n=this.wheelBodies[t].angularVelocity;return this.chassisBody.vectorToWorldFrame(e,p),n.dot(p)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(t,e,n){e.exports=o,t("../shapes/Shape");var i=t("../math/Vec3");function o(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}t("../math/Quaternion"),t("../shapes/Particle"),t("../objects/Body"),t("../material/Material"),o.prototype.add=function(t){this.particles.push(t),this.neighbors.length<this.particles.length&&this.neighbors.push([])},o.prototype.remove=function(t){var e=this.particles.indexOf(t);-1!==e&&(this.particles.splice(e,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var r=new i;o.prototype.getNeighbors=function(t,e){for(var n=this.particles.length,i=t.id,o=this.smoothingRadius*this.smoothingRadius,s=r,a=0;a!==n;a++){var l=this.particles[a];l.position.vsub(t.position,s),i!==l.id&&s.norm2()<o&&e.push(l)}};var s=new i,a=new i,l=new i,c=new i,p=new i,h=new i;o.prototype.update=function(){for(var t=this.particles.length,e=s,n=this.speedOfSound,i=this.eps,o=0;o!==t;o++){var r=this.particles[o];(C=this.neighbors[o]).length=0,this.getNeighbors(r,C),C.push(this.particles[o]);for(var u=C.length,d=0,v=0;v!==u;v++){r.position.vsub(C[v].position,e);var m=e.norm(),g=this.w(m);d+=C[v].mass*g}this.densities[o]=d,this.pressures[o]=n*n*(this.densities[o]-this.density)}var f=a,x=l,b=c,w=p,y=h;for(o=0;o!==t;o++){var _,P,C,z=this.particles[o];for(f.set(0,0,0),x.set(0,0,0),u=(C=this.neighbors[o]).length,v=0;v!==u;v++){var E=C[v];z.position.vsub(E.position,w);var S=w.norm();_=-E.mass*(this.pressures[o]/(this.densities[o]*this.densities[o]+i)+this.pressures[v]/(this.densities[v]*this.densities[v]+i)),this.gradw(w,b),b.mult(_,b),f.vadd(b,f),E.velocity.vsub(z.velocity,y),y.mult(1/(1e-4+this.densities[o]*this.densities[v])*this.viscosity*E.mass,y),P=this.nablaw(S),y.mult(P,y),x.vadd(y,x)}x.mult(z.mass,x),f.mult(z.mass,f),z.force.vadd(x,z.force),z.force.vadd(f,z.force)}},o.prototype.w=function(t){var e=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(e,9))*Math.pow(e*e-t*t,3)},o.prototype.gradw=function(t,e){var n=t.norm(),i=this.smoothingRadius;t.mult(945/(32*Math.PI*Math.pow(i,9))*Math.pow(i*i-n*n,2),e)},o.prototype.nablaw=function(t){var e=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(e,9))*(e*e-t*t)*(7*t*t-3*e*e)}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(t,e,n){var i=t("../math/Vec3");function o(t,e,n){n=n||{},this.restLength="number"==typeof n.restLength?n.restLength:1,this.stiffness=n.stiffness||100,this.damping=n.damping||1,this.bodyA=t,this.bodyB=e,this.localAnchorA=new i,this.localAnchorB=new i,n.localAnchorA&&this.localAnchorA.copy(n.localAnchorA),n.localAnchorB&&this.localAnchorB.copy(n.localAnchorB),n.worldAnchorA&&this.setWorldAnchorA(n.worldAnchorA),n.worldAnchorB&&this.setWorldAnchorB(n.worldAnchorB)}e.exports=o,o.prototype.setWorldAnchorA=function(t){this.bodyA.pointToLocalFrame(t,this.localAnchorA)},o.prototype.setWorldAnchorB=function(t){this.bodyB.pointToLocalFrame(t,this.localAnchorB)},o.prototype.getWorldAnchorA=function(t){this.bodyA.pointToWorldFrame(this.localAnchorA,t)},o.prototype.getWorldAnchorB=function(t){this.bodyB.pointToWorldFrame(this.localAnchorB,t)};var r=new i,s=new i,a=new i,l=new i,c=new i,p=new i,h=new i,u=new i,d=new i,v=new i,m=new i;o.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,n=this.restLength,i=this.bodyA,o=this.bodyB,g=r,f=s,x=a,b=l,w=m,y=c,_=p,P=h,C=u,z=d,E=v;this.getWorldAnchorA(y),this.getWorldAnchorB(_),y.vsub(i.position,P),_.vsub(o.position,C),_.vsub(y,g);var S=g.norm();f.copy(g),f.normalize(),o.velocity.vsub(i.velocity,x),o.angularVelocity.cross(C,w),x.vadd(w,x),i.angularVelocity.cross(P,w),x.vsub(w,x),f.mult(-t*(S-n)-e*x.dot(f),b),i.force.vsub(b,i.force),o.force.vadd(b,o.force),P.cross(b,z),C.cross(b,E),i.torque.vsub(z,i.torque),o.torque.vadd(E,o.torque)}},{"../math/Vec3":30}],36:[function(t,e,n){var i=t("../math/Vec3"),o=t("../math/Transform"),r=t("../collision/RaycastResult"),s=t("../utils/Utils");function a(t){t=s.defaults(t,{chassisConnectionPointLocal:new i,chassisConnectionPointWorld:new i,directionLocal:new i,directionWorld:new i,axleLocal:new i,axleWorld:new i,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=t.maxSuspensionTravel,this.customSlidingRotationalSpeed=t.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=t.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=t.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=t.chassisConnectionPointWorld.clone(),this.directionLocal=t.directionLocal.clone(),this.directionWorld=t.directionWorld.clone(),this.axleLocal=t.axleLocal.clone(),this.axleWorld=t.axleWorld.clone(),this.suspensionRestLength=t.suspensionRestLength,this.suspensionMaxLength=t.suspensionMaxLength,this.radius=t.radius,this.suspensionStiffness=t.suspensionStiffness,this.dampingCompression=t.dampingCompression,this.dampingRelaxation=t.dampingRelaxation,this.frictionSlip=t.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=t.rollInfluence,this.maxSuspensionForce=t.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=t.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new r,this.worldTransform=new o,this.isInContact=!1}e.exports=a;var l=new i,c=new i;l=new i,a.prototype.updateWheel=function(t){var e=this.raycastResult;if(this.isInContact){var n=e.hitNormalWorld.dot(e.directionWorld);e.hitPointWorld.vsub(t.position,c),t.getVelocityAtWorldPoint(c,l);var i=e.hitNormalWorld.dot(l);if(n>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{var o=-1/n;this.suspensionRelativeVelocity=i*o,this.clippedInvContactDotSuspension=o}}else e.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,e.directionWorld.scale(-1,e.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(t,e,n){e.exports=s;var i=t("./Shape"),o=t("../math/Vec3"),r=t("./ConvexPolyhedron");function s(t){i.call(this),this.type=i.types.BOX,this.halfExtents=t,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}s.prototype=new i,s.prototype.constructor=s,s.prototype.updateConvexPolyhedronRepresentation=function(){var t=this.halfExtents.x,e=this.halfExtents.y,n=this.halfExtents.z,i=o,s=[new i(-t,-e,-n),new i(t,-e,-n),new i(t,e,-n),new i(-t,e,-n),new i(-t,-e,n),new i(t,-e,n),new i(t,e,n),new i(-t,e,n)],a=(new i(0,0,1),new i(0,1,0),new i(1,0,0),new r(s,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]));this.convexPolyhedronRepresentation=a,a.material=this.material},s.prototype.calculateLocalInertia=function(t,e){return e=e||new o,s.calculateInertia(this.halfExtents,t,e),e},s.calculateInertia=function(t,e,n){var i=t;n.x=1/12*e*(2*i.y*2*i.y+2*i.z*2*i.z),n.y=1/12*e*(2*i.x*2*i.x+2*i.z*2*i.z),n.z=1/12*e*(2*i.y*2*i.y+2*i.x*2*i.x)},s.prototype.getSideNormals=function(t,e){var n=t,i=this.halfExtents;if(n[0].set(i.x,0,0),n[1].set(0,i.y,0),n[2].set(0,0,i.z),n[3].set(-i.x,0,0),n[4].set(0,-i.y,0),n[5].set(0,0,-i.z),void 0!==e)for(var o=0;o!==n.length;o++)e.vmult(n[o],n[o]);return n},s.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},s.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var a=new o;new o,s.prototype.forEachWorldCorner=function(t,e,n){for(var i=this.halfExtents,o=[[i.x,i.y,i.z],[-i.x,i.y,i.z],[-i.x,-i.y,i.z],[-i.x,-i.y,-i.z],[i.x,-i.y,-i.z],[i.x,i.y,-i.z],[-i.x,i.y,-i.z],[i.x,-i.y,i.z]],r=0;r<o.length;r++)a.set(o[r][0],o[r][1],o[r][2]),e.vmult(a,a),t.vadd(a,a),n(a.x,a.y,a.z)};var l=[new o,new o,new o,new o,new o,new o,new o,new o];s.prototype.calculateWorldAABB=function(t,e,n,i){var o=this.halfExtents;l[0].set(o.x,o.y,o.z),l[1].set(-o.x,o.y,o.z),l[2].set(-o.x,-o.y,o.z),l[3].set(-o.x,-o.y,-o.z),l[4].set(o.x,-o.y,-o.z),l[5].set(o.x,o.y,-o.z),l[6].set(-o.x,o.y,-o.z),l[7].set(o.x,-o.y,o.z);var r=l[0];e.vmult(r,r),t.vadd(r,r),i.copy(r),n.copy(r);for(var s=1;s<8;s++){r=l[s],e.vmult(r,r),t.vadd(r,r);var a=r.x,c=r.y,p=r.z;a>i.x&&(i.x=a),c>i.y&&(i.y=c),p>i.z&&(i.z=p),a<n.x&&(n.x=a),c<n.y&&(n.y=c),p<n.z&&(n.z=p)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(t,e,n){e.exports=s;var i=t("./Shape"),o=t("../math/Vec3"),r=(t("../math/Quaternion"),t("../math/Transform"));function s(t,e,n){i.call(this),this.type=i.types.CONVEXPOLYHEDRON,this.vertices=t||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=e||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=n?n.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}s.prototype=new i,s.prototype.constructor=s;var a=new o;s.prototype.computeEdges=function(){var t=this.faces,e=this.vertices,n=(e.length,this.uniqueEdges);n.length=0;for(var i=a,o=0;o!==t.length;o++)for(var r=t[o],s=r.length,l=0;l!==s;l++){var c=(l+1)%s;e[r[l]].vsub(e[r[c]],i),i.normalize();for(var p=!1,h=0;h!==n.length;h++)if(n[h].almostEquals(i)||n[h].almostEquals(i)){p=!0;break}p||n.push(i.clone())}},s.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var t=0;t<this.faces.length;t++){for(var e=0;e<this.faces[t].length;e++)if(!this.vertices[this.faces[t][e]])throw new Error("Vertex "+this.faces[t][e]+" not found!");var n=this.faceNormals[t]||new o;this.getFaceNormal(t,n),n.negate(n),this.faceNormals[t]=n;var i=this.vertices[this.faces[t][0]];if(n.dot(i)<0)for(console.error(".faceNormals["+t+"] = Vec3("+n.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule."),e=0;e<this.faces[t].length;e++)console.warn(".vertices["+this.faces[t][e]+"] = Vec3("+this.vertices[this.faces[t][e]].toString()+")")}};var l=new o,c=new o;s.computeNormal=function(t,e,n,i){e.vsub(t,c),n.vsub(e,l),l.cross(c,i),i.isZero()||i.normalize()},s.prototype.getFaceNormal=function(t,e){var n=this.faces[t],i=this.vertices[n[0]],o=this.vertices[n[1]],r=this.vertices[n[2]];return s.computeNormal(i,o,r,e)};var p=new o;s.prototype.clipAgainstHull=function(t,e,n,i,r,s,a,l,c){for(var h=p,u=-1,d=-Number.MAX_VALUE,v=0;v<n.faces.length;v++){h.copy(n.faceNormals[v]),r.vmult(h,h);var m=h.dot(s);m>d&&(d=m,u=v)}for(var g=[],f=n.faces[u],x=f.length,b=0;b<x;b++){var w=n.vertices[f[b]],y=new o;y.copy(w),r.vmult(y,y),i.vadd(y,y),g.push(y)}u>=0&&this.clipFaceAgainstHull(s,t,e,g,a,l,c)};var h=new o,u=new o,d=new o,v=new o,m=new o,g=new o;s.prototype.findSeparatingAxis=function(t,e,n,i,o,r,s,a){var l=h,c=u,p=d,f=v,x=m,b=g,w=Number.MAX_VALUE,y=this;if(y.uniqueAxes)for(P=0;P!==y.uniqueAxes.length;P++){if(n.vmult(y.uniqueAxes[P],l),!1===(E=y.testSepAxis(l,t,e,n,i,o)))return!1;E<w&&(w=E,r.copy(l))}else for(var _=s?s.length:y.faces.length,P=0;P<_;P++){var C=s?s[P]:P;if(l.copy(y.faceNormals[C]),n.vmult(l,l),!1===(E=y.testSepAxis(l,t,e,n,i,o)))return!1;E<w&&(w=E,r.copy(l))}if(t.uniqueAxes)for(P=0;P!==t.uniqueAxes.length;P++){if(o.vmult(t.uniqueAxes[P],c),!1===(E=y.testSepAxis(c,t,e,n,i,o)))return!1;E<w&&(w=E,r.copy(c))}else{var z=a?a.length:t.faces.length;for(P=0;P<z;P++){var E;if(C=a?a[P]:P,c.copy(t.faceNormals[C]),o.vmult(c,c),!1===(E=y.testSepAxis(c,t,e,n,i,o)))return!1;E<w&&(w=E,r.copy(c))}}for(var S=0;S!==y.uniqueEdges.length;S++){n.vmult(y.uniqueEdges[S],f);for(var A=0;A!==t.uniqueEdges.length;A++)if(o.vmult(t.uniqueEdges[A],x),f.cross(x,b),!b.almostZero()){b.normalize();var M=y.testSepAxis(b,t,e,n,i,o);if(!1===M)return!1;M<w&&(w=M,r.copy(b))}}return i.vsub(e,p),p.dot(r)>0&&r.negate(r),!0};var f=[],x=[];s.prototype.testSepAxis=function(t,e,n,i,o,r){s.project(this,t,n,i,f),s.project(e,t,o,r,x);var a=f[0],l=f[1],c=x[0],p=x[1];if(a<p||c<l)return!1;var h=a-p,u=c-l;return h<u?h:u};var b=new o,w=new o;s.prototype.calculateLocalInertia=function(t,e){this.computeLocalAABB(b,w);var n=w.x-b.x,i=w.y-b.y,o=w.z-b.z;e.x=1/12*t*(2*i*2*i+2*o*2*o),e.y=1/12*t*(2*n*2*n+2*o*2*o),e.z=1/12*t*(2*i*2*i+2*n*2*n)},s.prototype.getPlaneConstantOfFace=function(t){var e=this.faces[t],n=this.faceNormals[t],i=this.vertices[e[0]];return-n.dot(i)};var y=new o,_=new o,P=new o,C=new o,z=new o,E=new o,S=new o,A=new o;s.prototype.clipFaceAgainstHull=function(t,e,n,i,o,r,s){for(var a=y,l=_,c=P,p=C,h=z,u=E,d=S,v=A,m=this,g=i,f=[],x=-1,b=Number.MAX_VALUE,w=0;w<m.faces.length;w++){a.copy(m.faceNormals[w]),n.vmult(a,a);var M=a.dot(t);M<b&&(b=M,x=w)}if(!(x<0)){var L=m.faces[x];L.connectedFaces=[];for(var k=0;k<m.faces.length;k++)for(var V=0;V<m.faces[k].length;V++)-1!==L.indexOf(m.faces[k][V])&&k!==x&&-1===L.connectedFaces.indexOf(k)&&L.connectedFaces.push(k);g.length;for(var B=L.length,R=0;R<B;R++){var T=m.vertices[L[R]],I=m.vertices[L[(R+1)%B]];T.vsub(I,l),c.copy(l),n.vmult(c,c),e.vadd(c,c),p.copy(this.faceNormals[x]),n.vmult(p,p),e.vadd(p,p),c.cross(p,h),h.negate(h),u.copy(T),n.vmult(u,u),e.vadd(u,u),u.dot(h);var F=L.connectedFaces[R];d.copy(this.faceNormals[F]);var q=this.getPlaneConstantOfFace(F);v.copy(d),n.vmult(v,v);var N=q-v.dot(e);for(this.clipFaceAgainstPlane(g,f,v,N);g.length;)g.shift();for(;f.length;)g.push(f.shift())}for(d.copy(this.faceNormals[x]),q=this.getPlaneConstantOfFace(x),v.copy(d),n.vmult(v,v),N=q-v.dot(e),k=0;k<g.length;k++){var j=v.dot(g[k])+N;if(j<=o&&(console.log("clamped: depth="+j+" to minDist="+o),j=o),j<=r){var D=g[k];if(j<=0){var O={point:D,normal:v,depth:j};s.push(O)}}}}},s.prototype.clipFaceAgainstPlane=function(t,e,n,i){var r,s,a=t.length;if(a<2)return e;var l=t[t.length-1],c=t[0];r=n.dot(l)+i;for(var p=0;p<a;p++){if(c=t[p],s=n.dot(c)+i,r<0)if(s<0)(h=new o).copy(c),e.push(h);else{var h=new o;l.lerp(c,r/(r-s),h),e.push(h)}else s<0&&(h=new o,l.lerp(c,r/(r-s),h),e.push(h),e.push(c));l=c,r=s}return e},s.prototype.computeWorldVertices=function(t,e){for(var n=this.vertices.length;this.worldVertices.length<n;)this.worldVertices.push(new o);for(var i=this.vertices,r=this.worldVertices,s=0;s!==n;s++)e.vmult(i[s],r[s]),t.vadd(r[s],r[s]);this.worldVerticesNeedsUpdate=!1},new o,s.prototype.computeLocalAABB=function(t,e){var n=this.vertices.length,i=this.vertices;t.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var o=0;o<n;o++){var r=i[o];r.x<t.x?t.x=r.x:r.x>e.x&&(e.x=r.x),r.y<t.y?t.y=r.y:r.y>e.y&&(e.y=r.y),r.z<t.z?t.z=r.z:r.z>e.z&&(e.z=r.z)}},s.prototype.computeWorldFaceNormals=function(t){for(var e=this.faceNormals.length;this.worldFaceNormals.length<e;)this.worldFaceNormals.push(new o);for(var n=this.faceNormals,i=this.worldFaceNormals,r=0;r!==e;r++)t.vmult(n[r],i[r]);this.worldFaceNormalsNeedsUpdate=!1},s.prototype.updateBoundingSphereRadius=function(){for(var t=0,e=this.vertices,n=0,i=e.length;n!==i;n++){var o=e[n].norm2();o>t&&(t=o)}this.boundingSphereRadius=Math.sqrt(t)};var M=new o;s.prototype.calculateWorldAABB=function(t,e,n,i){for(var o,r,s,a,l,c,p=this.vertices.length,h=this.vertices,u=0;u<p;u++){M.copy(h[u]),e.vmult(M,M),t.vadd(M,M);var d=M;d.x<o||void 0===o?o=d.x:(d.x>a||void 0===a)&&(a=d.x),d.y<r||void 0===r?r=d.y:(d.y>l||void 0===l)&&(l=d.y),d.z<s||void 0===s?s=d.z:(d.z>c||void 0===c)&&(c=d.z)}n.set(o,r,s),i.set(a,l,c)},s.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},s.prototype.getAveragePointLocal=function(t){t=t||new o;for(var e=this.vertices.length,n=this.vertices,i=0;i<e;i++)t.vadd(n[i],t);return t.mult(1/e,t),t},s.prototype.transformAllPoints=function(t,e){var n=this.vertices.length,i=this.vertices;if(e){for(var o=0;o<n;o++){var r=i[o];e.vmult(r,r)}for(o=0;o<this.faceNormals.length;o++)r=this.faceNormals[o],e.vmult(r,r)}if(t)for(o=0;o<n;o++)(r=i[o]).vadd(t,r)};var L=new o,k=new o,V=new o;s.prototype.pointIsInside=function(t){var e=this.vertices.length,n=this.vertices,i=this.faces,o=this.faceNormals,r=this.faces.length,s=L;this.getAveragePointLocal(s);for(var a=0;a<r;a++){this.faces[a].length,e=o[a];var l=n[i[a][0]],c=k;t.vsub(l,c);var p=e.dot(c),h=V;s.vsub(l,h);var u=e.dot(h);if(p<0&&u>0||p>0&&u<0)return!1}return-1},new o;var B=new o,R=new o;s.project=function(t,e,n,i,o){var s=t.vertices.length,a=B,l=0,c=0,p=R,h=t.vertices;p.setZero(),r.vectorToLocalFrame(n,i,e,a),r.pointToLocalFrame(n,i,p,p);var u=p.dot(a);c=l=h[0].dot(a);for(var d=1;d<s;d++){var v=h[d].dot(a);v>l&&(l=v),v<c&&(c=v)}if((c-=u)>(l-=u)){var m=c;c=l,l=m}o[0]=l,o[1]=c}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(t,e,n){e.exports=s;var i=t("./Shape"),o=t("../math/Vec3"),r=(t("../math/Quaternion"),t("./ConvexPolyhedron"));function s(t,e,n,s){var a=s,l=[],c=[],p=[],h=[],u=[],d=Math.cos,v=Math.sin;l.push(new o(e*d(0),e*v(0),.5*-n)),h.push(0),l.push(new o(t*d(0),t*v(0),.5*n)),u.push(1);for(var m=0;m<a;m++){var g=2*Math.PI/a*(m+1),f=2*Math.PI/a*(m+.5);m<a-1?(l.push(new o(e*d(g),e*v(g),.5*-n)),h.push(2*m+2),l.push(new o(t*d(g),t*v(g),.5*n)),u.push(2*m+3),p.push([2*m+2,2*m+3,2*m+1,2*m])):p.push([0,1,2*m+1,2*m]),(a%2==1||m<a/2)&&c.push(new o(d(f),v(f),0))}p.push(u),c.push(new o(0,0,1));var x=[];for(m=0;m<h.length;m++)x.push(h[h.length-m-1]);p.push(x),this.type=i.types.CONVEXPOLYHEDRON,r.call(this,l,p,c)}s.prototype=new r},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(t,e,n){var i=t("./Shape"),o=t("./ConvexPolyhedron"),r=t("../math/Vec3"),s=t("../utils/Utils");function a(t,e){e=s.defaults(e,{maxValue:null,minValue:null,elementSize:1}),this.data=t,this.maxValue=e.maxValue,this.minValue=e.minValue,this.elementSize=e.elementSize,null===e.minValue&&this.updateMinValue(),null===e.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,i.call(this),this.pillarConvex=new o,this.pillarOffset=new r,this.type=i.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}e.exports=a,a.prototype=new i,a.prototype.update=function(){this._cachedPillars={}},a.prototype.updateMinValue=function(){for(var t=this.data,e=t[0][0],n=0;n!==t.length;n++)for(var i=0;i!==t[n].length;i++){var o=t[n][i];o<e&&(e=o)}this.minValue=e},a.prototype.updateMaxValue=function(){for(var t=this.data,e=t[0][0],n=0;n!==t.length;n++)for(var i=0;i!==t[n].length;i++){var o=t[n][i];o>e&&(e=o)}this.maxValue=e},a.prototype.setHeightValueAtIndex=function(t,e,n){this.data[t][e]=n,this.clearCachedConvexTrianglePillar(t,e,!1),t>0&&(this.clearCachedConvexTrianglePillar(t-1,e,!0),this.clearCachedConvexTrianglePillar(t-1,e,!1)),e>0&&(this.clearCachedConvexTrianglePillar(t,e-1,!0),this.clearCachedConvexTrianglePillar(t,e-1,!1)),e>0&&t>0&&this.clearCachedConvexTrianglePillar(t-1,e-1,!0)},a.prototype.getRectMinMax=function(t,e,n,i,o){o=o||[];for(var r=this.data,s=this.minValue,a=t;a<=n;a++)for(var l=e;l<=i;l++){var c=r[a][l];c>s&&(s=c)}o[0]=this.minValue,o[1]=s},a.prototype.getIndexOfPosition=function(t,e,n,i){var o=this.elementSize,r=this.data,s=Math.floor(t/o),a=Math.floor(e/o);return n[0]=s,n[1]=a,i&&(s<0&&(s=0),a<0&&(a=0),s>=r.length-1&&(s=r.length-1),a>=r[0].length-1&&(a=r[0].length-1)),!(s<0||a<0||s>=r.length-1||a>=r[0].length-1)},a.prototype.getHeightAt=function(t,e,n){var i=[];this.getIndexOfPosition(t,e,i,n);var o=[];return this.getRectMinMax(i[0],i[1]+1,i[0],i[1]+1,o),(o[0]+o[1])/2},a.prototype.getCacheConvexTrianglePillarKey=function(t,e,n){return t+"_"+e+"_"+(n?1:0)},a.prototype.getCachedConvexTrianglePillar=function(t,e,n){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]},a.prototype.setCachedConvexTrianglePillar=function(t,e,n,i,o){this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]={convex:i,offset:o}},a.prototype.clearCachedConvexTrianglePillar=function(t,e,n){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]},a.prototype.getConvexTrianglePillar=function(t,e,n){var i=this.pillarConvex,s=this.pillarOffset;if(this.cacheEnabled){if(a=this.getCachedConvexTrianglePillar(t,e,n))return this.pillarConvex=a.convex,void(this.pillarOffset=a.offset);i=new o,s=new r,this.pillarConvex=i,this.pillarOffset=s}var a=this.data,l=this.elementSize,c=i.faces;i.vertices.length=6;for(var p=0;p<6;p++)i.vertices[p]||(i.vertices[p]=new r);for(c.length=5,p=0;p<5;p++)c[p]||(c[p]=[]);var h=i.vertices,u=(Math.min(a[t][e],a[t+1][e],a[t][e+1],a[t+1][e+1])-this.minValue)/2+this.minValue;n?(s.set((t+.75)*l,(e+.75)*l,u),h[0].set(.25*l,.25*l,a[t+1][e+1]-u),h[1].set(-.75*l,.25*l,a[t][e+1]-u),h[2].set(.25*l,-.75*l,a[t+1][e]-u),h[3].set(.25*l,.25*l,-u-1),h[4].set(-.75*l,.25*l,-u-1),h[5].set(.25*l,-.75*l,-u-1),c[0][0]=0,c[0][1]=1,c[0][2]=2,c[1][0]=5,c[1][1]=4,c[1][2]=3,c[2][0]=2,c[2][1]=5,c[2][2]=3,c[2][3]=0,c[3][0]=3,c[3][1]=4,c[3][2]=1,c[3][3]=0,c[4][0]=1,c[4][1]=4,c[4][2]=5,c[4][3]=2):(s.set((t+.25)*l,(e+.25)*l,u),h[0].set(-.25*l,-.25*l,a[t][e]-u),h[1].set(.75*l,-.25*l,a[t+1][e]-u),h[2].set(-.25*l,.75*l,a[t][e+1]-u),h[3].set(-.25*l,-.25*l,-u-1),h[4].set(.75*l,-.25*l,-u-1),h[5].set(-.25*l,.75*l,-u-1),c[0][0]=0,c[0][1]=1,c[0][2]=2,c[1][0]=5,c[1][1]=4,c[1][2]=3,c[2][0]=0,c[2][1]=2,c[2][2]=5,c[2][3]=3,c[3][0]=1,c[3][1]=0,c[3][2]=3,c[3][3]=4,c[4][0]=4,c[4][1]=5,c[4][2]=2,c[4][3]=1),i.computeNormals(),i.computeEdges(),i.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(t,e,n,i,s)},a.prototype.calculateLocalInertia=function(t,e){return(e=e||new r).set(0,0,0),e},a.prototype.volume=function(){return Number.MAX_VALUE},a.prototype.calculateWorldAABB=function(t,e,n,i){n.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),i.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},a.prototype.updateBoundingSphereRadius=function(){var t=this.data,e=this.elementSize;this.boundingSphereRadius=new r(t.length*e,t[0].length*e,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(t,e,n){e.exports=r;var i=t("./Shape"),o=t("../math/Vec3");function r(){i.call(this),this.type=i.types.PARTICLE}r.prototype=new i,r.prototype.constructor=r,r.prototype.calculateLocalInertia=function(t,e){return(e=e||new o).set(0,0,0),e},r.prototype.volume=function(){return 0},r.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},r.prototype.calculateWorldAABB=function(t,e,n,i){n.copy(t),i.copy(t)}},{"../math/Vec3":30,"./Shape":43}],42:[function(t,e,n){e.exports=r;var i=t("./Shape"),o=t("../math/Vec3");function r(){i.call(this),this.type=i.types.PLANE,this.worldNormal=new o,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}r.prototype=new i,r.prototype.constructor=r,r.prototype.computeWorldNormal=function(t){var e=this.worldNormal;e.set(0,0,1),t.vmult(e,e),this.worldNormalNeedsUpdate=!1},r.prototype.calculateLocalInertia=function(t,e){return e||new o},r.prototype.volume=function(){return Number.MAX_VALUE};var s=new o;r.prototype.calculateWorldAABB=function(t,e,n,i){s.set(0,0,1),e.vmult(s,s);var o=Number.MAX_VALUE;n.set(-o,-o,-o),i.set(o,o,o),1===s.x&&(i.x=t.x),1===s.y&&(i.y=t.y),1===s.z&&(i.z=t.z),-1===s.x&&(n.x=t.x),-1===s.y&&(n.y=t.y),-1===s.z&&(n.z=t.z)},r.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(t,e,n){e.exports=i;var i=t("./Shape");function i(){this.id=i.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}t("../math/Vec3"),t("../math/Quaternion"),t("../material/Material"),i.prototype.constructor=i,i.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},i.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},i.prototype.calculateLocalInertia=function(t,e){throw"calculateLocalInertia() not implemented for shape type "+this.type},i.idCounter=0,i.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(t,e,n){e.exports=r;var i=t("./Shape"),o=t("../math/Vec3");function r(t){if(i.call(this),this.radius=void 0!==t?Number(t):1,this.type=i.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}r.prototype=new i,r.prototype.constructor=r,r.prototype.calculateLocalInertia=function(t,e){e=e||new o;var n=2*t*this.radius*this.radius/5;return e.x=n,e.y=n,e.z=n,e},r.prototype.volume=function(){return 4*Math.PI*this.radius/3},r.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},r.prototype.calculateWorldAABB=function(t,e,n,i){for(var o=this.radius,r=["x","y","z"],s=0;s<r.length;s++){var a=r[s];n[a]=t[a]-o,i[a]=t[a]+o}}},{"../math/Vec3":30,"./Shape":43}],45:[function(t,e,n){e.exports=l;var i=t("./Shape"),o=t("../math/Vec3"),r=(t("../math/Quaternion"),t("../math/Transform")),s=t("../collision/AABB"),a=t("../utils/Octree");function l(t,e){i.call(this),this.type=i.types.TRIMESH,this.vertices=new Float32Array(t),this.indices=new Int16Array(e),this.normals=new Float32Array(e.length),this.aabb=new s,this.edges=null,this.scale=new o(1,1,1),this.tree=new a,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}l.prototype=new i,l.prototype.constructor=l;var c=new o;l.prototype.updateTree=function(){var t=this.tree;t.reset(),t.aabb.copy(this.aabb);var e=this.scale;t.aabb.lowerBound.x*=1/e.x,t.aabb.lowerBound.y*=1/e.y,t.aabb.lowerBound.z*=1/e.z,t.aabb.upperBound.x*=1/e.x,t.aabb.upperBound.y*=1/e.y,t.aabb.upperBound.z*=1/e.z;for(var n=new s,i=new o,r=new o,a=new o,l=[i,r,a],c=0;c<this.indices.length/3;c++){var p=3*c;this._getUnscaledVertex(this.indices[p],i),this._getUnscaledVertex(this.indices[p+1],r),this._getUnscaledVertex(this.indices[p+2],a),n.setFromPoints(l),t.insert(n,c)}t.removeEmptyNodes()};var p=new s;l.prototype.getTrianglesInAABB=function(t,e){p.copy(t);var n=this.scale,i=n.x,o=n.y,r=n.z,s=p.lowerBound,a=p.upperBound;return s.x/=i,s.y/=o,s.z/=r,a.x/=i,a.y/=o,a.z/=r,this.tree.aabbQuery(p,e)},l.prototype.setScale=function(t){var e=this.scale.x===this.scale.y===this.scale.z,n=t.x===t.y===t.z;e&&n||this.updateNormals(),this.scale.copy(t),this.updateAABB(),this.updateBoundingSphereRadius()},l.prototype.updateNormals=function(){for(var t=c,e=this.normals,n=0;n<this.indices.length/3;n++){var i=3*n,o=this.indices[i],r=this.indices[i+1],s=this.indices[i+2];this.getVertex(o,m),this.getVertex(r,g),this.getVertex(s,f),l.computeNormal(g,m,f,t),e[i]=t.x,e[i+1]=t.y,e[i+2]=t.z}},l.prototype.updateEdges=function(){for(var t={},e=function(e,n){t[o<r?o+"_"+r:r+"_"+o]=!0},n=0;n<this.indices.length/3;n++){var i=3*n,o=this.indices[i],r=this.indices[i+1];this.indices[i+2];e(),e(),e()}var s=Object.keys(t);for(this.edges=new Int16Array(2*s.length),n=0;n<s.length;n++){var a=s[n].split("_");this.edges[2*n]=parseInt(a[0],10),this.edges[2*n+1]=parseInt(a[1],10)}},l.prototype.getEdgeVertex=function(t,e,n){var i=this.edges[2*t+(e?1:0)];this.getVertex(i,n)};var h=new o,u=new o;l.prototype.getEdgeVector=function(t,e){var n=h,i=u;this.getEdgeVertex(t,0,n),this.getEdgeVertex(t,1,i),i.vsub(n,e)};var d=new o,v=new o;l.computeNormal=function(t,e,n,i){e.vsub(t,v),n.vsub(e,d),d.cross(v,i),i.isZero()||i.normalize()};var m=new o,g=new o,f=new o;l.prototype.getVertex=function(t,e){var n=this.scale;return this._getUnscaledVertex(t,e),e.x*=n.x,e.y*=n.y,e.z*=n.z,e},l.prototype._getUnscaledVertex=function(t,e){var n=3*t,i=this.vertices;return e.set(i[n],i[n+1],i[n+2])},l.prototype.getWorldVertex=function(t,e,n,i){return this.getVertex(t,i),r.pointToWorldFrame(e,n,i,i),i},l.prototype.getTriangleVertices=function(t,e,n,i){var o=3*t;this.getVertex(this.indices[o],e),this.getVertex(this.indices[o+1],n),this.getVertex(this.indices[o+2],i)},l.prototype.getNormal=function(t,e){var n=3*t;return e.set(this.normals[n],this.normals[n+1],this.normals[n+2])};var x=new s;l.prototype.calculateLocalInertia=function(t,e){this.computeLocalAABB(x);var n=x.upperBound.x-x.lowerBound.x,i=x.upperBound.y-x.lowerBound.y,o=x.upperBound.z-x.lowerBound.z;return e.set(1/12*t*(2*i*2*i+2*o*2*o),1/12*t*(2*n*2*n+2*o*2*o),1/12*t*(2*i*2*i+2*n*2*n))};var b=new o;l.prototype.computeLocalAABB=function(t){var e=t.lowerBound,n=t.upperBound,i=this.vertices.length,o=(this.vertices,b);this.getVertex(0,o),e.copy(o),n.copy(o);for(var r=0;r!==i;r++)this.getVertex(r,o),o.x<e.x?e.x=o.x:o.x>n.x&&(n.x=o.x),o.y<e.y?e.y=o.y:o.y>n.y&&(n.y=o.y),o.z<e.z?e.z=o.z:o.z>n.z&&(n.z=o.z)},l.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},l.prototype.updateBoundingSphereRadius=function(){for(var t=0,e=this.vertices,n=new o,i=0,r=e.length/3;i!==r;i++){this.getVertex(i,n);var s=n.norm2();s>t&&(t=s)}this.boundingSphereRadius=Math.sqrt(t)},new o;var w=new r,y=new s;l.prototype.calculateWorldAABB=function(t,e,n,i){var o=w,r=y;o.position=t,o.quaternion=e,this.aabb.toWorldFrame(o,r),n.copy(r.lowerBound),i.copy(r.upperBound)},l.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},l.createTorus=function(t,e,n,i,o){t=t||1,e=e||.5,n=n||8,i=i||6,o=o||2*Math.PI;for(var r=[],s=[],a=0;a<=n;a++)for(var c=0;c<=i;c++){var p=c/i*o,h=a/n*Math.PI*2,u=(t+e*Math.cos(h))*Math.cos(p),d=(t+e*Math.cos(h))*Math.sin(p),v=e*Math.sin(h);r.push(u,d,v)}for(a=1;a<=n;a++)for(c=1;c<=i;c++){var m=(i+1)*a+c-1,g=(i+1)*(a-1)+c-1,f=(i+1)*(a-1)+c,x=(i+1)*a+c;s.push(m,g,x),s.push(g,f,x)}return new l(r,s)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(t,e,n){e.exports=o,t("../math/Vec3"),t("../math/Quaternion");var i=t("./Solver");function o(){i.call(this),this.iterations=10,this.tolerance=1e-7}o.prototype=new i;var r=[],s=[],a=[];o.prototype.solve=function(t,e){var n,i,o,l,c,p=0,h=this.iterations,u=this.tolerance*this.tolerance,d=this.equations,v=d.length,m=e.bodies,g=m.length,f=t;if(0!==v)for(var x=0;x!==g;x++)m[x].updateSolveMassProperties();var b=s,w=a,y=r;for(b.length=v,w.length=v,y.length=v,x=0;x!==v;x++){var _=d[x];y[x]=0,w[x]=_.computeB(f),b[x]=1/_.computeC()}if(0!==v){for(x=0;x!==g;x++){var P=(E=m[x]).vlambda,C=E.wlambda;P.set(0,0,0),C&&C.set(0,0,0)}for(p=0;p!==h;p++){l=0;for(var z=0;z!==v;z++)_=d[z],n=w[z],i=b[z],(c=y[z])+(o=i*(n-_.computeGWlambda()-_.eps*c))<_.minForce?o=_.minForce-c:c+o>_.maxForce&&(o=_.maxForce-c),y[z]+=o,l+=o>0?o:-o,_.addToWlambda(o);if(l*l<u)break}for(x=0;x!==g;x++){var E,S=(E=m[x]).velocity,A=E.angularVelocity;S.vadd(E.vlambda,S),A&&A.vadd(E.wlambda,A)}}return p}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(t,e,n){function i(){this.equations=[]}e.exports=i,i.prototype.solve=function(t,e){return 0},i.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},i.prototype.removeEquation=function(t){var e=this.equations,n=e.indexOf(t);-1!==n&&e.splice(n,1)},i.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(t,e,n){e.exports=r,t("../math/Vec3"),t("../math/Quaternion");var i=t("./Solver"),o=t("../objects/Body");function r(t){for(i.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=t,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}r.prototype=new i;var s=[],a=[],l={bodies:[]},c=o.STATIC;function p(t){for(var e=t.length,n=0;n!==e;n++){var i=t[n];if(!(i.visited||i.body.type&c))return i}return!1}var h=[];function u(t,e,n,i){for(h.push(t),t.visited=!0,e(t,n,i);h.length;)for(var o,r=h.pop();o=p(r.children);)o.visited=!0,e(o,n,i),h.push(o)}function d(t,e,n){e.push(t.body);for(var i=t.eqs.length,o=0;o!==i;o++){var r=t.eqs[o];-1===n.indexOf(r)&&n.push(r)}}function v(t,e){return e.id-t.id}r.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},r.prototype.solve=function(t,e){for(var n=s,i=this.nodePool,o=e.bodies,r=this.equations,c=r.length,h=o.length,m=this.subsolver;i.length<h;)i.push(this.createNode());n.length=h;for(var g=0;g<h;g++)n[g]=i[g];for(g=0;g!==h;g++){var f=n[g];f.body=o[g],f.children.length=0,f.eqs.length=0,f.visited=!1}for(var x=0;x!==c;x++){var b=r[x],w=(g=o.indexOf(b.bi),o.indexOf(b.bj)),y=n[g],_=n[w];y.children.push(_),y.eqs.push(b),_.children.push(y),_.eqs.push(b)}var P,C=0,z=a;m.tolerance=this.tolerance,m.iterations=this.iterations;for(var E=l;P=p(n);){z.length=0,E.bodies.length=0,u(P,d,E.bodies,z);var S=z.length;for(z=z.sort(v),g=0;g!==S;g++)m.addEquation(z[g]);m.solve(t,E),m.removeAllEquations(),C++}return C}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(t,e,n){var i=function(){};e.exports=i,i.prototype={constructor:i,addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;return void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e),this},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){if(void 0===this._listeners)return this;var n=this._listeners;if(void 0===n[t])return this;var i=n[t].indexOf(e);return-1!==i&&n[t].splice(i,1),this},dispatchEvent:function(t){if(void 0===this._listeners)return this;var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var n=0,i=e.length;n<i;n++)e[n].call(this,t)}return this}}},{}],50:[function(t,e,n){var i=t("../collision/AABB"),o=t("../math/Vec3");function r(t){t=t||{},this.root=t.root||null,this.aabb=t.aabb?t.aabb.clone():new i,this.data=[],this.children=[]}function s(t,e){(e=e||{}).root=null,e.aabb=t,r.call(this,e),this.maxDepth=void 0!==e.maxDepth?e.maxDepth:8}e.exports=s,s.prototype=new r,r.prototype.reset=function(t,e){this.children.length=this.data.length=0},r.prototype.insert=function(t,e,n){var i=this.data;if(n=n||0,!this.aabb.contains(t))return!1;var o=this.children;if(n<(this.maxDepth||this.root.maxDepth)){var r=!1;o.length||(this.subdivide(),r=!0);for(var s=0;8!==s;s++)if(o[s].insert(t,e,n+1))return!0;r&&(o.length=0)}return i.push(e),!0};var a=new o;r.prototype.subdivide=function(){var t=this.aabb,e=t.lowerBound,n=t.upperBound,s=this.children;s.push(new r({aabb:new i({lowerBound:new o(0,0,0)})}),new r({aabb:new i({lowerBound:new o(1,0,0)})}),new r({aabb:new i({lowerBound:new o(1,1,0)})}),new r({aabb:new i({lowerBound:new o(1,1,1)})}),new r({aabb:new i({lowerBound:new o(0,1,1)})}),new r({aabb:new i({lowerBound:new o(0,0,1)})}),new r({aabb:new i({lowerBound:new o(1,0,1)})}),new r({aabb:new i({lowerBound:new o(0,1,0)})})),n.vsub(e,a),a.scale(.5,a);for(var l=this.root||this,c=0;8!==c;c++){var p=s[c];p.root=l;var h=p.aabb.lowerBound;h.x*=a.x,h.y*=a.y,h.z*=a.z,h.vadd(e,h),h.vadd(a,p.aabb.upperBound)}},r.prototype.aabbQuery=function(t,e){this.data,this.children;for(var n=[this];n.length;){var i=n.pop();i.aabb.overlaps(t)&&Array.prototype.push.apply(e,i.data),Array.prototype.push.apply(n,i.children)}return e};var l=new i;r.prototype.rayQuery=function(t,e,n){return t.getAABB(l),l.toLocalFrame(e,l),this.aabbQuery(l,n),n},r.prototype.removeEmptyNodes=function(){for(var t=[this];t.length;){for(var e=t.pop(),n=e.children.length-1;n>=0;n--)e.children[n].data.length||e.children.splice(n,1);Array.prototype.push.apply(t,e.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(t,e,n){function i(){this.objects=[],this.type=Object}e.exports=i,i.prototype.release=function(){for(var t=arguments.length,e=0;e!==t;e++)this.objects.push(arguments[e])},i.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},i.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(t,e,n){function i(){this.data={keys:[]}}e.exports=i,i.prototype.get=function(t,e){if(t>e){var n=e;e=t,t=n}return this.data[t+"-"+e]},i.prototype.set=function(t,e,n){if(t>e){var i=e;e=t,t=i}var o=t+"-"+e;this.get(t,e)||this.data.keys.push(o),this.data[o]=n},i.prototype.reset=function(){for(var t=this.data,e=t.keys;e.length>0;)delete t[e.pop()]}},{}],53:[function(t,e,n){function i(){}e.exports=i,i.defaults=function(t,e){for(var n in t=t||{},e)n in t||(t[n]=e[n]);return t}},{}],54:[function(t,e,n){e.exports=r;var i=t("../math/Vec3"),o=t("./Pool");function r(){o.call(this),this.type=i}r.prototype=new o,r.prototype.constructObject=function(){return new i}},{"../math/Vec3":30,"./Pool":51}],55:[function(t,e,n){e.exports=u;var i=t("../collision/AABB"),o=t("../shapes/Shape"),r=t("../collision/Ray"),s=t("../math/Vec3"),a=t("../math/Transform"),l=(t("../shapes/ConvexPolyhedron"),t("../math/Quaternion")),c=(t("../solver/Solver"),t("../utils/Vec3Pool")),p=t("../equations/ContactEquation"),h=t("../equations/FrictionEquation");function u(t){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new c,this.world=t,this.currentContactMaterial=null,this.enableFrictionReduction=!1}u.prototype.createContactEquation=function(t,e,n,i,o,r){var s;this.contactPointPool.length?((s=this.contactPointPool.pop()).bi=t,s.bj=e):s=new p(t,e),s.enabled=t.collisionResponse&&e.collisionResponse&&n.collisionResponse&&i.collisionResponse;var a=this.currentContactMaterial;s.restitution=a.restitution,s.setSpookParams(a.contactEquationStiffness,a.contactEquationRelaxation,this.world.dt);var l=n.material||t.material,c=i.material||e.material;return l&&c&&l.restitution>=0&&c.restitution>=0&&(s.restitution=l.restitution*c.restitution),s.si=o||n,s.sj=r||i,s},u.prototype.createFrictionEquationsFromContact=function(t,e){var n=t.bi,i=t.bj,o=t.si,r=t.sj,s=this.world,a=this.currentContactMaterial,l=a.friction,c=o.material||n.material,p=r.material||i.material;if(c&&p&&c.friction>=0&&p.friction>=0&&(l=c.friction*p.friction),l>0){var u=l*s.gravity.length(),d=n.invMass+i.invMass;d>0&&(d=1/d);var v=this.frictionEquationPool,m=v.length?v.pop():new h(n,i,u*d),g=v.length?v.pop():new h(n,i,u*d);return m.bi=g.bi=n,m.bj=g.bj=i,m.minForce=g.minForce=-u*d,m.maxForce=g.maxForce=u*d,m.ri.copy(t.ri),m.rj.copy(t.rj),g.ri.copy(t.ri),g.rj.copy(t.rj),t.ni.tangents(m.t,g.t),m.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,s.dt),g.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,s.dt),m.enabled=g.enabled=t.enabled,e.push(m,g),!0}return!1};var d=new s,v=new s,m=new s;u.prototype.createFrictionFromAverage=function(t){var e=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(e,this.frictionResult)&&1!==t){var n=this.frictionResult[this.frictionResult.length-2],i=this.frictionResult[this.frictionResult.length-1];d.setZero(),v.setZero(),m.setZero();for(var o=e.bi,r=(e.bj,0);r!==t;r++)(e=this.result[this.result.length-1-r]).bodyA!==o?(d.vadd(e.ni,d),v.vadd(e.ri,v),m.vadd(e.rj,m)):(d.vsub(e.ni,d),v.vadd(e.rj,v),m.vadd(e.ri,m));var s=1/t;v.scale(s,n.ri),m.scale(s,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),d.normalize(),d.tangents(n.t,i.t)}};var g=new s,f=new s,x=new l,b=new l;u.prototype.getContacts=function(t,e,n,i,o,r,s){this.contactPointPool=o,this.frictionEquationPool=s,this.result=i,this.frictionResult=r;for(var a=x,l=b,c=g,p=f,h=0,u=t.length;h!==u;h++){var d=t[h],v=e[h],m=null;d.material&&v.material&&(m=n.getContactMaterial(d.material,v.material)||null);for(var w=0;w<d.shapes.length;w++){d.quaternion.mult(d.shapeOrientations[w],a),d.quaternion.vmult(d.shapeOffsets[w],c),c.vadd(d.position,c);for(var y=d.shapes[w],_=0;_<v.shapes.length;_++){v.quaternion.mult(v.shapeOrientations[_],l),v.quaternion.vmult(v.shapeOffsets[_],p),p.vadd(v.position,p);var P=v.shapes[_];if(!(c.distanceTo(p)>y.boundingSphereRadius+P.boundingSphereRadius)){var C=null;y.material&&P.material&&(C=n.getContactMaterial(y.material,P.material)||null),this.currentContactMaterial=C||m||n.defaultContactMaterial;var z=this[y.type|P.type];z&&(y.type<P.type?z.call(this,y,P,c,p,a,l,d,v,y,P):z.call(this,P,y,p,c,l,a,v,d,y,P))}}}}},u.prototype[o.types.BOX|o.types.BOX]=u.prototype.boxBox=function(t,e,n,i,o,r,s,a){t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e.convexPolyhedronRepresentation,n,i,o,r,s,a,t,e)},u.prototype[o.types.BOX|o.types.CONVEXPOLYHEDRON]=u.prototype.boxConvex=function(t,e,n,i,o,r,s,a){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e,n,i,o,r,s,a,t,e)},u.prototype[o.types.BOX|o.types.PARTICLE]=u.prototype.boxParticle=function(t,e,n,i,o,r,s,a){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexParticle(t.convexPolyhedronRepresentation,e,n,i,o,r,s,a,t,e)},u.prototype[o.types.SPHERE]=u.prototype.sphereSphere=function(t,e,n,i,o,r,s,a){var l=this.createContactEquation(s,a,t,e);i.vsub(n,l.ni),l.ni.normalize(),l.ri.copy(l.ni),l.rj.copy(l.ni),l.ri.mult(t.radius,l.ri),l.rj.mult(-e.radius,l.rj),l.ri.vadd(n,l.ri),l.ri.vsub(s.position,l.ri),l.rj.vadd(i,l.rj),l.rj.vsub(a.position,l.rj),this.result.push(l),this.createFrictionEquationsFromContact(l,this.frictionResult)};var w=new s,y=new s,_=new s;u.prototype[o.types.PLANE|o.types.TRIMESH]=u.prototype.planeTrimesh=function(t,e,n,i,o,r,l,c){var p=new s,h=w;h.set(0,0,1),o.vmult(h,h);for(var u=0;u<e.vertices.length/3;u++){e.getVertex(u,p);var d=new s;d.copy(p),a.pointToWorldFrame(i,r,d,p);var v=y;if(p.vsub(n,v),h.dot(v)<=0){var m=this.createContactEquation(l,c,t,e);m.ni.copy(h);var g=_;h.scale(v.dot(h),g),p.vsub(g,g),m.ri.copy(g),m.ri.vsub(l.position,m.ri),m.rj.copy(p),m.rj.vsub(c.position,m.rj),this.result.push(m),this.createFrictionEquationsFromContact(m,this.frictionResult)}}};var P=new s,C=new s,z=(new s,new s),E=new s,S=new s,A=new s,M=new s,L=new s,k=new s,V=new s,B=new s,R=new s,T=new s,I=new i,F=[];u.prototype[o.types.SPHERE|o.types.TRIMESH]=u.prototype.sphereTrimesh=function(t,e,n,i,o,s,l,c){var p=S,h=A,u=M,d=L,v=k,m=V,g=I,f=E,x=C,b=F;a.pointToLocalFrame(i,s,n,v);var w=t.radius;g.lowerBound.set(v.x-w,v.y-w,v.z-w),g.upperBound.set(v.x+w,v.y+w,v.z+w),e.getTrianglesInAABB(g,b);for(var y=z,_=t.radius*t.radius,q=0;q<b.length;q++)for(var N=0;N<3;N++)e.getVertex(e.indices[3*b[q]+N],y),y.vsub(v,x),x.norm2()<=_&&(f.copy(y),a.pointToWorldFrame(i,s,f,y),y.vsub(n,x),(O=this.createContactEquation(l,c,t,e)).ni.copy(x),O.ni.normalize(),O.ri.copy(O.ni),O.ri.scale(t.radius,O.ri),O.ri.vadd(n,O.ri),O.ri.vsub(l.position,O.ri),O.rj.copy(y),O.rj.vsub(c.position,O.rj),this.result.push(O),this.createFrictionEquationsFromContact(O,this.frictionResult));for(q=0;q<b.length;q++)for(N=0;N<3;N++){e.getVertex(e.indices[3*b[q]+N],p),e.getVertex(e.indices[3*b[q]+(N+1)%3],h),h.vsub(p,u),v.vsub(h,m);var j=m.dot(u);v.vsub(p,m);var D=m.dot(u);if(D>0&&j<0&&(v.vsub(p,m),d.copy(u),d.normalize(),D=m.dot(d),d.scale(D,m),m.vadd(p,m),(Y=m.distanceTo(v))<t.radius)){var O=this.createContactEquation(l,c,t,e);m.vsub(v,O.ni),O.ni.normalize(),O.ni.scale(t.radius,O.ri),a.pointToWorldFrame(i,s,m,m),m.vsub(c.position,O.rj),a.vectorToWorldFrame(s,O.ni,O.ni),a.vectorToWorldFrame(s,O.ri,O.ri),this.result.push(O),this.createFrictionEquationsFromContact(O,this.frictionResult)}}for(var U=B,W=R,G=T,H=P,K=(q=0,b.length);q!==K;q++){e.getTriangleVertices(b[q],U,W,G),e.getNormal(b[q],H),v.vsub(U,m);var Y=m.dot(H);H.scale(Y,m),v.vsub(m,m),Y=m.distanceTo(v),r.pointInTriangle(m,U,W,G)&&Y<t.radius&&(O=this.createContactEquation(l,c,t,e),m.vsub(v,O.ni),O.ni.normalize(),O.ni.scale(t.radius,O.ri),a.pointToWorldFrame(i,s,m,m),m.vsub(c.position,O.rj),a.vectorToWorldFrame(s,O.ni,O.ni),a.vectorToWorldFrame(s,O.ri,O.ri),this.result.push(O),this.createFrictionEquationsFromContact(O,this.frictionResult))}b.length=0};var q=new s,N=new s;u.prototype[o.types.SPHERE|o.types.PLANE]=u.prototype.spherePlane=function(t,e,n,i,o,r,s,a){var l=this.createContactEquation(s,a,t,e);if(l.ni.set(0,0,1),r.vmult(l.ni,l.ni),l.ni.negate(l.ni),l.ni.normalize(),l.ni.mult(t.radius,l.ri),n.vsub(i,q),l.ni.mult(l.ni.dot(q),N),q.vsub(N,l.rj),-q.dot(l.ni)<=t.radius){var c=l.ri,p=l.rj;c.vadd(n,c),c.vsub(s.position,c),p.vadd(i,p),p.vsub(a.position,p),this.result.push(l),this.createFrictionEquationsFromContact(l,this.frictionResult)}};var j=new s,D=new s,O=new s;function U(t,e,n){for(var i=null,o=t.length,r=0;r!==o;r++){var s=t[r],a=j;t[(r+1)%o].vsub(s,a);var l=D;a.cross(e,l);var c=O;n.vsub(s,c);var p=l.dot(c);if(!(null===i||p>0&&!0===i||p<=0&&!1===i))return!1;null===i&&(i=p>0)}return!0}var W=new s,G=new s,H=new s,K=new s,Y=[new s,new s,new s,new s,new s,new s],X=new s,Z=new s,$=new s,Q=new s;u.prototype[o.types.SPHERE|o.types.BOX]=u.prototype.sphereBox=function(t,e,n,i,o,r,s,a){var l=this.v3pool,c=Y;n.vsub(i,W),e.getSideNormals(c,r);for(var p=t.radius,h=!1,u=Z,d=$,v=Q,m=null,g=0,f=0,x=0,b=null,w=0,y=c.length;w!==y&&!1===h;w++){var _=G;_.copy(c[w]);var P=_.norm();_.normalize();var C=W.dot(_);if(C<P+p&&C>0){var z=H,E=K;z.copy(c[(w+1)%3]),E.copy(c[(w+2)%3]);var S=z.norm(),A=E.norm();z.normalize(),E.normalize();var M=W.dot(z),L=W.dot(E);if(M<S&&M>-S&&L<A&&L>-A){var k=Math.abs(C-P-p);(null===b||k<b)&&(b=k,f=M,x=L,m=P,u.copy(_),d.copy(z),v.copy(E),g++)}}}if(g){h=!0;var V=this.createContactEquation(s,a,t,e);u.mult(-p,V.ri),V.ni.copy(u),V.ni.negate(V.ni),u.mult(m,u),d.mult(f,d),u.vadd(d,u),v.mult(x,v),u.vadd(v,V.rj),V.ri.vadd(n,V.ri),V.ri.vsub(s.position,V.ri),V.rj.vadd(i,V.rj),V.rj.vsub(a.position,V.rj),this.result.push(V),this.createFrictionEquationsFromContact(V,this.frictionResult)}for(var B=l.get(),R=X,T=0;2!==T&&!h;T++)for(var I=0;2!==I&&!h;I++)for(var F=0;2!==F&&!h;F++)B.set(0,0,0),T?B.vadd(c[0],B):B.vsub(c[0],B),I?B.vadd(c[1],B):B.vsub(c[1],B),F?B.vadd(c[2],B):B.vsub(c[2],B),i.vadd(B,R),R.vsub(n,R),R.norm2()<p*p&&(h=!0,(V=this.createContactEquation(s,a,t,e)).ri.copy(R),V.ri.normalize(),V.ni.copy(V.ri),V.ri.mult(p,V.ri),V.rj.copy(B),V.ri.vadd(n,V.ri),V.ri.vsub(s.position,V.ri),V.rj.vadd(i,V.rj),V.rj.vsub(a.position,V.rj),this.result.push(V),this.createFrictionEquationsFromContact(V,this.frictionResult));l.release(B),B=null;var q=l.get(),N=l.get(),j=(V=l.get(),l.get()),D=(k=l.get(),c.length);for(T=0;T!==D&&!h;T++)for(I=0;I!==D&&!h;I++)if(T%3!=I%3){c[I].cross(c[T],q),q.normalize(),c[T].vadd(c[I],N),V.copy(n),V.vsub(N,V),V.vsub(i,V);var O=V.dot(q);for(q.mult(O,j),F=0;F===T%3||F===I%3;)F++;k.copy(n),k.vsub(j,k),k.vsub(N,k),k.vsub(i,k);var U=Math.abs(O),J=k.norm();if(U<c[F].norm()&&J<p){h=!0;var tt=this.createContactEquation(s,a,t,e);N.vadd(j,tt.rj),tt.rj.copy(tt.rj),k.negate(tt.ni),tt.ni.normalize(),tt.ri.copy(tt.rj),tt.ri.vadd(i,tt.ri),tt.ri.vsub(n,tt.ri),tt.ri.normalize(),tt.ri.mult(p,tt.ri),tt.ri.vadd(n,tt.ri),tt.ri.vsub(s.position,tt.ri),tt.rj.vadd(i,tt.rj),tt.rj.vsub(a.position,tt.rj),this.result.push(tt),this.createFrictionEquationsFromContact(tt,this.frictionResult)}}l.release(q,N,V,j,k)};var J=new s,tt=new s,et=new s,nt=new s,it=new s,ot=new s,rt=new s,st=new s,at=new s,lt=new s;u.prototype[o.types.SPHERE|o.types.CONVEXPOLYHEDRON]=u.prototype.sphereConvex=function(t,e,n,i,o,r,s,a){var l=this.v3pool;n.vsub(i,J);for(var c=e.faceNormals,p=e.faces,h=e.vertices,u=t.radius,d=0;d!==h.length;d++){var v=h[d],m=it;r.vmult(v,m),i.vadd(m,m);var g=nt;if(m.vsub(n,g),g.norm2()<u*u)return f=!0,(k=this.createContactEquation(s,a,t,e)).ri.copy(g),k.ri.normalize(),k.ni.copy(k.ri),k.ri.mult(u,k.ri),m.vsub(i,k.rj),k.ri.vadd(n,k.ri),k.ri.vsub(s.position,k.ri),k.rj.vadd(i,k.rj),k.rj.vsub(a.position,k.rj),this.result.push(k),void this.createFrictionEquationsFromContact(k,this.frictionResult)}for(var f=!1,x=(d=0,p.length);d!==x&&!1===f;d++){var b=c[d],w=p[d],y=ot;r.vmult(b,y);var _=rt;r.vmult(h[w[0]],_),_.vadd(i,_);var P=st;y.mult(-u,P),n.vadd(P,P);var C=at;P.vsub(_,C);var z=C.dot(y),E=lt;if(n.vsub(_,E),z<0&&E.dot(y)>0){for(var S=[],A=0,M=w.length;A!==M;A++){var L=l.get();r.vmult(h[w[A]],L),i.vadd(L,L),S.push(L)}if(U(S,y,n)){f=!0;var k=this.createContactEquation(s,a,t,e);y.mult(-u,k.ri),y.negate(k.ni);var V=l.get();y.mult(-z,V);var B=l.get();y.mult(-u,B),n.vsub(i,k.rj),k.rj.vadd(B,k.rj),k.rj.vadd(V,k.rj),k.rj.vadd(i,k.rj),k.rj.vsub(a.position,k.rj),k.ri.vadd(n,k.ri),k.ri.vsub(s.position,k.ri),l.release(V),l.release(B),this.result.push(k),this.createFrictionEquationsFromContact(k,this.frictionResult),A=0;for(var R=S.length;A!==R;A++)l.release(S[A]);return}for(A=0;A!==w.length;A++){var T=l.get(),I=l.get();r.vmult(h[w[(A+1)%w.length]],T),r.vmult(h[w[(A+2)%w.length]],I),i.vadd(T,T),i.vadd(I,I);var F=tt;I.vsub(T,F);var q=et;F.unit(q);var N=l.get(),j=l.get();n.vsub(T,j);var D=j.dot(q);q.mult(D,N),N.vadd(T,N);var O=l.get();if(N.vsub(n,O),D>0&&D*D<F.norm2()&&O.norm2()<u*u){for(k=this.createContactEquation(s,a,t,e),N.vsub(i,k.rj),N.vsub(n,k.ni),k.ni.normalize(),k.ni.mult(u,k.ri),k.rj.vadd(i,k.rj),k.rj.vsub(a.position,k.rj),k.ri.vadd(n,k.ri),k.ri.vsub(s.position,k.ri),this.result.push(k),this.createFrictionEquationsFromContact(k,this.frictionResult),A=0,R=S.length;A!==R;A++)l.release(S[A]);return l.release(T),l.release(I),l.release(N),l.release(O),void l.release(j)}l.release(T),l.release(I),l.release(N),l.release(O),l.release(j)}for(A=0,R=S.length;A!==R;A++)l.release(S[A])}}},new s,new s,u.prototype[o.types.PLANE|o.types.BOX]=u.prototype.planeBox=function(t,e,n,i,o,r,s,a){e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.planeConvex(t,e.convexPolyhedronRepresentation,n,i,o,r,s,a)};var ct=new s,pt=new s,ht=new s,ut=new s;u.prototype[o.types.PLANE|o.types.CONVEXPOLYHEDRON]=u.prototype.planeConvex=function(t,e,n,i,o,r,s,a){var l=ct,c=pt;c.set(0,0,1),o.vmult(c,c);for(var p=0,h=ht,u=0;u!==e.vertices.length;u++)if(l.copy(e.vertices[u]),r.vmult(l,l),i.vadd(l,l),l.vsub(n,h),c.dot(h)<=0){var d=this.createContactEquation(s,a,t,e),v=ut;c.mult(c.dot(h),v),l.vsub(v,v),v.vsub(n,d.ri),d.ni.copy(c),l.vsub(i,d.rj),d.ri.vadd(n,d.ri),d.ri.vsub(s.position,d.ri),d.rj.vadd(i,d.rj),d.rj.vsub(a.position,d.rj),this.result.push(d),p++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(d,this.frictionResult)}this.enableFrictionReduction&&p&&this.createFrictionFromAverage(p)};var dt=new s,vt=new s;u.prototype[o.types.CONVEXPOLYHEDRON]=u.prototype.convexConvex=function(t,e,n,i,o,r,s,a,l,c,p,h){var u=dt;if(!(n.distanceTo(i)>t.boundingSphereRadius+e.boundingSphereRadius)&&t.findSeparatingAxis(e,n,o,i,r,u,p,h)){var d=[],v=vt;t.clipAgainstHull(n,o,e,i,r,u,-100,100,d);for(var m=0,g=0;g!==d.length;g++){var f=this.createContactEquation(s,a,t,e,l,c),x=f.ri,b=f.rj;u.negate(f.ni),d[g].normal.negate(v),v.mult(d[g].depth,v),d[g].point.vadd(v,x),b.copy(d[g].point),x.vsub(n,x),b.vsub(i,b),x.vadd(n,x),x.vsub(s.position,x),b.vadd(i,b),b.vsub(a.position,b),this.result.push(f),m++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(f,this.frictionResult)}this.enableFrictionReduction&&m&&this.createFrictionFromAverage(m)}};var mt=new s,gt=new s,ft=new s;u.prototype[o.types.PLANE|o.types.PARTICLE]=u.prototype.planeParticle=function(t,e,n,i,o,r,s,a){var l=mt;l.set(0,0,1),s.quaternion.vmult(l,l);var c=gt;if(i.vsub(s.position,c),l.dot(c)<=0){var p=this.createContactEquation(a,s,e,t);p.ni.copy(l),p.ni.negate(p.ni),p.ri.set(0,0,0);var h=ft;l.mult(l.dot(i),h),i.vsub(h,h),p.rj.copy(h),this.result.push(p),this.createFrictionEquationsFromContact(p,this.frictionResult)}};var xt=new s;u.prototype[o.types.PARTICLE|o.types.SPHERE]=u.prototype.sphereParticle=function(t,e,n,i,o,r,s,a){var l=xt;if(l.set(0,0,1),i.vsub(n,l),l.norm2()<=t.radius*t.radius){var c=this.createContactEquation(a,s,e,t);l.normalize(),c.rj.copy(l),c.rj.mult(t.radius,c.rj),c.ni.copy(l),c.ni.negate(c.ni),c.ri.set(0,0,0),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult)}};var bt=new l,wt=new s,yt=(new s,new s),_t=new s,Pt=new s;u.prototype[o.types.PARTICLE|o.types.CONVEXPOLYHEDRON]=u.prototype.convexParticle=function(t,e,n,i,o,r,s,a){var l=-1,c=yt,p=Pt,h=null,u=wt;if(u.copy(i),u.vsub(n,u),o.conjugate(bt),bt.vmult(u,u),t.pointIsInside(u)){t.worldVerticesNeedsUpdate&&t.computeWorldVertices(n,o),t.worldFaceNormalsNeedsUpdate&&t.computeWorldFaceNormals(o);for(var d=0,v=t.faces.length;d!==v;d++){var m=[t.worldVertices[t.faces[d][0]]],g=t.worldFaceNormals[d];i.vsub(m[0],_t);var f=-g.dot(_t);(null===h||Math.abs(f)<Math.abs(h))&&(h=f,l=d,c.copy(g))}if(-1!==l){var x=this.createContactEquation(a,s,e,t);c.mult(h,p),p.vadd(i,p),p.vsub(n,p),x.rj.copy(p),c.negate(x.ni),x.ri.set(0,0,0);var b=x.ri,w=x.rj;b.vadd(i,b),b.vsub(a.position,b),w.vadd(n,w),w.vsub(s.position,w),this.result.push(x),this.createFrictionEquationsFromContact(x,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},u.prototype[o.types.BOX|o.types.HEIGHTFIELD]=u.prototype.boxHeightfield=function(t,e,n,i,o,r,s,a){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexHeightfield(t.convexPolyhedronRepresentation,e,n,i,o,r,s,a)};var Ct=new s,zt=new s,Et=[0];u.prototype[o.types.CONVEXPOLYHEDRON|o.types.HEIGHTFIELD]=u.prototype.convexHeightfield=function(t,e,n,i,o,r,s,l){var c=e.data,p=e.elementSize,h=t.boundingSphereRadius,u=zt,d=Et,v=Ct;a.pointToLocalFrame(i,r,n,v);var m=Math.floor((v.x-h)/p)-1,g=Math.ceil((v.x+h)/p)+1,f=Math.floor((v.y-h)/p)-1,x=Math.ceil((v.y+h)/p)+1;if(!(g<0||x<0||m>c.length||f>c[0].length)){m<0&&(m=0),g<0&&(g=0),f<0&&(f=0),x<0&&(x=0),m>=c.length&&(m=c.length-1),g>=c.length&&(g=c.length-1),x>=c[0].length&&(x=c[0].length-1),f>=c[0].length&&(f=c[0].length-1);var b=[];e.getRectMinMax(m,f,g,x,b);var w=b[0],y=b[1];if(!(v.z-h>y||v.z+h<w))for(var _=m;_<g;_++)for(var P=f;P<x;P++)e.getConvexTrianglePillar(_,P,!1),a.pointToWorldFrame(i,r,e.pillarOffset,u),n.distanceTo(u)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.convexConvex(t,e.pillarConvex,n,u,o,r,s,l,null,null,d,null),e.getConvexTrianglePillar(_,P,!0),a.pointToWorldFrame(i,r,e.pillarOffset,u),n.distanceTo(u)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.convexConvex(t,e.pillarConvex,n,u,o,r,s,l,null,null,d,null)}};var St=new s,At=new s;u.prototype[o.types.SPHERE|o.types.HEIGHTFIELD]=u.prototype.sphereHeightfield=function(t,e,n,i,o,r,s,l){var c=e.data,p=t.radius,h=e.elementSize,u=At,d=St;a.pointToLocalFrame(i,r,n,d);var v=Math.floor((d.x-p)/h)-1,m=Math.ceil((d.x+p)/h)+1,g=Math.floor((d.y-p)/h)-1,f=Math.ceil((d.y+p)/h)+1;if(!(m<0||f<0||v>c.length||f>c[0].length)){v<0&&(v=0),m<0&&(m=0),g<0&&(g=0),f<0&&(f=0),v>=c.length&&(v=c.length-1),m>=c.length&&(m=c.length-1),f>=c[0].length&&(f=c[0].length-1),g>=c[0].length&&(g=c[0].length-1);var x=[];e.getRectMinMax(v,g,m,f,x);var b=x[0],w=x[1];if(!(d.z-p>w||d.z+p<b))for(var y=this.result,_=v;_<m;_++)for(var P=g;P<f;P++){var C=y.length;if(e.getConvexTrianglePillar(_,P,!1),a.pointToWorldFrame(i,r,e.pillarOffset,u),n.distanceTo(u)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.sphereConvex(t,e.pillarConvex,n,u,o,r,s,l),e.getConvexTrianglePillar(_,P,!0),a.pointToWorldFrame(i,r,e.pillarOffset,u),n.distanceTo(u)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.sphereConvex(t,e.pillarConvex,n,u,o,r,s,l),y.length-C>2)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(t,e,n){e.exports=x;var i=t("../shapes/Shape"),o=t("../math/Vec3"),r=t("../math/Quaternion"),s=t("../solver/GSSolver"),a=(t("../utils/Vec3Pool"),t("../equations/ContactEquation"),t("../equations/FrictionEquation"),t("./Narrowphase")),l=t("../utils/EventTarget"),c=t("../collision/ArrayCollisionMatrix"),p=t("../material/Material"),h=t("../material/ContactMaterial"),u=t("../objects/Body"),d=t("../utils/TupleDictionary"),v=t("../collision/RaycastResult"),m=t("../collision/AABB"),g=t("../collision/Ray"),f=t("../collision/NaiveBroadphase");function x(){l.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new o,this.broadphase=new f,this.bodies=[],this.solver=new s,this.constraints=[],this.narrowphase=new a(this),this.collisionMatrix=new c,this.collisionMatrixPrevious=new c,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new d,this.defaultMaterial=new p("default"),this.defaultContactMaterial=new h(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}x.prototype=new l,new m;var b=new g;if(x.prototype.getContactMaterial=function(t,e){return this.contactMaterialTable.get(t.id,e.id)},x.prototype.numObjects=function(){return this.bodies.length},x.prototype.collisionMatrixTick=function(){var t=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=t,this.collisionMatrix.reset()},x.prototype.add=x.prototype.addBody=function(t){-1===this.bodies.indexOf(t)&&(t.index=this.bodies.length,this.bodies.push(t),t.world=this,t.initPosition.copy(t.position),t.initVelocity.copy(t.velocity),t.timeLastSleepy=this.time,t instanceof u&&(t.initAngularVelocity.copy(t.angularVelocity),t.initQuaternion.copy(t.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=t,this.dispatchEvent(this.addBodyEvent))},x.prototype.addConstraint=function(t){this.constraints.push(t)},x.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&this.constraints.splice(e,1)},x.prototype.rayTest=function(t,e,n){n instanceof v?this.raycastClosest(t,e,{skipBackfaces:!0},n):this.raycastAll(t,e,{skipBackfaces:!0},n)},x.prototype.raycastAll=function(t,e,n,i){return n.mode=g.ALL,n.from=t,n.to=e,n.callback=i,b.intersectWorld(this,n)},x.prototype.raycastAny=function(t,e,n,i){return n.mode=g.ANY,n.from=t,n.to=e,n.result=i,b.intersectWorld(this,n)},x.prototype.raycastClosest=function(t,e,n,i){return n.mode=g.CLOSEST,n.from=t,n.to=e,n.result=i,b.intersectWorld(this,n)},x.prototype.remove=function(t){t.world=null;var e=this.bodies.length-1,n=this.bodies,i=n.indexOf(t);if(-1!==i){n.splice(i,1);for(var o=0;o!==n.length;o++)n[o].index=o;this.collisionMatrix.setNumObjects(e),this.removeBodyEvent.body=t,this.dispatchEvent(this.removeBodyEvent)}},x.prototype.removeBody=x.prototype.remove,x.prototype.addMaterial=function(t){this.materials.push(t)},x.prototype.addContactMaterial=function(t){this.contactmaterials.push(t),this.contactMaterialTable.set(t.materials[0].id,t.materials[1].id,t)},"undefined"==typeof performance&&(performance={}),!performance.now){var w=Date.now();performance.timing&&performance.timing.navigationStart&&(w=performance.timing.navigationStart),performance.now=function(){return Date.now()-w}}var y=new o;x.prototype.step=function(t,e,n){if(n=n||10,0===(e=e||0))this.internalStep(t),this.time+=t;else{var i=Math.floor((this.time+e)/t)-Math.floor(this.time/t);i=Math.min(i,n);for(var o=performance.now(),r=0;r!==i&&(this.internalStep(t),!(performance.now()-o>1e3*t));r++);this.time+=e;for(var s=this.time%t/t,a=y,l=this.bodies,c=0;c!==l.length;c++){var p=l[c];p.type!==u.STATIC&&p.sleepState!==u.SLEEPING?(p.position.vsub(p.previousPosition,a),a.scale(s,a),p.position.vadd(a,p.interpolatedPosition)):(p.interpolatedPosition.copy(p.position),p.interpolatedQuaternion.copy(p.quaternion))}}};var _={type:"postStep"},P={type:"preStep"},C={type:"collide",body:null,contact:null},z=[],E=[],S=[],A=[],M=(new o,new o,new o,new o,new o,new o,new o,new o,new o,new r,new r),L=new r,k=new o;x.prototype.internalStep=function(t){this.dt=t;var e,n=this.contacts,o=S,r=A,s=this.numObjects(),a=this.bodies,l=this.solver,c=this.gravity,p=this.doProfiling,h=this.profile,d=u.DYNAMIC,v=this.constraints,m=E,g=(c.norm(),c.x),f=c.y,x=c.z,b=0;for(p&&(e=performance.now()),b=0;b!==s;b++)if((j=a[b]).type&d){var w=j.force,y=j.mass;w.x+=y*g,w.y+=y*f,w.z+=y*x}b=0;for(var V=this.subsystems.length;b!==V;b++)this.subsystems[b].update();p&&(e=performance.now()),o.length=0,r.length=0,this.broadphase.collisionPairs(this,o,r),p&&(h.broadphase=performance.now()-e);var B=v.length;for(b=0;b!==B;b++)if(!(O=v[b]).collideConnected)for(var R=o.length-1;R>=0;R-=1)(O.bodyA===o[R]&&O.bodyB===r[R]||O.bodyB===o[R]&&O.bodyA===r[R])&&(o.splice(R,1),r.splice(R,1));this.collisionMatrixTick(),p&&(e=performance.now());var T=z,I=n.length;for(b=0;b!==I;b++)T.push(n[b]);n.length=0;var F=this.frictionEquations.length;for(b=0;b!==F;b++)m.push(this.frictionEquations[b]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(o,r,this,n,T,this.frictionEquations,m),p&&(h.narrowphase=performance.now()-e),p&&(e=performance.now()),b=0;b<this.frictionEquations.length;b++)l.addEquation(this.frictionEquations[b]);for(var q=n.length,N=0;N!==q;N++){var j=(O=n[N]).bi,D=O.bj;O.si,O.sj,(j.material&&D.material&&this.getContactMaterial(j.material,D.material)||this.defaultContactMaterial).friction,j.material&&D.material&&(j.material.friction>=0&&D.material.friction>=0&&(j.material.friction,D.material.friction),j.material.restitution>=0&&D.material.restitution>=0&&(O.restitution=j.material.restitution*D.material.restitution)),l.addEquation(O),j.allowSleep&&j.type===u.DYNAMIC&&j.sleepState===u.SLEEPING&&D.sleepState===u.AWAKE&&D.type!==u.STATIC&&D.velocity.norm2()+D.angularVelocity.norm2()>=2*Math.pow(D.sleepSpeedLimit,2)&&(j._wakeUpAfterNarrowphase=!0),D.allowSleep&&D.type===u.DYNAMIC&&D.sleepState===u.SLEEPING&&j.sleepState===u.AWAKE&&j.type!==u.STATIC&&j.velocity.norm2()+j.angularVelocity.norm2()>=2*Math.pow(j.sleepSpeedLimit,2)&&(D._wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(j,D,!0),this.collisionMatrixPrevious.get(j,D)||(C.body=D,C.contact=O,j.dispatchEvent(C),C.body=j,D.dispatchEvent(C))}for(p&&(h.makeContactConstraints=performance.now()-e,e=performance.now()),b=0;b!==s;b++)(j=a[b])._wakeUpAfterNarrowphase&&(j.wakeUp(),j._wakeUpAfterNarrowphase=!1);for(B=v.length,b=0;b!==B;b++){var O;(O=v[b]).update(),R=0;for(var U=O.equations.length;R!==U;R++){var W=O.equations[R];l.addEquation(W)}}l.solve(t,this),p&&(h.solve=performance.now()-e),l.removeAllEquations();var G=Math.pow;for(b=0;b!==s;b++)if((j=a[b]).type&d){var H=G(1-j.linearDamping,t),K=j.velocity;K.mult(H,K);var Y=j.angularVelocity;if(Y){var X=G(1-j.angularDamping,t);Y.mult(X,Y)}}for(this.dispatchEvent(P),b=0;b!==s;b++)(j=a[b]).preStep&&j.preStep.call(j);p&&(e=performance.now());var Z=M,$=L,Q=this.stepnumber,J=u.DYNAMIC|u.KINEMATIC,tt=Q%(this.quatNormalizeSkip+1)==0,et=this.quatNormalizeFast,nt=.5*t;for(i.types.PLANE,i.types.CONVEXPOLYHEDRON,b=0;b!==s;b++){var it=a[b],ot=it.force,rt=it.torque;if(it.type&J&&it.sleepState!==u.SLEEPING){var st=it.velocity,at=it.angularVelocity,lt=it.position,ct=it.quaternion,pt=it.invMass,ht=it.invInertiaWorld;st.x+=ot.x*pt*t,st.y+=ot.y*pt*t,st.z+=ot.z*pt*t,it.angularVelocity&&(ht.vmult(rt,k),k.mult(t,k),k.vadd(at,at)),lt.x+=st.x*t,lt.y+=st.y*t,lt.z+=st.z*t,it.angularVelocity&&(Z.set(at.x,at.y,at.z,0),Z.mult(ct,$),ct.x+=nt*$.x,ct.y+=nt*$.y,ct.z+=nt*$.z,ct.w+=nt*$.w,tt&&(et?ct.normalizeFast():ct.normalize())),it.aabb&&(it.aabbNeedsUpdate=!0),it.updateInertiaWorld&&it.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,p&&(h.integrate=performance.now()-e),this.time+=t,this.stepnumber+=1,this.dispatchEvent(_),b=0;b!==s;b++){var ut=(j=a[b]).postStep;ut&&ut.call(j)}if(this.allowSleep)for(b=0;b!==s;b++)a[b].sleepTick(this.time)},x.prototype.clearForces=function(){for(var t=this.bodies,e=t.length,n=0;n!==e;n++){var i=t[n];i.force,i.torque,i.force.set(0,0,0),i.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)},466:function(t){var e;t.exports=((e=function(){function t(t){return o.appendChild(t.dom),t}function n(t){for(var e=0;e<o.children.length;e++)o.children[e].style.display=e===t?"block":"none";i=t}var i=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",(function(t){t.preventDefault(),n(++i%o.children.length)}),!1);var r=(performance||Date).now(),s=r,a=0,l=t(new e.Panel("FPS","#0ff","#002")),c=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var p=t(new e.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:o,addPanel:t,showPanel:n,begin:function(){r=(performance||Date).now()},end:function(){a++;var t=(performance||Date).now();if(c.update(t-r,200),t>s+1e3&&(l.update(1e3*a/(t-s),100),s=t,a=0,p)){var e=performance.memory;p.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){r=this.end()},domElement:o,setMode:n}}).Panel=function(t,e,n){var i=1/0,o=0,r=Math.round,s=r(window.devicePixelRatio||1),a=80*s,l=48*s,c=3*s,p=2*s,h=3*s,u=15*s,d=74*s,v=30*s,m=document.createElement("canvas");m.width=a,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*s+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,a,l),g.fillStyle=e,g.fillText(t,c,p),g.fillRect(h,u,d,v),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h,u,d,v),{dom:m,update:function(l,f){i=Math.min(i,l),o=Math.max(o,l),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,a,u),g.fillStyle=e,g.fillText(r(l)+" "+t+" ("+r(i)+"-"+r(o)+")",c,p),g.drawImage(m,h+s,u,d-s,v,h,u,d-s,v),g.fillRect(h+d-s,u,s,v),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h+d-s,u,s,r((1-l/f)*v))}}},e)},498:function(t,e){!function(t){"use strict";class e{constructor(t){this.controller_=t}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(t){this.controller_.viewProps.set("disabled",t)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(t){this.controller_.viewProps.set("hidden",t)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class n{constructor(t){this.target=t}}class i extends n{constructor(t,e,n,i){super(t),this.value=e,this.presetKey=n,this.last=null==i||i}}class o extends n{constructor(t,e,n){super(t),this.value=e,this.presetKey=n}}class r extends n{constructor(t,e){super(t),this.expanded=e}}function s(t){return null==t}function a(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}const l={alreadydisposed:()=>"View has been already disposed",invalidparams:t=>`Invalid parameters for '${t.name}'`,nomatchingcontroller:t=>`No matching controller for '${t.key}'`,nomatchingview:t=>`No matching view for '${JSON.stringify(t.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:t=>`Property '${t.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class c{constructor(t){var e;this.message=null!==(e=l[t.type](t.context))&&void 0!==e?e:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=t.type}static alreadyDisposed(){return new c({type:"alreadydisposed"})}static notBindable(){return new c({type:"notbindable"})}static propertyNotFound(t){return new c({type:"propertynotfound",context:{name:t}})}static shouldNeverHappen(){return new c({type:"shouldneverhappen"})}}class p{constructor(t,e,n){this.obj_=t,this.key_=e,this.presetKey_=null!=n?n:e}static isBindable(t){return null!==t&&"object"==typeof t}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(t){this.obj_[this.key_]=t}writeProperty(t,e){const n=this.read();if(!p.isBindable(n))throw c.notBindable();if(!(t in n))throw c.propertyNotFound(t);n[t]=e}}class h extends e{get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get title(){var t;return null!==(t=this.controller_.valueController.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller_.valueController.props.set("title",t)}on(t,e){const i=e.bind(this);return this.controller_.valueController.emitter.on(t,(()=>{i(new n(this))})),this}}class u{constructor(){this.observers_={}}on(t,e){let n=this.observers_[t];return n||(n=this.observers_[t]=[]),n.push({handler:e}),this}off(t,e){const n=this.observers_[t];return n&&(this.observers_[t]=n.filter((t=>t.handler!==e))),this}emit(t,e){const n=this.observers_[t];n&&n.forEach((t=>{t.handler(e)}))}}const d="tp";function v(t){return(e,n)=>[d,"-",t,"v",e?`_${e}`:"",n?`-${n}`:""].join("")}function m(t){return t.rawValue}function g(t,e){var n,i;t.emitter.on("change",(n=m,i=e,t=>i(n(t)))),e(t.rawValue)}function f(t,e,n){g(t.value(e),n)}function x(t,e){return n=>{!function(t,e,n){n?t.classList.add(e):t.classList.remove(e)}(t,e,n)}}function b(t,e){g(t,(t=>{e.textContent=null!=t?t:""}))}const w=v("btn");class y{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(w()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("button");n.classList.add(w("b")),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const i=t.createElement("div");i.classList.add(w("t")),b(e.props.value("title"),i),this.buttonElement.appendChild(i)}}class _{constructor(t,e){this.emitter=new u,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new y(t,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class P{constructor(t,e){var n;this.constraint_=null==e?void 0:e.constraint,this.equals_=null!==(n=null==e?void 0:e.equals)&&void 0!==n?n:(t,e)=>t===e,this.emitter=new u,this.rawValue_=t}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const n=null!=e?e:{forceEmit:!1,last:!0},i=this.constraint_?this.constraint_.constrain(t):t;(!this.equals_(this.rawValue_,i)||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=i,this.emitter.emit("change",{options:n,rawValue:i,sender:this}))}}class C{constructor(t){this.emitter=new u,this.value_=t}get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const n=null!=e?e:{forceEmit:!1,last:!0};(this.value_!==t||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:n,rawValue:this.value_,sender:this}))}}function z(t,e){const n=null==e?void 0:e.constraint,i=null==e?void 0:e.equals;return n||i?new P(t,e):new C(t)}class E{constructor(t){this.emitter=new u,this.valMap_=t;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",(()=>{this.emitter.emit("change",{key:t,sender:this})}))}static createCore(t){return Object.keys(t).reduce(((e,n)=>Object.assign(e,{[n]:z(t[n])})),{})}static fromObject(t){const e=this.createCore(t);return new E(e)}get(t){return this.valMap_[t].rawValue}set(t,e){this.valMap_[t].rawValue=e}value(t){return this.valMap_[t]}}function S(t){return e=>n=>{if(!e&&void 0===n)return{succeeded:!1,value:void 0};if(e&&void 0===n)return{succeeded:!0,value:void 0};const i=t(n);return void 0!==i?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function A(t){return{custom:e=>S(e)(t),boolean:S((t=>"boolean"==typeof t?t:void 0))(t),number:S((t=>"number"==typeof t?t:void 0))(t),string:S((t=>"string"==typeof t?t:void 0))(t),function:S((t=>"function"==typeof t?t:void 0))(t),constant:e=>S((t=>t===e?e:void 0))(t),raw:S((t=>t))(t),object:e=>S((t=>{if(null!==(n=t)&&"object"==typeof n)return function(t,e){return Object.keys(e).reduce(((n,i)=>{if(void 0===n)return;const o=(0,e[i])(t[i]);return o.succeeded?Object.assign(Object.assign({},n),{[i]:o.value}):void 0}),{})}(t,e);var n}))(t),array:e=>S((t=>{if(Array.isArray(t))return n=e,t.reduce(((t,e)=>{if(void 0===t)return;const i=n(e);return i.succeeded&&void 0!==i.value?[...t,i.value]:void 0}),[]);var n}))(t)}}const M={optional:A(!0),required:A(!1)};function L(t,e){const n=M.required.object(e)(t);return n.succeeded?n.value:void 0}const k=v(""),V={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class B{constructor(t){this.parent_=null,this.blade=t.blade,this.view=t.view,this.viewProps=t.viewProps;const e=this.view.element;this.blade.value("positions").emitter.on("change",(()=>{["veryfirst","first","last","verylast"].forEach((t=>{e.classList.remove(k(void 0,V[t]))})),this.blade.get("positions").forEach((t=>{e.classList.add(k(void 0,V[t]))}))})),this.viewProps.handleDispose((()=>{!function(t){t&&t.parentElement&&t.parentElement.removeChild(t)}(e)}))}get parent(){return this.parent_}}const R="http://www.w3.org/2000/svg";function T(t){t.offsetHeight}function I(t){return void 0!==t.ontouchstart}function F(){return new Function("return this")()}function q(t){return"document"in F()?t.getContext("2d"):null}const N={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function j(t,e){const n=t.createElementNS(R,"svg");return n.innerHTML=N[e],n}function D(t,e,n){t.insertBefore(e,t.children[n])}function O(t){t.parentElement&&t.parentElement.removeChild(t)}function U(t){for(;t.children.length>0;)t.removeChild(t.children[0])}function W(t){return t.relatedTarget?t.relatedTarget:"explicitOriginalTarget"in t?t.explicitOriginalTarget:null}const G=v("lbl");class H{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(G()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(G("l")),f(e.props,"label",(e=>{s(e)?this.element.classList.add(G(void 0,"nol")):(this.element.classList.remove(G(void 0,"nol")),function(t){for(;t.childNodes.length>0;)t.removeChild(t.childNodes[0])}(n),n.appendChild(function(t,e){const n=t.createDocumentFragment();return e.split("\n").map((e=>t.createTextNode(e))).forEach(((e,i)=>{i>0&&n.appendChild(t.createElement("br")),n.appendChild(e)})),n}(t,e)))})),this.element.appendChild(n),this.labelElement=n;const i=t.createElement("div");i.classList.add(G("v")),this.element.appendChild(i),this.valueElement=i}}class K extends B{constructor(t,e){const n=e.valueController.viewProps;super(Object.assign(Object.assign({},e),{view:new H(t,{props:e.props,viewProps:n}),viewProps:n})),this.props=e.props,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const Y={id:"button",type:"blade",accept(t){const e=M,n=L(t,{title:e.required.string,view:e.required.constant("button"),label:e.optional.string});return n?{params:n}:null},controller:t=>new K(t.document,{blade:t.blade,props:E.fromObject({label:t.params.label}),valueController:new _(t.document,{props:E.fromObject({title:t.params.title}),viewProps:t.viewProps})}),api:t=>t.controller instanceof K&&t.controller.valueController instanceof _?new h(t.controller):null};class X extends B{constructor(t){super(t),this.value=t.value}}function Z(){return new E({positions:z([],{equals:a})})}class $ extends E{constructor(t){super(t)}static create(t){const e={completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},n=E.createCore(e);return new $(n)}get styleExpanded(){var t;return null!==(t=this.get("temporaryExpanded"))&&void 0!==t?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!s(t)?`${t}px`:"auto"}bindExpandedClass(t,e){f(this,"expanded",(()=>{this.styleExpanded?t.classList.add(e):t.classList.remove(e)}))}}function Q(t,e){e.style.height=t.styleHeight}function J(t,e){t.value("expanded").emitter.on("beforechange",(()=>{t.set("completed",!1),s(t.get("expandedHeight"))&&t.set("expandedHeight",function(t,e){let n=0;return function(t,e){const n=t.style.transition;t.style.transition="none",e(),t.style.transition=n}(e,(()=>{t.set("expandedHeight",null),t.set("temporaryExpanded",!0),T(e),n=e.clientHeight,t.set("temporaryExpanded",null),T(e)})),n}(t,e)),t.set("shouldFixHeight",!0),T(e)})),t.emitter.on("change",(()=>{Q(t,e)})),Q(t,e),e.addEventListener("transitionend",(e=>{"height"===e.propertyName&&(t.set("shouldFixHeight",!1),t.set("expandedHeight",null),t.set("completed",!0))}))}class tt extends e{constructor(t,e){super(t),this.rackApi_=e}}class et{constructor(t){this.emitter=new u,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=t}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(t){for(const e of this.allItems())if(t(e))return e;return null}includes(t){return this.cache_.has(t)}add(t,e){if(this.includes(t))throw c.shouldNeverHappen();const n=void 0!==e?e:this.items_.length;this.items_.splice(n,0,t),this.cache_.add(t);const i=this.extract_(t);i&&(i.emitter.on("add",this.onSubListAdd_),i.emitter.on("remove",this.onSubListRemove_),i.allItems().forEach((t=>{this.cache_.add(t)}))),this.emitter.emit("add",{index:n,item:t,root:this,target:this})}remove(t){const e=this.items_.indexOf(t);if(e<0)return;this.items_.splice(e,1),this.cache_.delete(t);const n=this.extract_(t);n&&(n.emitter.off("add",this.onSubListAdd_),n.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:e,item:t,root:this,target:this})}onSubListAdd_(t){this.cache_.add(t.item),this.emitter.emit("add",{index:t.index,item:t.item,root:this,target:t.target})}onSubListRemove_(t){this.cache_.delete(t.item),this.emitter.emit("remove",{index:t.index,item:t.item,root:this,target:t.target})}}class nt extends e{constructor(t){super(t),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new u,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}refresh(){this.controller_.binding.read()}onBindingChange_(t){const e=t.sender.target.read();this.emitter_.emit("change",{event:new i(this,e,this.controller_.binding.target.presetKey,t.options.last)})}}class it extends K{constructor(t,e){super(t,e),this.binding=e.binding}}class ot extends e{constructor(t){super(t),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new u,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(t){const e=t.sender.target.read();this.emitter_.emit("update",{event:new o(this,e,this.controller_.binding.target.presetKey)})}}class rt extends K{constructor(t,e){super(t,e),this.binding=e.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose((()=>{this.binding.dispose()}))}}function st(t){return t instanceof ct?t.apiSet_:t instanceof tt?t.rackApi_.apiSet_:null}function at(t,e){const n=t.find((t=>t.controller_===e));if(!n)throw c.shouldNeverHappen();return n}function lt(t,e,n){if(!p.isBindable(t))throw c.notBindable();return new p(t,e,n)}class ct extends e{constructor(t,e){super(t),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new u,this.apiSet_=new et(st),this.pool_=e;const n=this.controller_.rack;n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),n.emitter.on("inputchange",this.onRackInputChange_),n.emitter.on("monitorupdate",this.onRackMonitorUpdate_),n.children.forEach((t=>{this.setUpApi_(t)}))}get children(){return this.controller_.rack.children.map((t=>at(this.apiSet_,t)))}addInput(t,e,n){const i=n||{},o=this.controller_.view.element.ownerDocument,r=this.pool_.createInput(o,lt(t,e,i.presetKey),i),s=new nt(r);return this.add(s,i.index)}addMonitor(t,e,n){const i=n||{},o=this.controller_.view.element.ownerDocument,r=this.pool_.createMonitor(o,lt(t,e),i),s=new ot(r);return this.add(s,i.index)}addFolder(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}(this,t)}addButton(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}(this,t)}addSeparator(t){return function(t,e){const n=e||{};return t.addBlade(Object.assign(Object.assign({},n),{view:"separator"}))}(this,t)}addTab(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}(this,t)}add(t,e){this.controller_.rack.add(t.controller_,e);const n=this.apiSet_.find((e=>e.controller_===t.controller_));return n&&this.apiSet_.remove(n),this.apiSet_.add(t),t}remove(t){this.controller_.rack.remove(t.controller_)}addBlade(t){const e=this.controller_.view.element.ownerDocument,n=this.pool_.createBlade(e,t),i=this.pool_.createBladeApi(n);return this.add(i,t.index)}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}setUpApi_(t){this.apiSet_.find((e=>e.controller_===t))||this.apiSet_.add(this.pool_.createBladeApi(t))}onRackAdd_(t){this.setUpApi_(t.bladeController)}onRackRemove_(t){if(t.isRoot){const e=at(this.apiSet_,t.bladeController);this.apiSet_.remove(e)}}onRackInputChange_(t){const e=t.bladeController;if(e instanceof it){const n=at(this.apiSet_,e),o=e.binding;this.emitter_.emit("change",{event:new i(n,o.target.read(),o.target.presetKey,t.options.last)})}else if(e instanceof X){const n=at(this.apiSet_,e);this.emitter_.emit("change",{event:new i(n,e.value.rawValue,void 0,t.options.last)})}}onRackMonitorUpdate_(t){if(!(t.bladeController instanceof rt))throw c.shouldNeverHappen();const e=at(this.apiSet_,t.bladeController),n=t.bladeController.binding;this.emitter_.emit("update",{event:new o(e,n.target.read(),n.target.presetKey)})}}class pt extends tt{constructor(t,e){super(t,new ct(t.rackController,e)),this.emitter_=new u,this.controller_.foldable.value("expanded").emitter.on("change",(t=>{this.emitter_.emit("fold",{event:new r(this,t.sender.rawValue)})})),this.rackApi_.on("change",(t=>{this.emitter_.emit("change",{event:t})})),this.rackApi_.on("update",(t=>{this.emitter_.emit("update",{event:t})}))}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(t){this.controller_.foldable.set("expanded",t)}get title(){return this.controller_.props.get("title")}set title(t){this.controller_.props.set("title",t)}get children(){return this.rackApi_.children}addInput(t,e,n){return this.rackApi_.addInput(t,e,n)}addMonitor(t,e,n){return this.rackApi_.addMonitor(t,e,n)}addFolder(t){return this.rackApi_.addFolder(t)}addButton(t){return this.rackApi_.addButton(t)}addSeparator(t){return this.rackApi_.addSeparator(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){return this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBlade(t){return this.rackApi_.addBlade(t)}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}}class ht extends B{constructor(t){super({blade:t.blade,view:t.view,viewProps:t.rackController.viewProps}),this.rackController=t.rackController}}class ut{constructor(t,e){const n=v(e.viewName);this.element=t.createElement("div"),this.element.classList.add(n()),e.viewProps.bindClassModifiers(this.element)}}function dt(t){return t instanceof gt?t.rack:t instanceof ht?t.rackController.rack:null}function vt(t){const e=dt(t);return e?e.bcSet_:null}class mt{constructor(t){var e;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new u,this.blade_=null!=t?t:null,null===(e=this.blade_)||void 0===e||e.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new et(vt),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(t,e){t.parent&&t.parent.remove(t),t.parent_=this,this.bcSet_.add(t,e)}remove(t){t.parent_=null,this.bcSet_.remove(t)}find(t){return this.bcSet_.allItems().filter((e=>e instanceof t))}onSetAdd_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("add",{bladeController:t.item,index:t.index,isRoot:e,sender:this}),!e)return;const n=t.item;if(n.viewProps.emitter.on("change",this.onChildViewPropsChange_),n.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),n.viewProps.handleDispose(this.onChildDispose_),n instanceof it)n.binding.emitter.on("change",this.onChildInputChange_);else if(n instanceof rt)n.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(n instanceof X)n.value.emitter.on("change",this.onChildValueChange_);else{const t=dt(n);if(t){const e=t.emitter;e.on("layout",this.onDescendantLayout_),e.on("inputchange",this.onDescendantInputChange_),e.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("remove",{bladeController:t.item,isRoot:e,sender:this}),!e)return;const n=t.item;if(n instanceof it)n.binding.emitter.off("change",this.onChildInputChange_);else if(n instanceof rt)n.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(n instanceof X)n.value.emitter.off("change",this.onChildValueChange_);else{const t=dt(n);if(t){const e=t.emitter;e.off("layout",this.onDescendantLayout_),e.off("inputchange",this.onDescendantInputChange_),e.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const t=this.bcSet_.items.filter((t=>!t.viewProps.get("hidden"))),e=t[0],n=t[t.length-1];this.bcSet_.items.forEach((t=>{const i=[];t===e&&(i.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||i.push("veryfirst")),t===n&&(i.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||i.push("verylast")),t.blade.set("positions",i)}))}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter((t=>t.viewProps.get("disposed"))).forEach((t=>{this.bcSet_.remove(t)}))}onChildInputChange_(t){const e=function(t,e){for(let n=0;n<t.length;n++){const i=t[n];if(i instanceof it&&i.binding===e)return i}return null}(this.find(it),t.sender);if(!e)throw c.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:e,options:t.options,sender:this})}onChildMonitorUpdate_(t){const e=function(t,e){for(let n=0;n<t.length;n++){const i=t[n];if(i instanceof rt&&i.binding===e)return i}return null}(this.find(rt),t.sender);if(!e)throw c.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:e,sender:this})}onChildValueChange_(t){const e=function(t,e){for(let n=0;n<t.length;n++){const i=t[n];if(i instanceof X&&i.value===e)return i}return null}(this.find(X),t.sender);if(!e)throw c.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:e,options:t.options,sender:this})}onDescendantLayout_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(t){this.emitter.emit("inputchange",{bladeController:t.bladeController,options:t.options,sender:this})}onDescendantMonitorUpdate_(t){this.emitter.emit("monitorupdate",{bladeController:t.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class gt extends B{constructor(t,e){super(Object.assign(Object.assign({},e),{view:new ut(t,{viewName:"brk",viewProps:e.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const n=new mt(e.root?void 0:e.blade);n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),this.rack=n,this.viewProps.handleDispose((()=>{for(let t=this.rack.children.length-1;t>=0;t--)this.rack.children[t].viewProps.set("disposed",!0)}))}onRackAdd_(t){t.isRoot&&D(this.view.element,t.bladeController.view.element,t.index)}onRackRemove_(t){t.isRoot&&O(t.bladeController.view.element)}}const ft=v("cnt");class xt{constructor(t,e){this.className_=v(e.viewName||"fld"),this.element=t.createElement("div"),this.element.classList.add(this.className_(),ft()),e.viewProps.bindClassModifiers(this.element),this.foldable_=e.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),f(this.foldable_,"completed",x(this.element,this.className_(void 0,"cpl")));const n=t.createElement("button");n.classList.add(this.className_("b")),f(e.props,"title",(t=>{s(t)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))})),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const i=t.createElement("div");i.classList.add(this.className_("t")),b(e.props.value("title"),i),this.buttonElement.appendChild(i),this.titleElement=i;const o=t.createElement("div");o.classList.add(this.className_("m")),this.buttonElement.appendChild(o);const r=e.containerElement;r.classList.add(this.className_("c")),this.element.appendChild(r),this.containerElement=r}}class bt extends ht{constructor(t,e){var n;const i=$.create(null===(n=e.expanded)||void 0===n||n),o=new gt(t,{blade:e.blade,root:e.root,viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:o,view:new xt(t,{containerElement:o.view.element,foldable:i,props:e.props,viewName:e.root?"rot":void 0,viewProps:e.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=e.props,this.foldable=i,J(this.foldable,this.view.containerElement),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const wt={id:"folder",type:"blade",accept(t){const e=M,n=L(t,{title:e.required.string,view:e.required.constant("folder"),expanded:e.optional.boolean});return n?{params:n}:null},controller:t=>new bt(t.document,{blade:t.blade,expanded:t.params.expanded,props:E.fromObject({title:t.params.title}),viewProps:t.viewProps}),api:t=>t.controller instanceof bt?new pt(t.controller,t.pool):null};class yt extends X{constructor(t,e){const n=e.valueController.viewProps;super(Object.assign(Object.assign({},e),{value:e.valueController.value,view:new H(t,{props:e.props,viewProps:n}),viewProps:n})),this.props=e.props,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class _t extends e{}const Pt=v("spr");class Ct{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Pt()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("hr");n.classList.add(Pt("r")),this.element.appendChild(n)}}class zt extends B{constructor(t,e){super(Object.assign(Object.assign({},e),{view:new Ct(t,{viewProps:e.viewProps})}))}}const Et={id:"separator",type:"blade",accept(t){const e=L(t,{view:M.required.constant("separator")});return e?{params:e}:null},controller:t=>new zt(t.document,{blade:t.blade,viewProps:t.viewProps}),api:t=>t.controller instanceof zt?new _t(t.controller):null},St=v("");function At(t,e){return x(t,St(void 0,e))}class Mt extends E{constructor(t){super(t)}static create(t){var e,n;const i=null!=t?t:{},o={disabled:null!==(e=i.disabled)&&void 0!==e&&e,disposed:!1,hidden:null!==(n=i.hidden)&&void 0!==n&&n},r=E.createCore(o);return new Mt(r)}bindClassModifiers(t){f(this,"disabled",At(t,"disabled")),f(this,"hidden",At(t,"hidden"))}bindDisabled(t){f(this,"disabled",(e=>{t.disabled=e}))}bindTabIndex(t){f(this,"disabled",(e=>{t.tabIndex=e?-1:0}))}handleDispose(t){this.value("disposed").emitter.on("change",(e=>{e&&t()}))}}const Lt=v("tbi");class kt{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Lt()),e.viewProps.bindClassModifiers(this.element),f(e.props,"selected",(t=>{t?this.element.classList.add(Lt(void 0,"sel")):this.element.classList.remove(Lt(void 0,"sel"))}));const n=t.createElement("button");n.classList.add(Lt("b")),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const i=t.createElement("div");i.classList.add(Lt("t")),b(e.props.value("title"),i),this.buttonElement.appendChild(i),this.titleElement=i}}class Vt{constructor(t,e){this.emitter=new u,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new kt(t,{props:e.props,viewProps:e.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Bt{constructor(t,e){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new Vt(t,{props:e.itemProps,viewProps:Mt.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new gt(t,{blade:Z(),viewProps:Mt.create()}),this.props=e.props,f(this.props,"selected",(t=>{this.itemController.props.set("selected",t),this.contentController.viewProps.set("hidden",!t)}))}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class Rt{constructor(t,e){this.controller_=t,this.rackApi_=e}get title(){var t;return null!==(t=this.controller_.itemController.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller_.itemController.props.set("title",t)}get selected(){return this.controller_.props.get("selected")}set selected(t){this.controller_.props.set("selected",t)}get children(){return this.rackApi_.children}addButton(t){return this.rackApi_.addButton(t)}addFolder(t){return this.rackApi_.addFolder(t)}addSeparator(t){return this.rackApi_.addSeparator(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addInput(t,e,n){return this.rackApi_.addInput(t,e,n)}addMonitor(t,e,n){return this.rackApi_.addMonitor(t,e,n)}addBlade(t){return this.rackApi_.addBlade(t)}}class Tt extends tt{constructor(t,e){super(t,new ct(t.rackController,e)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.emitter_=new u,this.pageApiMap_=new Map,this.rackApi_.on("change",(t=>{this.emitter_.emit("change",{event:t})})),this.rackApi_.on("update",(t=>{this.emitter_.emit("update",{event:t})})),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach((t=>{this.setUpPageApi_(t)}))}get pages(){return this.controller_.pageSet.items.map((t=>{const e=this.pageApiMap_.get(t);if(!e)throw c.shouldNeverHappen();return e}))}addPage(t){const e=this.controller_.view.element.ownerDocument,n=new Bt(e,{itemProps:E.fromObject({selected:!1,title:t.title}),props:E.fromObject({selected:!1})});this.controller_.add(n,t.index);const i=this.pageApiMap_.get(n);if(!i)throw c.shouldNeverHappen();return i}removePage(t){this.controller_.remove(t)}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}setUpPageApi_(t){const e=this.rackApi_.apiSet_.find((e=>e.controller_===t.contentController));if(!e)throw c.shouldNeverHappen();const n=new Rt(t,e);this.pageApiMap_.set(t,n)}onPageAdd_(t){this.setUpPageApi_(t.item)}onPageRemove_(t){if(!this.pageApiMap_.get(t.item))throw c.shouldNeverHappen();this.pageApiMap_.delete(t.item)}}const It=v("tab");class Ft{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(It(),ft()),e.viewProps.bindClassModifiers(this.element),g(e.empty,x(this.element,It(void 0,"nop")));const n=t.createElement("div");n.classList.add(It("i")),this.element.appendChild(n),this.itemsElement=n;const i=e.contentsElement;i.classList.add(It("c")),this.element.appendChild(i),this.contentsElement=i}}class qt extends ht{constructor(t,e){const n=new gt(t,{blade:e.blade,viewProps:e.viewProps}),i=z(!0);super({blade:e.blade,rackController:n,view:new Ft(t,{contentsElement:n.view.element,empty:i,viewProps:e.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onPageSelectedChange_=this.onPageSelectedChange_.bind(this),this.pageSet_=new et((()=>null)),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.empty_=i,this.applyPages_()}get pageSet(){return this.pageSet_}add(t,e){this.pageSet_.add(t,null!=e?e:this.pageSet_.items.length)}remove(t){this.pageSet_.remove(this.pageSet_.items[t])}applyPages_(){this.keepSelection_(),this.empty_.rawValue=0===this.pageSet_.items.length}onPageAdd_(t){const e=t.item;D(this.view.itemsElement,e.itemController.view.element,t.index),this.rackController.rack.add(e.contentController,t.index),e.props.value("selected").emitter.on("change",this.onPageSelectedChange_),this.applyPages_()}onPageRemove_(t){const e=t.item;O(e.itemController.view.element),this.rackController.rack.remove(e.contentController),e.props.value("selected").emitter.off("change",this.onPageSelectedChange_),this.applyPages_()}keepSelection_(){if(0===this.pageSet_.items.length)return;const t=this.pageSet_.items.findIndex((t=>t.props.get("selected")));t<0?this.pageSet_.items.forEach(((t,e)=>{t.props.set("selected",0===e)})):this.pageSet_.items.forEach(((e,n)=>{e.props.set("selected",n===t)}))}onPageSelectedChange_(t){if(t.rawValue){const e=this.pageSet_.items.findIndex((e=>e.props.value("selected")===t.sender));this.pageSet_.items.forEach(((t,n)=>{t.props.set("selected",n===e)}))}else this.keepSelection_()}}const Nt={id:"tab",type:"blade",accept(t){const e=M,n=L(t,{pages:e.required.array(e.required.object({title:e.required.string})),view:e.required.constant("tab")});return n&&0!==n.pages.length?{params:n}:null},controller(t){const e=new qt(t.document,{blade:t.blade,viewProps:t.viewProps});return t.params.pages.forEach((n=>{const i=new Bt(t.document,{itemProps:E.fromObject({selected:!1,title:n.title}),props:E.fromObject({selected:!1})});e.add(i)})),e},api:t=>t.controller instanceof qt?new Tt(t.controller,t.pool):null};class jt{constructor(){this.disabled=!1,this.emitter=new u}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class Dt{constructor(t,e){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=t,this.emitter=new u,this.interval_=e,this.setTimer_()}get disabled(){return this.disabled_}set disabled(t){this.disabled_=t,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(null===this.timerId_)return;const t=this.doc_.defaultView;t&&t.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const t=this.doc_.defaultView;t&&(this.timerId_=t.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Ot{constructor(t){this.constraints=t}constrain(t){return this.constraints.reduce(((t,e)=>e.constrain(t)),t)}}function Ut(t,e){if(t instanceof e)return t;if(t instanceof Ot){const n=t.constraints.reduce(((t,n)=>t||(n instanceof e?n:null)),null);if(n)return n}return null}class Wt{constructor(t){this.options=t}constrain(t){const e=this.options;return 0===e.length||e.filter((e=>e.value===t)).length>0?t:e[0].value}}class Gt{constructor(t){this.maxValue=t.max,this.minValue=t.min}constrain(t){let e=t;return s(this.minValue)||(e=Math.max(e,this.minValue)),s(this.maxValue)||(e=Math.min(e,this.maxValue)),e}}class Ht{constructor(t){this.step=t}constrain(t){return(t<0?-Math.round(-t/this.step):Math.round(t/this.step))*this.step}}const Kt=v("lst");class Yt{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.element=t.createElement("div"),this.element.classList.add(Kt()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("select");n.classList.add(Kt("s")),f(this.props_,"options",(e=>{U(n),e.forEach(((e,i)=>{const o=t.createElement("option");o.dataset.index=String(i),o.textContent=e.text,o.value=String(e.value),n.appendChild(o)}))})),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.selectElement=n;const i=t.createElement("div");i.classList.add(Kt("m")),i.appendChild(j(t,"dropdown")),this.element.appendChild(i),e.value.emitter.on("change",this.onValueChange_),this.value_=e.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class Xt{constructor(t,e){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new Yt(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(t){const e=t.currentTarget.selectedOptions.item(0);if(!e)return;const n=Number(e.dataset.index);this.value.rawValue=this.props.get("options")[n].value}}const Zt=v("pop");class $t{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Zt()),e.viewProps.bindClassModifiers(this.element),g(e.shows,x(this.element,Zt(void 0,"v")))}}class Qt{constructor(t,e){this.shows=z(!1),this.viewProps=e.viewProps,this.view=new $t(t,{shows:this.shows,viewProps:this.viewProps})}}const Jt=v("txt");class te{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Jt()),e.viewProps.bindClassModifiers(this.element),this.props_=e.props,this.props_.emitter.on("change",this.onChange_);const n=t.createElement("input");n.classList.add(Jt("i")),n.type="text",e.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,e.value.emitter.on("change",this.onChange_),this.value_=e.value,this.refresh()}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}onChange_(){this.refresh()}}class ee{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new te(t,{props:e.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const e=t.currentTarget.value,n=this.parser_(e);s(n)||(this.value.rawValue=n),this.view.refresh()}}function ne(t){return"false"!==t&&!!t}function ie(t){return function(t){return String(t)}(t)}class oe{constructor(t){this.text=t}evaluate(){return Number(this.text)}toString(){return this.text}}const re={"**":(t,e)=>Math.pow(t,e),"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e)=>t%e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e,"&":(t,e)=>t&e,"^":(t,e)=>t^e,"|":(t,e)=>t|e};class se{constructor(t,e,n){this.left=e,this.operator=t,this.right=n}evaluate(){const t=re[this.operator];if(!t)throw new Error(`unexpected binary operator: '${this.operator}`);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const ae={"+":t=>t,"-":t=>-t,"~":t=>~t};class le{constructor(t,e){this.operator=t,this.expression=e}evaluate(){const t=ae[this.operator];if(!t)throw new Error(`unexpected unary operator: '${this.operator}`);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function ce(t){return(e,n)=>{for(let i=0;i<t.length;i++){const o=t[i](e,n);if(""!==o)return o}return""}}function pe(t,e){var n;const i=t.substr(e).match(/^\s+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function he(t,e){var n;const i=t.substr(e).match(/^[0-9]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function ue(t,e){const n=t.substr(e,1);if(e+=1,"e"!==n.toLowerCase())return"";const i=function(t,e){const n=he(t,e);if(""!==n)return n;const i=t.substr(e,1);if("-"!==i&&"+"!==i)return"";const o=he(t,e+=1);return""===o?"":i+o}(t,e);return""===i?"":n+i}function de(t,e){const n=t.substr(e,1);if("0"===n)return n;const i=function(t,e){const n=t.substr(e,1);return n.match(/^[1-9]$/)?n:""}(t,e);return e+=i.length,""===i?"":i+he(t,e)}const ve=ce([function(t,e){const n=de(t,e);if(e+=n.length,""===n)return"";const i=t.substr(e,1);if(e+=i.length,"."!==i)return"";const o=he(t,e);return n+i+o+ue(t,e+=o.length)},function(t,e){const n=t.substr(e,1);if(e+=n.length,"."!==n)return"";const i=he(t,e);return e+=i.length,""===i?"":n+i+ue(t,e)},function(t,e){const n=de(t,e);return e+=n.length,""===n?"":n+ue(t,e)}]);const me=ce([function(t,e){const n=t.substr(e,2);if(e+=n.length,"0b"!==n.toLowerCase())return"";const i=function(t,e){var n;const i=t.substr(e).match(/^[01]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}(t,e);return""===i?"":n+i},function(t,e){const n=t.substr(e,2);if(e+=n.length,"0o"!==n.toLowerCase())return"";const i=function(t,e){var n;const i=t.substr(e).match(/^[0-7]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}(t,e);return""===i?"":n+i},function(t,e){const n=t.substr(e,2);if(e+=n.length,"0x"!==n.toLowerCase())return"";const i=function(t,e){var n;const i=t.substr(e).match(/^[0-9a-f]+/i);return null!==(n=i&&i[0])&&void 0!==n?n:""}(t,e);return""===i?"":n+i}]),ge=ce([me,ve]);function fe(t,e){return function(t,e){const n=ge(t,e);return e+=n.length,""===n?null:{evaluable:new oe(n),cursor:e}}(t,e)||function(t,e){const n=t.substr(e,1);if(e+=n.length,"("!==n)return null;const i=we(t,e);if(!i)return null;e=i.cursor,e+=pe(t,e).length;const o=t.substr(e,1);return e+=o.length,")"!==o?null:{evaluable:i.evaluable,cursor:e}}(t,e)}function xe(t,e,n){n+=pe(e,n).length;const i=t.filter((t=>e.startsWith(t,n)))[0];return i?(n+=i.length,{cursor:n+=pe(e,n).length,operator:i}):null}const be=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce(((t,e)=>function(t,e){return(n,i)=>{const o=t(n,i);if(!o)return null;i=o.cursor;let r=o.evaluable;for(;;){const o=xe(e,n,i);if(!o)break;i=o.cursor;const s=t(n,i);if(!s)return null;i=s.cursor,r=new se(o.operator,r,s.evaluable)}return r?{cursor:i,evaluable:r}:null}}(t,e)),(function t(e,n){const i=fe(e,n);if(i)return i;const o=e.substr(n,1);if(n+=o.length,"+"!==o&&"-"!==o&&"~"!==o)return null;const r=t(e,n);return r?{cursor:n=r.cursor,evaluable:new le(o,r.evaluable)}:null}));function we(t,e){return e+=pe(t,e).length,be(t,e)}function ye(t){var e;const n=function(t){const e=we(t,0);return e?e.cursor+pe(t,e.cursor).length!==t.length?null:e.evaluable:null}(t);return null!==(e=null==n?void 0:n.evaluate())&&void 0!==e?e:null}function _e(t){if("number"==typeof t)return t;if("string"==typeof t){const e=ye(t);if(!s(e))return e}return 0}function Pe(t){return String(t)}function Ce(t){return e=>e.toFixed(Math.max(Math.min(t,20),0))}const ze=Ce(0);function Ee(t){return ze(t)+"%"}function Se(t){return String(t)}function Ae(t){return t}function Me(t,e){for(;t.length<e;)t.push(void 0)}function Le(t){const e=[];return Me(e,t),z(e)}function ke(t){const e=t.indexOf(void 0);return e<0?t:t.slice(0,e)}function Ve({primary:t,secondary:e,forward:n,backward:i}){let o=!1;function r(t){o||(o=!0,t(),o=!1)}t.emitter.on("change",(i=>{r((()=>{e.setRawValue(n(t,e),i.options)}))})),e.emitter.on("change",(o=>{r((()=>{t.setRawValue(i(t,e),o.options)})),r((()=>{e.setRawValue(n(t,e),o.options)}))})),r((()=>{e.setRawValue(n(t,e),{forceEmit:!1,last:!0})}))}function Be(t,e){const n=t*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+n:e.downKey?-n:0}function Re(t){return{altKey:t.altKey,downKey:"ArrowDown"===t.key,shiftKey:t.shiftKey,upKey:"ArrowUp"===t.key}}function Te(t){return{altKey:t.altKey,downKey:"ArrowLeft"===t.key,shiftKey:t.shiftKey,upKey:"ArrowRight"===t.key}}function Ie(t){return function(t){return"ArrowUp"===t||"ArrowDown"===t}(t)||"ArrowLeft"===t||"ArrowRight"===t}function Fe(t,e){const n=e.ownerDocument.defaultView,i=e.getBoundingClientRect();return{x:t.pageX-((n&&n.scrollX||0)+i.left),y:t.pageY-((n&&n.scrollY||0)+i.top)}}class qe{constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new u,t.addEventListener("touchstart",this.onTouchStart_),t.addEventListener("touchmove",this.onTouchMove_),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}computePosition_(t){const e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var e;t.preventDefault(),null===(e=t.currentTarget)||void 0===e||e.focus();const n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_),n.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(Fe(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(Fe(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){const e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_),e.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(Fe(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();const e=t.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-n.left,y:e.clientY-n.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchMove_(t){const e=t.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-n.left,y:e.clientY-n.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchEnd_(t){var e;const n=null!==(e=t.targetTouches.item(0))&&void 0!==e?e:this.lastTouch_,i=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(n?{x:n.clientX-i.left,y:n.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey})}}function Ne(t,e,n,i,o){return i+(t-e)/(n-e)*(o-i)}function je(t){return String(t.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function De(t,e,n){return Math.min(Math.max(t,e),n)}function Oe(t,e){return(t%e+e)%e}const Ue=v("txt");class We{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(Ue(),Ue(void 0,"num")),e.arrayPosition&&this.element.classList.add(Ue(void 0,e.arrayPosition)),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("input");n.classList.add(Ue("i")),n.type="text",e.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=e.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Ue()),this.inputElement.classList.add(Ue("i"));const i=t.createElement("div");i.classList.add(Ue("k")),this.element.appendChild(i),this.knobElement=i;const o=t.createElementNS(R,"svg");o.classList.add(Ue("g")),this.knobElement.appendChild(o);const r=t.createElementNS(R,"path");r.classList.add(Ue("gb")),o.appendChild(r),this.guideBodyElem_=r;const s=t.createElementNS(R,"path");s.classList.add(Ue("gh")),o.appendChild(s),this.guideHeadElem_=s;const a=t.createElement("div");a.classList.add(v("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.refresh()}onDraggingChange_(t){if(null===t.rawValue)return void this.element.classList.remove(Ue(void 0,"drg"));this.element.classList.add(Ue(void 0,"drg"));const e=t.rawValue/this.props_.get("draggingScale"),n=e+(e>0?-1:e<0?1:0),i=De(-n,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${n+i},0 L${n},4 L${n+i},8`,`M ${e},-1 L${e},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${e},4`);const o=this.props_.get("formatter");this.tooltipElem_.textContent=o(this.value.rawValue),this.tooltipElem_.style.left=`${e}px`}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}}class Ge{constructor(t,e){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=e.baseStep,this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.dragging_=z(null),this.view=new We(t,{arrayPosition:e.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const n=new qe(this.view.knobElement);n.emitter.on("down",this.onPointerDown_),n.emitter.on("move",this.onPointerMove_),n.emitter.on("up",this.onPointerUp_)}onInputChange_(t){const e=t.currentTarget.value,n=this.parser_(e);s(n)||(this.value.rawValue=n),this.view.refresh()}onInputKeyDown_(t){const e=Be(this.baseStep_,Re(t));0!==e&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onInputKeyUp_(t){0!==Be(this.baseStep_,Re(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;const e=t.point.x-t.bounds.width/2;return this.originRawValue_+e*this.props.get("draggingScale")}onPointerMove_(t){const e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(t){const e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const He=v("sld");class Ke{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(He()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(He("t")),e.viewProps.bindTabIndex(n),this.element.appendChild(n),this.trackElement=n;const i=t.createElement("div");i.classList.add(He("k")),this.trackElement.appendChild(i),this.knobElement=i,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.update_()}update_(){const t=De(Ne(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${t}%`}onChange_(){this.update_()}}class Ye{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=e.baseStep,this.value=e.value,this.viewProps=e.viewProps,this.props=e.props,this.view=new Ke(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new qe(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){t.point&&this.value.setRawValue(Ne(De(t.point.x,0,t.bounds.width),0,t.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),e)}onPointerDownOrMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=Be(this.baseStep_,Te(t));0!==e&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onKeyUp_(t){0!==Be(this.baseStep_,Te(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Xe=v("sldtxt");class Ze{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Xe());const n=t.createElement("div");n.classList.add(Xe("s")),this.sliderView_=e.sliderView,n.appendChild(this.sliderView_.element),this.element.appendChild(n);const i=t.createElement("div");i.classList.add(Xe("t")),this.textView_=e.textView,i.appendChild(this.textView_.element),this.element.appendChild(i)}}class $e{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.sliderC_=new Ye(t,{baseStep:e.baseStep,props:e.sliderProps,value:e.value,viewProps:this.viewProps}),this.textC_=new Ge(t,{baseStep:e.baseStep,parser:e.parser,props:e.textProps,value:e.value,viewProps:e.viewProps}),this.view=new Ze(t,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Qe(t,e){t.write(e)}function Je(t){const e=M;return Array.isArray(t)?e.required.array(e.required.object({text:e.required.string,value:e.required.raw}))(t).value:"object"==typeof t?e.required.raw(t).value:void 0}function tn(t){if("inline"===t||"popup"===t)return t}function en(t){const e=M;return e.required.object({max:e.optional.number,min:e.optional.number,step:e.optional.number})(t).value}function nn(t){if(Array.isArray(t))return t;const e=[];return Object.keys(t).forEach((n=>{e.push({text:n,value:t[n]})})),e}function on(t){return s(t)?null:new Wt(nn(t))}function rn(t){const e=t?Ut(t,Wt):null;return e?e.options:null}function sn(t,e){const n=t&&Ut(t,Ht);return n?je(n.step):Math.max(je(e),2)}function an(t){const e=function(t){const e=t?Ut(t,Ht):null;return e?e.step:null}(t);return null!=e?e:1}function ln(t,e){var n;const i=t&&Ut(t,Ht),o=Math.abs(null!==(n=null==i?void 0:i.step)&&void 0!==n?n:e);return 0===o?.1:Math.pow(10,Math.floor(Math.log10(o))-1)}const cn=v("ckb");class pn{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(cn()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("label");n.classList.add(cn("l")),this.element.appendChild(n);const i=t.createElement("input");i.classList.add(cn("i")),i.type="checkbox",n.appendChild(i),this.inputElement=i,e.viewProps.bindDisabled(this.inputElement);const o=t.createElement("div");o.classList.add(cn("w")),n.appendChild(o);const r=j(t,"check");o.appendChild(r),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class hn{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new pn(t,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const e=t.currentTarget;this.value.rawValue=e.checked}}const un={id:"input-bool",type:"input",accept:(t,e)=>{if("boolean"!=typeof t)return null;const n=L(e,{options:M.optional.custom(Je)});return n?{initialValue:t,params:n}:null},binding:{reader:t=>ne,constraint:t=>function(t){const e=[],n=on(t.options);return n&&e.push(n),new Ot(e)}(t.params),writer:t=>Qe},controller:t=>{var e;const n=t.document,i=t.value,o=t.constraint;return o&&Ut(o,Wt)?new Xt(n,{props:E.fromObject({options:null!==(e=rn(o))&&void 0!==e?e:[]}),value:i,viewProps:t.viewProps}):new hn(n,{value:i,viewProps:t.viewProps})}},dn=v("col");class vn{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(dn()),e.foldable.bindExpandedClass(this.element,dn(void 0,"expanded")),f(e.foldable,"completed",x(this.element,dn(void 0,"cpl")));const n=t.createElement("div");n.classList.add(dn("h")),this.element.appendChild(n);const i=t.createElement("div");i.classList.add(dn("s")),n.appendChild(i),this.swatchElement=i;const o=t.createElement("div");if(o.classList.add(dn("t")),n.appendChild(o),this.textElement=o,"inline"===e.pickerLayout){const e=t.createElement("div");e.classList.add(dn("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}function mn(t,e,n){const i=Oe(t,360),o=De(e/100,0,1),r=De(n/100,0,1),s=r*o,a=s*(1-Math.abs(i/60%2-1)),l=r-s;let c,p,h;return[c,p,h]=i>=0&&i<60?[s,a,0]:i>=60&&i<120?[a,s,0]:i>=120&&i<180?[0,s,a]:i>=180&&i<240?[0,a,s]:i>=240&&i<300?[a,0,s]:[s,0,a],[255*(c+l),255*(p+l),255*(h+l)]}function gn(t){return[t[0],t[1],t[2]]}function fn(t,e){return[t[0],t[1],t[2],e]}const xn={hsl:{hsl:(t,e,n)=>[t,e,n],hsv:function(t,e,n){const i=n+e*(100-Math.abs(2*n-100))/200;return[t,0!==i?e*(100-Math.abs(2*n-100))/i:0,n+e*(100-Math.abs(2*n-100))/200]},rgb:function(t,e,n){const i=(t%360+360)%360,o=De(e/100,0,1),r=De(n/100,0,1),s=(1-Math.abs(2*r-1))*o,a=s*(1-Math.abs(i/60%2-1)),l=r-s/2;let c,p,h;return[c,p,h]=i>=0&&i<60?[s,a,0]:i>=60&&i<120?[a,s,0]:i>=120&&i<180?[0,s,a]:i>=180&&i<240?[0,a,s]:i>=240&&i<300?[a,0,s]:[s,0,a],[255*(c+l),255*(p+l),255*(h+l)]}},hsv:{hsl:function(t,e,n){const i=100-Math.abs(n*(200-e)/100-100);return[t,0!==i?e*n/i:0,n*(200-e)/200]},hsv:(t,e,n)=>[t,e,n],rgb:mn},rgb:{hsl:function(t,e,n){const i=De(t/255,0,1),o=De(e/255,0,1),r=De(n/255,0,1),s=Math.max(i,o,r),a=Math.min(i,o,r),l=s-a;let c=0,p=0;const h=(a+s)/2;return 0!==l&&(p=l/(1-Math.abs(s+a-1)),c=i===s?(o-r)/l:o===s?2+(r-i)/l:4+(i-o)/l,c=c/6+(c<0?1:0)),[360*c,100*p,100*h]},hsv:function(t,e,n){const i=De(t/255,0,1),o=De(e/255,0,1),r=De(n/255,0,1),s=Math.max(i,o,r),a=s-Math.min(i,o,r);let l;return l=0===a?0:s===i?((o-r)/a%6+6)%6*60:s===o?60*((r-i)/a+2):60*((i-o)/a+4),[l,100*(0===s?0:a/s),100*s]},rgb:(t,e,n)=>[t,e,n]}};const bn={hsl:t=>{var e;return[Oe(t[0],360),De(t[1],0,100),De(t[2],0,100),De(null!==(e=t[3])&&void 0!==e?e:1,0,1)]},hsv:t=>{var e;return[Oe(t[0],360),De(t[1],0,100),De(t[2],0,100),De(null!==(e=t[3])&&void 0!==e?e:1,0,1)]},rgb:t=>{var e;return[De(t[0],0,255),De(t[1],0,255),De(t[2],0,255),De(null!==(e=t[3])&&void 0!==e?e:1,0,1)]}};function wn(t,e){return"object"==typeof t&&!s(t)&&e in t&&"number"==typeof t[e]}class yn{constructor(t,e){this.mode_=e,this.comps_=bn[e](t)}static black(){return new yn([0,0,0],"rgb")}static fromObject(t){const e="a"in t?[t.r,t.g,t.b,t.a]:[t.r,t.g,t.b];return new yn(e,"rgb")}static toRgbaObject(t){return t.toRgbaObject()}static isRgbColorObject(t){return wn(t,"r")&&wn(t,"g")&&wn(t,"b")}static isRgbaColorObject(t){return this.isRgbColorObject(t)&&wn(t,"a")}static isColorObject(t){return this.isRgbColorObject(t)}static equals(t,e){if(t.mode_!==e.mode_)return!1;const n=t.comps_,i=e.comps_;for(let t=0;t<n.length;t++)if(n[t]!==i[t])return!1;return!0}get mode(){return this.mode_}getComponents(t){return fn((e=gn(this.comps_),n=this.mode_,i=t||this.mode_,xn[n][i](...e)),this.comps_[3]);var e,n,i}toRgbaObject(){const t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const _n=v("colp");class Pn{constructor(t,e){this.alphaViews_=null,this.element=t.createElement("div"),this.element.classList.add(_n());const n=t.createElement("div");n.classList.add(_n("hsv"));const i=t.createElement("div");i.classList.add(_n("sv")),this.svPaletteView_=e.svPaletteView,i.appendChild(this.svPaletteView_.element),n.appendChild(i);const o=t.createElement("div");o.classList.add(_n("h")),this.hPaletteView_=e.hPaletteView,o.appendChild(this.hPaletteView_.element),n.appendChild(o),this.element.appendChild(n);const r=t.createElement("div");if(r.classList.add(_n("rgb")),this.textView_=e.textView,r.appendChild(this.textView_.element),this.element.appendChild(r),e.alphaViews){this.alphaViews_={palette:e.alphaViews.palette,text:e.alphaViews.text};const n=t.createElement("div");n.classList.add(_n("a"));const i=t.createElement("div");i.classList.add(_n("ap")),i.appendChild(this.alphaViews_.palette.element),n.appendChild(i);const o=t.createElement("div");o.classList.add(_n("at")),o.appendChild(this.alphaViews_.text.element),n.appendChild(o),this.element.appendChild(n)}}get allFocusableElements(){const t=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map((t=>t.inputElement))];return this.alphaViews_&&t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),t}}function Cn(t){const e=M;return L(t,{alpha:e.optional.boolean,expanded:e.optional.boolean,picker:e.optional.custom(tn)})}function zn(t){return t?.1:1}function En(t,e){const n=t.match(/^(.+)%$/);return n?Math.min(.01*parseFloat(n[1])*e,e):Math.min(parseFloat(t),e)}const Sn={deg:t=>t,grad:t=>360*t/400,rad:t=>360*t/(2*Math.PI),turn:t=>360*t};function An(t){const e=t.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(t);const n=parseFloat(e[1]),i=e[2];return Sn[i](n)}const Mn={"func.rgb":t=>{const e=t.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const n=[En(e[1],255),En(e[2],255),En(e[3],255)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:new yn(n,"rgb")},"func.rgba":t=>{const e=t.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const n=[En(e[1],255),En(e[2],255),En(e[3],255),En(e[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:new yn(n,"rgb")},"func.hsl":t=>{const e=t.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const n=[An(e[1]),En(e[2],100),En(e[3],100)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:new yn(n,"hsl")},"func.hsla":t=>{const e=t.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const n=[An(e[1]),En(e[2],100),En(e[3],100),En(e[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:new yn(n,"hsl")},"hex.rgb":t=>{const e=t.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return new yn([parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)],"rgb");const n=t.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?new yn([parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)],"rgb"):null},"hex.rgba":t=>{const e=t.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return new yn([parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),Ne(parseInt(e[4]+e[4],16),0,255,0,1)],"rgb");const n=t.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?new yn([parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),Ne(parseInt(n[4],16),0,255,0,1)],"rgb"):null}};function Ln(t){return Object.keys(Mn).reduce(((e,n)=>e||((0,Mn[n])(t)?n:null)),null)}const kn=t=>{const e=Ln(t);return e?Mn[e](t):null};function Vn(t){return"func.hsla"===t||"func.rgba"===t||"hex.rgba"===t}function Bn(t){if("string"==typeof t){const e=kn(t);if(e)return e}return yn.black()}function Rn(t){const e=De(Math.floor(t),0,255).toString(16);return 1===e.length?`0${e}`:e}function Tn(t,e="#"){return`${e}${gn(t.getComponents("rgb")).map(Rn).join("")}`}function In(t,e="#"){const n=t.getComponents("rgb");return`${e}${[n[0],n[1],n[2],255*n[3]].map(Rn).join("")}`}function Fn(t){const e=Ce(0);return`rgb(${gn(t.getComponents("rgb")).map((t=>e(t))).join(", ")})`}function qn(t){const e=Ce(2),n=Ce(0);return`rgba(${t.getComponents("rgb").map(((t,i)=>(3===i?e:n)(t))).join(", ")})`}const Nn={"func.hsl":function(t){const e=[Ce(0),Ee,Ee];return`hsl(${gn(t.getComponents("hsl")).map(((t,n)=>e[n](t))).join(", ")})`},"func.hsla":function(t){const e=[Ce(0),Ee,Ee,Ce(2)];return`hsla(${t.getComponents("hsl").map(((t,n)=>e[n](t))).join(", ")})`},"func.rgb":Fn,"func.rgba":qn,"hex.rgb":Tn,"hex.rgba":In};function jn(t){return Nn[t]}const Dn=v("apl");class On{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Dn()),e.viewProps.bindTabIndex(this.element);const n=t.createElement("div");n.classList.add(Dn("b")),this.element.appendChild(n);const i=t.createElement("div");i.classList.add(Dn("c")),n.appendChild(i),this.colorElem_=i;const o=t.createElement("div");o.classList.add(Dn("m")),this.element.appendChild(o),this.markerElem_=o;const r=t.createElement("div");r.classList.add(Dn("p")),this.markerElem_.appendChild(r),this.previewElem_=r,this.update_()}update_(){const t=this.value.rawValue,e=t.getComponents("rgb"),n=new yn([e[0],e[1],e[2],0],"rgb"),i=new yn([e[0],e[1],e[2],255],"rgb"),o=["to right",qn(n),qn(i)];this.colorElem_.style.background=`linear-gradient(${o.join(",")})`,this.previewElem_.style.backgroundColor=qn(t);const r=Ne(e[3],0,1,0,100);this.markerElem_.style.left=`${r}%`}onValueChange_(){this.update_()}}class Un{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new On(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new qe(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const n=t.point.x/t.bounds.width,i=this.value.rawValue,[o,r,s]=i.getComponents("hsv");this.value.setRawValue(new yn([o,r,s,n],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=Be(zn(!0),Te(t));if(0===e)return;const n=this.value.rawValue,[i,o,r,s]=n.getComponents("hsv");this.value.setRawValue(new yn([i,o,r,s+e],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){0!==Be(zn(!0),Te(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Wn=v("coltxt");class Gn{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Wn());const n=t.createElement("div");n.classList.add(Wn("m")),this.modeElem_=function(t){const e=t.createElement("select");return e.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce(((e,n)=>{const i=t.createElement("option");return i.textContent=n.text,i.value=n.value,e.appendChild(i),e}),t.createDocumentFragment())),e}(t),this.modeElem_.classList.add(Wn("ms")),n.appendChild(this.modeSelectElement);const i=t.createElement("div");i.classList.add(Wn("mm")),i.appendChild(j(t,"dropdown")),n.appendChild(i),this.element.appendChild(n);const o=t.createElement("div");o.classList.add(Wn("w")),this.element.appendChild(o),this.textsElem_=o,this.textViews_=e.textViews,this.applyTextViews_(),g(e.colorMode,(t=>{this.modeElem_.value=t}))}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(t){this.textViews_=t,this.applyTextViews_()}applyTextViews_(){U(this.textsElem_);const t=this.element.ownerDocument;this.textViews_.forEach((e=>{const n=t.createElement("div");n.classList.add(Wn("c")),n.appendChild(e.element),this.textsElem_.appendChild(n)}))}}const Hn=Ce(0),Kn={rgb:()=>new Gt({min:0,max:255}),hsl:t=>new Gt(0===t?{min:0,max:360}:{min:0,max:100}),hsv:t=>new Gt(0===t?{min:0,max:360}:{min:0,max:100})};function Yn(t,e,n){return new Ge(t,{arrayPosition:0===n?"fst":2===n?"lst":"mid",baseStep:zn(!1),parser:e.parser,props:E.fromObject({draggingScale:1,formatter:Hn}),value:z(0,{constraint:Kn[e.colorMode](n)}),viewProps:e.viewProps})}class Xn{constructor(t,e){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.parser_=e.parser,this.value=e.value,this.viewProps=e.viewProps,this.colorMode=z(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(t),this.view=new Gn(t,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(t){const e={colorMode:this.colorMode.rawValue,parser:this.parser_,viewProps:this.viewProps},n=[Yn(t,e,0),Yn(t,e,1),Yn(t,e,2)];return n.forEach(((t,e)=>{Ve({primary:this.value,secondary:t.value,forward:t=>t.rawValue.getComponents(this.colorMode.rawValue)[e],backward:(t,n)=>{const i=this.colorMode.rawValue,o=t.rawValue.getComponents(i);return o[e]=n.rawValue,new yn(fn(gn(o),o[3]),i)}})})),n}onModeSelectChange_(t){const e=t.currentTarget;this.colorMode.rawValue=e.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const Zn=v("hpl");class $n{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Zn()),e.viewProps.bindTabIndex(this.element);const n=t.createElement("div");n.classList.add(Zn("c")),this.element.appendChild(n);const i=t.createElement("div");i.classList.add(Zn("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}update_(){const t=this.value.rawValue,[e]=t.getComponents("hsv");this.markerElem_.style.backgroundColor=Fn(new yn([e,100,100],"hsv"));const n=Ne(e,0,360,0,100);this.markerElem_.style.left=`${n}%`}onValueChange_(){this.update_()}}class Qn{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new $n(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new qe(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const n=Ne(t.point.x,0,t.bounds.width,0,360),i=this.value.rawValue,[,o,r,s]=i.getComponents("hsv");this.value.setRawValue(new yn([n,o,r,s],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=Be(zn(!1),Te(t));if(0===e)return;const n=this.value.rawValue,[i,o,r,s]=n.getComponents("hsv");this.value.setRawValue(new yn([i+e,o,r,s],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){0!==Be(zn(!1),Te(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Jn=v("svp");class ti{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Jn()),e.viewProps.bindTabIndex(this.element);const n=t.createElement("canvas");n.height=64,n.width=64,n.classList.add(Jn("c")),this.element.appendChild(n),this.canvasElement=n;const i=t.createElement("div");i.classList.add(Jn("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}update_(){const t=q(this.canvasElement);if(!t)return;const e=this.value.rawValue.getComponents("hsv"),n=this.canvasElement.width,i=this.canvasElement.height,o=t.getImageData(0,0,n,i),r=o.data;for(let t=0;t<i;t++)for(let o=0;o<n;o++){const s=Ne(o,0,n,0,100),a=Ne(t,0,i,100,0),l=mn(e[0],s,a),c=4*(t*n+o);r[c]=l[0],r[c+1]=l[1],r[c+2]=l[2],r[c+3]=255}t.putImageData(o,0,0);const s=Ne(e[1],0,100,0,100);this.markerElem_.style.left=`${s}%`;const a=Ne(e[2],0,100,100,0);this.markerElem_.style.top=`${a}%`}onValueChange_(){this.update_()}}class ei{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new ti(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new qe(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const n=Ne(t.point.x,0,t.bounds.width,0,100),i=Ne(t.point.y,0,t.bounds.height,100,0),[o,,,r]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new yn([o,n,i,r],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){Ie(t.key)&&t.preventDefault();const[e,n,i,o]=this.value.rawValue.getComponents("hsv"),r=zn(!1),s=Be(r,Te(t)),a=Be(r,Re(t));0===s&&0===a||this.value.setRawValue(new yn([e,n+s,i+a,o],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){const e=zn(!1),n=Be(e,Te(t)),i=Be(e,Re(t));0===n&&0===i||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class ni{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.hPaletteC_=new Qn(t,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new ei(t,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=e.supportsAlpha?{palette:new Un(t,{value:this.value,viewProps:this.viewProps}),text:new Ge(t,{parser:ye,baseStep:.1,props:E.fromObject({draggingScale:.01,formatter:Ce(2)}),value:z(0,{constraint:new Gt({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Ve({primary:this.value,secondary:this.alphaIcs_.text.value,forward:t=>t.rawValue.getComponents()[3],backward:(t,e)=>{const n=t.rawValue.getComponents();return n[3]=e.rawValue,new yn(n,t.rawValue.mode)}}),this.textC_=new Xn(t,{parser:ye,value:this.value,viewProps:this.viewProps}),this.view=new Pn(t,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:e.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const ii=v("colsw");class oi{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.element=t.createElement("div"),this.element.classList.add(ii()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(ii("sw")),this.element.appendChild(n),this.swatchElem_=n;const i=t.createElement("button");i.classList.add(ii("b")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i,this.update_()}update_(){const t=this.value.rawValue;this.swatchElem_.style.backgroundColor=In(t)}onValueChange_(){this.update_()}}class ri{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new oi(t,{value:this.value,viewProps:this.viewProps})}}class si{constructor(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=$.create(e.expanded),this.swatchC_=new ri(t,{value:this.value,viewProps:this.viewProps});const n=this.swatchC_.view.buttonElement;n.addEventListener("blur",this.onButtonBlur_),n.addEventListener("click",this.onButtonClick_),this.textC_=new ee(t,{parser:e.parser,props:E.fromObject({formatter:e.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new vn(t,{foldable:this.foldable_,pickerLayout:e.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===e.pickerLayout?new Qt(t,{viewProps:this.viewProps}):null;const i=new ni(t,{supportsAlpha:e.supportsAlpha,value:this.value,viewProps:this.viewProps});i.view.allFocusableElements.forEach((t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=i,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(i.view.element),Ve({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t.rawValue,backward:(t,e)=>e.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),J(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,n=t.relatedTarget;n&&e.contains(n)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,n=W(t);n&&e.contains(n)||n&&n===this.swatchC_.view.buttonElement&&!I(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.swatchC_.view.buttonElement.focus()}}function ai(t){return yn.isColorObject(t)?yn.fromObject(t):yn.black()}function li(t){return gn(t.getComponents("rgb")).reduce(((t,e)=>t<<8|255&Math.floor(e)),0)}function ci(t){return t.getComponents("rgb").reduce(((t,e,n)=>t<<8|255&Math.floor(3===n?255*e:e)),0)>>>0}function pi(t){return"number"!=typeof t?yn.black():new yn([(e=t)>>16&255,e>>8&255,255&e],"rgb");var e}function hi(t){return"number"!=typeof t?yn.black():new yn([(e=t)>>24&255,e>>16&255,e>>8&255,Ne(255&e,0,255,0,1)],"rgb");var e}function ui(t,e){const n=e.toRgbaObject();t.writeProperty("r",n.r),t.writeProperty("g",n.g),t.writeProperty("b",n.b),t.writeProperty("a",n.a)}function di(t,e){const n=e.toRgbaObject();t.writeProperty("r",n.r),t.writeProperty("g",n.g),t.writeProperty("b",n.b)}function vi(t){return"alpha"in t&&!0===t.alpha}function mi(t){return t?t=>In(t,"0x"):t=>Tn(t,"0x")}const gi={id:"input-color-number",type:"input",accept:(t,e)=>{if("number"!=typeof t)return null;if(!("view"in e))return null;if("color"!==e.view)return null;const n=Cn(e);return n?{initialValue:t,params:n}:null},binding:{reader:t=>vi(t.params)?hi:pi,equals:yn.equals,writer:t=>function(t){const e=t?ci:li;return(t,n)=>{Qe(t,e(n))}}(vi(t.params))},controller:t=>{const e=vi(t.params),n="expanded"in t.params?t.params.expanded:void 0,i="picker"in t.params?t.params.picker:void 0;return new si(t.document,{expanded:null!=n&&n,formatter:mi(e),parser:kn,pickerLayout:null!=i?i:"popup",supportsAlpha:e,value:t.value,viewProps:t.viewProps})}};const fi={id:"input-color-object",type:"input",accept:(t,e)=>{if(!yn.isColorObject(t))return null;const n=Cn(e);return n?{initialValue:t,params:n}:null},binding:{reader:t=>ai,equals:yn.equals,writer:t=>{return e=t.initialValue,yn.isRgbaColorObject(e)?ui:di;var e}},controller:t=>{const e=yn.isRgbaColorObject(t.initialValue),n="expanded"in t.params?t.params.expanded:void 0,i="picker"in t.params?t.params.picker:void 0,o=e?In:Tn;return new si(t.document,{expanded:null!=n&&n,formatter:o,parser:kn,pickerLayout:null!=i?i:"popup",supportsAlpha:e,value:t.value,viewProps:t.viewProps})}},xi={id:"input-color-string",type:"input",accept:(t,e)=>{if("string"!=typeof t)return null;if("view"in e&&"text"===e.view)return null;if(!Ln(t))return null;const n=Cn(e);return n?{initialValue:t,params:n}:null},binding:{reader:t=>Bn,equals:yn.equals,writer:t=>{const e=Ln(t.initialValue);if(!e)throw c.shouldNeverHappen();return function(t){const e=jn(t);return(t,n)=>{Qe(t,e(n))}}(e)}},controller:t=>{const e=Ln(t.initialValue);if(!e)throw c.shouldNeverHappen();const n=jn(e),i="expanded"in t.params?t.params.expanded:void 0,o="picker"in t.params?t.params.picker:void 0;return new si(t.document,{expanded:null!=i&&i,formatter:n,parser:kn,pickerLayout:null!=o?o:"popup",supportsAlpha:Vn(e),value:t.value,viewProps:t.viewProps})}};class bi{constructor(t){this.components=t.components,this.asm_=t.assembly}constrain(t){const e=this.asm_.toComponents(t).map(((t,e)=>{var n,i;return null!==(i=null===(n=this.components[e])||void 0===n?void 0:n.constrain(t))&&void 0!==i?i:t}));return this.asm_.fromComponents(e)}}const wi=v("pndtxt");class yi{constructor(t,e){this.textViews=e.textViews,this.element=t.createElement("div"),this.element.classList.add(wi()),this.textViews.forEach((e=>{const n=t.createElement("div");n.classList.add(wi("a")),n.appendChild(e.element),this.element.appendChild(n)}))}}class _i{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.acs_=e.axes.map(((n,i)=>function(t,e,n){return new Ge(t,{arrayPosition:0===n?"fst":n===e.axes.length-1?"lst":"mid",baseStep:e.axes[n].baseStep,parser:e.parser,props:e.axes[n].textProps,value:z(0,{constraint:e.axes[n].constraint}),viewProps:e.viewProps})}(t,e,i))),this.acs_.forEach(((t,n)=>{Ve({primary:this.value,secondary:t.value,forward:t=>e.assembly.toComponents(t.rawValue)[n],backward:(t,i)=>{const o=e.assembly.toComponents(t.rawValue);return o[n]=i.rawValue,e.assembly.fromComponents(o)}})})),this.view=new yi(t,{textViews:this.acs_.map((t=>t.view))})}}function Pi(t){const e=[],n=function(t){return"step"in t&&!s(t.step)?new Ht(t.step):null}(t);n&&e.push(n);const i=function(t){return"max"in t&&!s(t.max)||"min"in t&&!s(t.min)?new Gt({max:t.max,min:t.min}):null}(t);i&&e.push(i);const o=on(t.options);return o&&e.push(o),new Ot(e)}function Ci(t){const[e,n]=function(t){const e=t?Ut(t,Gt):null;return e?[e.minValue,e.maxValue]:[void 0,void 0]}(t);return[null!=e?e:0,null!=n?n:100]}const zi={id:"input-number",type:"input",accept:(t,e)=>{if("number"!=typeof t)return null;const n=M,i=L(e,{format:n.optional.function,max:n.optional.number,min:n.optional.number,options:n.optional.custom(Je),step:n.optional.number});return i?{initialValue:t,params:i}:null},binding:{reader:t=>_e,constraint:t=>Pi(t.params),writer:t=>Qe},controller:t=>{var e,n;const i=t.value,o=t.constraint;if(o&&Ut(o,Wt))return new Xt(t.document,{props:E.fromObject({options:null!==(e=rn(o))&&void 0!==e?e:[]}),value:i,viewProps:t.viewProps});const r=null!==(n="format"in t.params?t.params.format:void 0)&&void 0!==n?n:Ce(sn(o,i.rawValue));if(o&&Ut(o,Gt)){const[e,n]=Ci(o);return new $e(t.document,{baseStep:an(o),parser:ye,sliderProps:E.fromObject({maxValue:n,minValue:e}),textProps:E.fromObject({draggingScale:ln(o,i.rawValue),formatter:r}),value:i,viewProps:t.viewProps})}return new Ge(t.document,{baseStep:an(o),parser:ye,props:E.fromObject({draggingScale:ln(o,i.rawValue),formatter:r}),value:i,viewProps:t.viewProps})}};class Ei{constructor(t=0,e=0){this.x=t,this.y=e}getComponents(){return[this.x,this.y]}static isObject(t){if(s(t))return!1;const e=t.x,n=t.y;return"number"==typeof e&&"number"==typeof n}static equals(t,e){return t.x===e.x&&t.y===e.y}toObject(){return{x:this.x,y:this.y}}}const Si={toComponents:t=>t.getComponents(),fromComponents:t=>new Ei(...t)},Ai=v("p2d");class Mi{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ai()),e.viewProps.bindClassModifiers(this.element),g(e.expanded,x(this.element,Ai(void 0,"expanded")));const n=t.createElement("div");n.classList.add(Ai("h")),this.element.appendChild(n);const i=t.createElement("button");i.classList.add(Ai("b")),i.appendChild(j(t,"p2dpad")),e.viewProps.bindDisabled(i),n.appendChild(i),this.buttonElement=i;const o=t.createElement("div");if(o.classList.add(Ai("t")),n.appendChild(o),this.textElement=o,"inline"===e.pickerLayout){const e=t.createElement("div");e.classList.add(Ai("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}const Li=v("p2dp");class ki{constructor(t,e){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=e.invertsY,this.maxValue_=e.maxValue,this.element=t.createElement("div"),this.element.classList.add(Li()),"popup"===e.layout&&this.element.classList.add(Li(void 0,"p"));const n=t.createElement("div");n.classList.add(Li("p")),e.viewProps.bindTabIndex(n),this.element.appendChild(n),this.padElement=n;const i=t.createElementNS(R,"svg");i.classList.add(Li("g")),this.padElement.appendChild(i),this.svgElem_=i;const o=t.createElementNS(R,"line");o.classList.add(Li("ax")),o.setAttributeNS(null,"x1","0"),o.setAttributeNS(null,"y1","50%"),o.setAttributeNS(null,"x2","100%"),o.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(o);const r=t.createElementNS(R,"line");r.classList.add(Li("ax")),r.setAttributeNS(null,"x1","50%"),r.setAttributeNS(null,"y1","0"),r.setAttributeNS(null,"x2","50%"),r.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(r);const s=t.createElementNS(R,"line");s.classList.add(Li("l")),s.setAttributeNS(null,"x1","50%"),s.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(s),this.lineElem_=s;const a=t.createElement("div");a.classList.add(Li("m")),this.padElement.appendChild(a),this.markerElem_=a,e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[t,e]=this.value.rawValue.getComponents(),n=this.maxValue_,i=Ne(t,-n,+n,0,100),o=Ne(e,-n,+n,0,100),r=this.invertsY_?100-o:o;this.lineElem_.setAttributeNS(null,"x2",`${i}%`),this.lineElem_.setAttributeNS(null,"y2",`${r}%`),this.markerElem_.style.left=`${i}%`,this.markerElem_.style.top=`${r}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Vi(t,e,n){return[Be(e[0],Te(t)),Be(e[1],Re(t))*(n?1:-1)]}class Bi{constructor(t,e){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.baseSteps_=e.baseSteps,this.maxValue_=e.maxValue,this.invertsY_=e.invertsY,this.view=new ki(t,{invertsY:this.invertsY_,layout:e.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new qe(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const n=this.maxValue_,i=Ne(t.point.x,0,t.bounds.width,-n,+n),o=Ne(this.invertsY_?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-n,+n);this.value.setRawValue(new Ei(i,o),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onPadKeyDown_(t){Ie(t.key)&&t.preventDefault();const[e,n]=Vi(t,this.baseSteps_,this.invertsY_);0===e&&0===n||this.value.setRawValue(new Ei(this.value.rawValue.x+e,this.value.rawValue.y+n),{forceEmit:!1,last:!1})}onPadKeyUp_(t){const[e,n]=Vi(t,this.baseSteps_,this.invertsY_);0===e&&0===n||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Ri{constructor(t,e){var n,i;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=$.create(e.expanded),this.popC_="popup"===e.pickerLayout?new Qt(t,{viewProps:this.viewProps}):null;const o=new Bi(t,{baseSteps:[e.axes[0].baseStep,e.axes[1].baseStep],invertsY:e.invertsY,layout:e.pickerLayout,maxValue:e.maxValue,value:this.value,viewProps:this.viewProps});o.view.allFocusableElements.forEach((t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=o,this.textC_=new _i(t,{assembly:Si,axes:e.axes,parser:e.parser,value:this.value,viewProps:this.viewProps}),this.view=new Mi(t,{expanded:this.foldable_.value("expanded"),pickerLayout:e.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(n=this.view.buttonElement)||void 0===n||n.addEventListener("blur",this.onPadButtonBlur_),null===(i=this.view.buttonElement)||void 0===i||i.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Ve({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t.rawValue,backward:(t,e)=>e.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),J(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,n=t.relatedTarget;n&&e.contains(n)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,n=W(t);n&&e.contains(n)||n&&n===this.view.buttonElement&&!I(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.view.buttonElement.focus()}}function Ti(t){return Ei.isObject(t)?new Ei(t.x,t.y):new Ei}function Ii(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y)}function Fi(t){if(!t)return;const e=[];return s(t.step)||e.push(new Ht(t.step)),s(t.max)&&s(t.min)||e.push(new Gt({max:t.max,min:t.min})),new Ot(e)}function qi(t,e){const n=t&&Ut(t,Gt);if(n)return Math.max(Math.abs(n.minValue||0),Math.abs(n.maxValue||0));const i=an(t);return Math.max(10*Math.abs(i),10*Math.abs(e))}function Ni(t,e){const n=e instanceof bi?e.components[0]:void 0,i=e instanceof bi?e.components[1]:void 0,o=qi(n,t.x),r=qi(i,t.y);return Math.max(o,r)}function ji(t,e){return{baseStep:an(e),constraint:e,textProps:E.fromObject({draggingScale:ln(e,t),formatter:Ce(sn(e,t))})}}function Di(t){if(!("y"in t))return!1;const e=t.y;return!!e&&"inverted"in e&&!!e.inverted}const Oi={id:"input-point2d",type:"input",accept:(t,e)=>{if(!Ei.isObject(t))return null;const n=M,i=L(e,{expanded:n.optional.boolean,picker:n.optional.custom(tn),x:n.optional.custom(en),y:n.optional.object({inverted:n.optional.boolean,max:n.optional.number,min:n.optional.number,step:n.optional.number})});return i?{initialValue:t,params:i}:null},binding:{reader:t=>Ti,constraint:t=>{return e=t.params,new bi({assembly:Si,components:[Fi("x"in e?e.x:void 0),Fi("y"in e?e.y:void 0)]});var e},equals:Ei.equals,writer:t=>Ii},controller:t=>{const e=t.document,n=t.value,i=t.constraint;if(!(i instanceof bi))throw c.shouldNeverHappen();const o="expanded"in t.params?t.params.expanded:void 0,r="picker"in t.params?t.params.picker:void 0;return new Ri(e,{axes:[ji(n.rawValue.x,i.components[0]),ji(n.rawValue.y,i.components[1])],expanded:null!=o&&o,invertsY:Di(t.params),maxValue:Ni(n.rawValue,i),parser:ye,pickerLayout:null!=r?r:"popup",value:n,viewProps:t.viewProps})}};class Ui{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}getComponents(){return[this.x,this.y,this.z]}static isObject(t){if(s(t))return!1;const e=t.x,n=t.y,i=t.z;return"number"==typeof e&&"number"==typeof n&&"number"==typeof i}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const Wi={toComponents:t=>t.getComponents(),fromComponents:t=>new Ui(...t)};function Gi(t){return Ui.isObject(t)?new Ui(t.x,t.y,t.z):new Ui}function Hi(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z)}function Ki(t){if(!t)return;const e=[];return s(t.step)||e.push(new Ht(t.step)),s(t.max)&&s(t.min)||e.push(new Gt({max:t.max,min:t.min})),new Ot(e)}function Yi(t,e){return{baseStep:an(e),constraint:e,textProps:E.fromObject({draggingScale:ln(e,t),formatter:Ce(sn(e,t))})}}const Xi={id:"input-point3d",type:"input",accept:(t,e)=>{if(!Ui.isObject(t))return null;const n=M,i=L(e,{x:n.optional.custom(en),y:n.optional.custom(en),z:n.optional.custom(en)});return i?{initialValue:t,params:i}:null},binding:{reader:t=>Gi,constraint:t=>{return e=t.params,new bi({assembly:Wi,components:[Ki("x"in e?e.x:void 0),Ki("y"in e?e.y:void 0),Ki("z"in e?e.z:void 0)]});var e},equals:Ui.equals,writer:t=>Hi},controller:t=>{const e=t.value,n=t.constraint;if(!(n instanceof bi))throw c.shouldNeverHappen();return new _i(t.document,{assembly:Wi,axes:[Yi(e.rawValue.x,n.components[0]),Yi(e.rawValue.y,n.components[1]),Yi(e.rawValue.z,n.components[2])],parser:ye,value:e,viewProps:t.viewProps})}};class Zi{constructor(t=0,e=0,n=0,i=0){this.x=t,this.y=e,this.z=n,this.w=i}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(t){if(s(t))return!1;const e=t.x,n=t.y,i=t.z,o=t.w;return"number"==typeof e&&"number"==typeof n&&"number"==typeof i&&"number"==typeof o}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const $i={toComponents:t=>t.getComponents(),fromComponents:t=>new Zi(...t)};function Qi(t){return Zi.isObject(t)?new Zi(t.x,t.y,t.z,t.w):new Zi}function Ji(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z),t.writeProperty("w",e.w)}function to(t){if(!t)return;const e=[];return s(t.step)||e.push(new Ht(t.step)),s(t.max)&&s(t.min)||e.push(new Gt({max:t.max,min:t.min})),new Ot(e)}const eo={id:"input-point4d",type:"input",accept:(t,e)=>{if(!Zi.isObject(t))return null;const n=M,i=L(e,{x:n.optional.custom(en),y:n.optional.custom(en),z:n.optional.custom(en),w:n.optional.custom(en)});return i?{initialValue:t,params:i}:null},binding:{reader:t=>Qi,constraint:t=>{return e=t.params,new bi({assembly:$i,components:[to("x"in e?e.x:void 0),to("y"in e?e.y:void 0),to("z"in e?e.z:void 0),to("w"in e?e.w:void 0)]});var e},equals:Zi.equals,writer:t=>Ji},controller:t=>{const e=t.value,n=t.constraint;if(!(n instanceof bi))throw c.shouldNeverHappen();return new _i(t.document,{assembly:$i,axes:e.rawValue.getComponents().map(((t,e)=>{return i=t,{baseStep:an(o=n.components[e]),constraint:o,textProps:E.fromObject({draggingScale:ln(o,i),formatter:Ce(sn(o,i))})};var i,o})),parser:ye,value:e,viewProps:t.viewProps})}};const no={id:"input-string",type:"input",accept:(t,e)=>{if("string"!=typeof t)return null;const n=L(e,{options:M.optional.custom(Je)});return n?{initialValue:t,params:n}:null},binding:{reader:t=>Se,constraint:t=>function(t){const e=[],n=on(t.options);return n&&e.push(n),new Ot(e)}(t.params),writer:t=>Qe},controller:t=>{var e;const n=t.document,i=t.value,o=t.constraint;return o&&Ut(o,Wt)?new Xt(n,{props:E.fromObject({options:null!==(e=rn(o))&&void 0!==e?e:[]}),value:i,viewProps:t.viewProps}):new ee(n,{parser:t=>t,props:E.fromObject({formatter:Ae}),value:i,viewProps:t.viewProps})}},io={defaultInterval:200,defaultLineCount:3},oo=v("mll");class ro{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(oo()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("textarea");n.classList.add(oo("i")),n.style.height=`calc(var(--bld-us) * ${e.lineCount})`,n.readOnly=!0,e.viewProps.bindDisabled(n),this.element.appendChild(n),this.textareaElem_=n,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){const t=this.textareaElem_,e=t.scrollTop===t.scrollHeight-t.clientHeight,n=[];this.value.rawValue.forEach((t=>{void 0!==t&&n.push(this.formatter_(t))})),t.textContent=n.join("\n"),e&&(t.scrollTop=t.scrollHeight)}onValueUpdate_(){this.update_()}}class so{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new ro(t,{formatter:e.formatter,lineCount:e.lineCount,value:this.value,viewProps:this.viewProps})}}const ao=v("sgl");class lo{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(ao()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("input");n.classList.add(ao("i")),n.readOnly=!0,n.type="text",e.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){const t=this.value.rawValue,e=t[t.length-1];this.inputElement.value=void 0!==e?this.formatter_(e):""}onValueUpdate_(){this.update_()}}class co{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new lo(t,{formatter:e.formatter,value:this.value,viewProps:this.viewProps})}}const po={id:"monitor-bool",type:"monitor",accept:(t,e)=>{if("boolean"!=typeof t)return null;const n=L(e,{lineCount:M.optional.number});return n?{initialValue:t,params:n}:null},binding:{reader:t=>ne},controller:t=>{var e;return 1===t.value.rawValue.length?new co(t.document,{formatter:ie,value:t.value,viewProps:t.viewProps}):new so(t.document,{formatter:ie,lineCount:null!==(e=t.params.lineCount)&&void 0!==e?e:io.defaultLineCount,value:t.value,viewProps:t.viewProps})}};class ho{constructor(){this.emitter=new u,this.index_=-1}get index(){return this.index_}set index(t){this.index_!==t&&(this.index_=t,this.emitter.emit("change",{index:t,sender:this}))}}const uo=v("grl");class vo{constructor(t,e){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=t.createElement("div"),this.element.classList.add(uo()),e.viewProps.bindClassModifiers(this.element),this.formatter_=e.formatter,this.minValue_=e.minValue,this.maxValue_=e.maxValue,this.cursor_=e.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const n=t.createElementNS(R,"svg");n.classList.add(uo("g")),n.style.height=`calc(var(--bld-us) * ${e.lineCount})`,this.element.appendChild(n),this.svgElem_=n;const i=t.createElementNS(R,"polyline");this.svgElem_.appendChild(i),this.lineElem_=i;const o=t.createElement("div");o.classList.add(uo("t"),v("tt")()),this.element.appendChild(o),this.tooltipElem_=o,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const t=this.svgElem_.getBoundingClientRect(),e=this.value.rawValue.length-1,n=this.minValue_,i=this.maxValue_,o=[];this.value.rawValue.forEach(((r,s)=>{if(void 0===r)return;const a=Ne(s,0,e,0,t.width),l=Ne(r,n,i,t.height,0);o.push([a,l].join(","))})),this.lineElem_.setAttributeNS(null,"points",o.join(" "));const r=this.tooltipElem_,s=this.value.rawValue[this.cursor_.index];if(void 0===s)return void r.classList.remove(uo("t","a"));const a=Ne(this.cursor_.index,0,e,0,t.width),l=Ne(s,n,i,t.height,0);r.style.left=`${a}px`,r.style.top=`${l}px`,r.textContent=`${this.formatter_(s)}`,r.classList.contains(uo("t","a"))||(r.classList.add(uo("t","a"),uo("t","in")),T(r),r.classList.remove(uo("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class mo{constructor(t,e){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.cursor_=new ho,this.view=new vo(t,{cursor:this.cursor_,formatter:e.formatter,lineCount:e.lineCount,maxValue:e.maxValue,minValue:e.minValue,value:this.value,viewProps:this.viewProps}),I(t)){const t=new qe(this.view.element);t.emitter.on("down",this.onGraphPointerDown_),t.emitter.on("move",this.onGraphPointerMove_),t.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.index=-1}onGraphMouseMove_(t){const e=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(Ne(t.offsetX,0,e.width,0,this.value.rawValue.length))}onGraphPointerDown_(t){this.onGraphPointerMove_(t)}onGraphPointerMove_(t){t.data.point?this.cursor_.index=Math.floor(Ne(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.index=-1}onGraphPointerUp_(){this.cursor_.index=-1}}function go(t){return"format"in t&&!s(t.format)?t.format:Ce(2)}function fo(t){return"view"in t&&"graph"===t.view}const xo={id:"monitor-number",type:"monitor",accept:(t,e)=>{if("number"!=typeof t)return null;const n=M,i=L(e,{format:n.optional.function,lineCount:n.optional.number,max:n.optional.number,min:n.optional.number,view:n.optional.string});return i?{initialValue:t,params:i}:null},binding:{defaultBufferSize:t=>fo(t)?64:1,reader:t=>_e},controller:t=>fo(t.params)?function(t){var e,n,i;return new mo(t.document,{formatter:go(t.params),lineCount:null!==(e=t.params.lineCount)&&void 0!==e?e:io.defaultLineCount,maxValue:null!==(n="max"in t.params?t.params.max:null)&&void 0!==n?n:100,minValue:null!==(i="min"in t.params?t.params.min:null)&&void 0!==i?i:0,value:t.value,viewProps:t.viewProps})}(t):function(t){var e;return 1===t.value.rawValue.length?new co(t.document,{formatter:go(t.params),value:t.value,viewProps:t.viewProps}):new so(t.document,{formatter:go(t.params),lineCount:null!==(e=t.params.lineCount)&&void 0!==e?e:io.defaultLineCount,value:t.value,viewProps:t.viewProps})}(t)},bo={id:"monitor-string",type:"monitor",accept:(t,e)=>{if("string"!=typeof t)return null;const n=M,i=L(e,{lineCount:n.optional.number,multiline:n.optional.boolean});return i?{initialValue:t,params:i}:null},binding:{reader:t=>Se},controller:t=>{var e;const n=t.value;return n.rawValue.length>1||"multiline"in t.params&&t.params.multiline?new so(t.document,{formatter:Ae,lineCount:null!==(e=t.params.lineCount)&&void 0!==e?e:io.defaultLineCount,value:n,viewProps:t.viewProps}):new co(t.document,{formatter:Ae,value:n,viewProps:t.viewProps})}};class wo{constructor(t){this.onValueChange_=this.onValueChange_.bind(this),this.reader=t.reader,this.writer=t.writer,this.emitter=new u,this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.target=t.target,this.read()}read(){const t=this.target.read();void 0!==t&&(this.value.rawValue=this.reader(t))}write_(t){this.writer(this.target,t)}onValueChange_(t){this.write_(t.rawValue),this.emitter.emit("change",{options:t.options,rawValue:t.rawValue,sender:this})}}class yo{constructor(t){this.onTick_=this.onTick_.bind(this),this.reader_=t.reader,this.target=t.target,this.emitter=new u,this.value=t.value,this.ticker=t.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const t=this.target.read();if(void 0===t)return;const e=this.value.rawValue,n=this.reader_(t);this.value.rawValue=function(t,e){const n=[...ke(t),e];return n.length>t.length?n.splice(0,n.length-t.length):Me(n,t.length),n}(e,n),this.emitter.emit("update",{rawValue:n,sender:this})}onTick_(t){this.read()}}function _o(t,e){return 0===e?new jt:new Dt(t,null!=e?e:io.defaultInterval)}class Po{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(t){"blade"===t.type?this.pluginsMap_.blades.unshift(t):"input"===t.type?this.pluginsMap_.inputs.unshift(t):"monitor"===t.type&&this.pluginsMap_.monitors.unshift(t)}createInput(t,e,n){if(s(e.read()))throw new c({context:{key:e.key},type:"nomatchingcontroller"});const i=this.pluginsMap_.inputs.reduce(((i,o)=>i||function(t,e){const n=t.accept(e.target.read(),e.params);if(s(n))return null;const i=M,o={target:e.target,initialValue:n.initialValue,params:n.params},r=t.binding.reader(o),a=t.binding.constraint?t.binding.constraint(o):void 0,l=z(r(n.initialValue),{constraint:a,equals:t.binding.equals}),c=new wo({reader:r,target:e.target,value:l,writer:t.binding.writer(o)}),p=i.optional.boolean(e.params.disabled).value,h=i.optional.boolean(e.params.hidden).value,u=t.controller({constraint:a,document:e.document,initialValue:n.initialValue,params:n.params,value:c.value,viewProps:Mt.create({disabled:p,hidden:h})}),d=i.optional.string(e.params.label).value;return new it(e.document,{binding:c,blade:Z(),props:E.fromObject({label:d||e.target.key}),valueController:u})}(o,{document:t,target:e,params:n})),null);if(i)return i;throw new c({context:{key:e.key},type:"nomatchingcontroller"})}createMonitor(t,e,n){const i=this.pluginsMap_.monitors.reduce(((i,o)=>i||function(t,e){var n,i,o;const r=M,a=t.accept(e.target.read(),e.params);if(s(a))return null;const l={target:e.target,initialValue:a.initialValue,params:a.params},c=t.binding.reader(l),p=null!==(i=null!==(n=r.optional.number(e.params.bufferSize).value)&&void 0!==n?n:t.binding.defaultBufferSize&&t.binding.defaultBufferSize(a.params))&&void 0!==i?i:1,h=r.optional.number(e.params.interval).value,u=new yo({reader:c,target:e.target,ticker:_o(e.document,h),value:Le(p)}),d=r.optional.boolean(e.params.disabled).value,v=r.optional.boolean(e.params.hidden).value,m=t.controller({document:e.document,params:a.params,value:u.value,viewProps:Mt.create({disabled:d,hidden:v})}),g=null!==(o=r.optional.string(e.params.label).value)&&void 0!==o?o:e.target.key;return new rt(e.document,{binding:u,blade:Z(),props:E.fromObject({label:g}),valueController:m})}(o,{document:t,params:n,target:e})),null);if(i)return i;throw new c({context:{key:e.key},type:"nomatchingcontroller"})}createBlade(t,e){const n=this.pluginsMap_.blades.reduce(((n,i)=>n||function(t,e){const n=t.accept(e.params);if(!n)return null;const i=M.optional.boolean(e.params.disabled).value,o=M.optional.boolean(e.params.hidden).value;return t.controller({blade:Z(),document:e.document,params:Object.assign(Object.assign({},n.params),{disabled:i,hidden:o}),viewProps:Mt.create({disabled:i,hidden:o})})}(i,{document:t,params:e})),null);if(!n)throw new c({type:"nomatchingview",context:{params:e}});return n}createBladeApi(t){if(t instanceof it)return new nt(t);if(t instanceof rt)return new ot(t);if(t instanceof gt)return new ct(t,this);const e=this.pluginsMap_.blades.reduce(((e,n)=>e||n.api({controller:t,pool:this})),null);if(!e)throw c.shouldNeverHappen();return e}}class Co extends e{constructor(t){super(t),this.emitter_=new u,this.controller_.valueController.value.emitter.on("change",(t=>{this.emitter_.emit("change",{event:new i(this,t.rawValue)})}))}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get options(){return this.controller_.valueController.props.get("options")}set options(t){this.controller_.valueController.props.set("options",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}}class zo extends e{constructor(t){super(t),this.emitter_=new u,this.controller_.valueController.value.emitter.on("change",(t=>{this.emitter_.emit("change",{event:new i(this,t.rawValue)})}))}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(t){this.controller_.valueController.sliderController.props.set("maxValue",t)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(t){this.controller_.valueController.sliderController.props.set("minValue",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}}class Eo extends e{constructor(t){super(t),this.emitter_=new u,this.controller_.valueController.value.emitter.on("change",(t=>{this.emitter_.emit("change",{event:new i(this,t.rawValue)})}))}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(t){this.controller_.valueController.props.set("formatter",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}}const So={id:"list",type:"blade",accept(t){const e=M,n=L(t,{options:e.required.custom(Je),value:e.required.raw,view:e.required.constant("list"),label:e.optional.string});return n?{params:n}:null},controller(t){const e=new Xt(t.document,{props:E.fromObject({options:nn(t.params.options)}),value:z(t.params.value),viewProps:t.viewProps});return new yt(t.document,{blade:t.blade,props:E.fromObject({label:t.params.label}),valueController:e})},api:t=>t.controller instanceof yt&&t.controller.valueController instanceof Xt?new Co(t.controller):null};class Ao extends pt{constructor(t,e){super(t,e)}get element(){return this.controller_.view.element}importPreset(t){(function(t,e){t.forEach((t=>{const n=e[t.presetKey];void 0!==n&&t.write(n)}))})(this.controller_.rackController.rack.find(it).map((t=>t.binding.target)),t),this.refresh()}exportPreset(){return this.controller_.rackController.rack.find(it).map((t=>t.binding.target)).reduce(((t,e)=>Object.assign(t,{[e.presetKey]:e.read()})),{})}refresh(){this.controller_.rackController.rack.find(it).forEach((t=>{t.binding.read()})),this.controller_.rackController.rack.find(rt).forEach((t=>{t.binding.read()}))}}class Mo extends bt{constructor(t,e){super(t,{expanded:e.expanded,blade:e.blade,props:e.props,root:!0,viewProps:e.viewProps})}}const Lo={id:"slider",type:"blade",accept(t){const e=M,n=L(t,{max:e.required.number,min:e.required.number,view:e.required.constant("slider"),format:e.optional.function,label:e.optional.string,value:e.optional.number});return n?{params:n}:null},controller(t){var e,n;const i=null!==(e=t.params.value)&&void 0!==e?e:0,o=new $e(t.document,{baseStep:1,parser:ye,sliderProps:E.fromObject({maxValue:t.params.max,minValue:t.params.min}),textProps:E.fromObject({draggingScale:ln(void 0,i),formatter:null!==(n=t.params.format)&&void 0!==n?n:Pe}),value:z(i),viewProps:t.viewProps});return new yt(t.document,{blade:t.blade,props:E.fromObject({label:t.params.label}),valueController:o})},api:t=>t.controller instanceof yt&&t.controller.valueController instanceof $e?new zo(t.controller):null},ko={id:"text",type:"blade",accept(t){const e=M,n=L(t,{parse:e.required.function,value:e.required.raw,view:e.required.constant("text"),format:e.optional.function,label:e.optional.string});return n?{params:n}:null},controller(t){var e;const n=new ee(t.document,{parser:t.params.parse,props:E.fromObject({formatter:null!==(e=t.params.format)&&void 0!==e?e:t=>String(t)}),value:z(t.params.value),viewProps:t.viewProps});return new yt(t.document,{blade:t.blade,props:E.fromObject({label:t.params.label}),valueController:n})},api:t=>t.controller instanceof yt&&t.controller.valueController instanceof ee?new Eo(t.controller):null};function Vo(t,e,n){if(t.querySelector(`style[data-tp-style=${e}]`))return;const i=t.createElement("style");i.dataset.tpStyle=e,i.textContent=n,t.head.appendChild(i)}const Bo=new class{constructor(t){const[e,n]=t.split("-"),i=e.split(".");this.major=parseInt(i[0],10),this.minor=parseInt(i[1],10),this.patch=parseInt(i[2],10),this.prerelease=null!=n?n:null}toString(){const t=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[t,this.prerelease].join("-"):t}}("3.0.5");t.BladeApi=e,t.ButtonApi=h,t.FolderApi=pt,t.InputBindingApi=nt,t.ListApi=Co,t.MonitorBindingApi=ot,t.Pane=class extends Ao{constructor(t){var e;const n=t||{},i=null!==(e=n.document)&&void 0!==e?e:F().document,o=function(){const t=new Po;return[Oi,Xi,eo,no,zi,xi,fi,gi,un,po,bo,xo,Y,wt,Et,Nt].forEach((e=>{t.register(e)})),t}();super(new Mo(i,{expanded:n.expanded,blade:Z(),props:E.fromObject({title:n.title}),viewProps:Mt.create()}),o),this.pool_=o,this.containerElem_=n.container||function(t){const e=t.createElement("div");return e.classList.add(v("dfw")()),t.body&&t.body.appendChild(e),e}(i),this.containerElem_.appendChild(this.element),this.doc_=i,this.usesDefaultWrapper_=!n.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw c.alreadyDisposed();return this.doc_}dispose(){const t=this.containerElem_;if(!t)throw c.alreadyDisposed();if(this.usesDefaultWrapper_){const e=t.parentElement;e&&e.removeChild(t)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(t){("plugin"in t?[t.plugin]:"plugins"in t?t.plugins:[]).forEach((t=>{this.pool_.register(t),this.embedPluginStyle_(t)}))}embedPluginStyle_(t){t.css&&Vo(this.document,`plugin-${t.id}`,t.css)}setUpDefaultPlugins_(){Vo(this.document,"default",".tp-lstv_s,.tp-btnv_b,.tp-p2dv_b,.tp-colswv_sw,.tp-p2dpv_p,.tp-txtv_i,.tp-grlv_g,.tp-sglv_i,.tp-mllv_i,.tp-fldv_b,.tp-rotv_b,.tp-ckbv_i,.tp-coltxtv_ms,.tp-tbiv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-lstv_s,.tp-btnv_b,.tp-p2dv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-lstv_s:hover,.tp-btnv_b:hover,.tp-p2dv_b:hover{background-color:var(--btn-bg-h)}.tp-lstv_s:focus,.tp-btnv_b:focus,.tp-p2dv_b:focus{background-color:var(--btn-bg-f)}.tp-lstv_s:active,.tp-btnv_b:active,.tp-p2dv_b:active{background-color:var(--btn-bg-a)}.tp-lstv_s:disabled,.tp-btnv_b:disabled,.tp-p2dv_b:disabled{opacity:0.5}.tp-colswv_sw,.tp-p2dpv_p,.tp-txtv_i{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-colswv_sw:hover,.tp-p2dpv_p:hover,.tp-txtv_i:hover{background-color:var(--in-bg-h)}.tp-colswv_sw:focus,.tp-p2dpv_p:focus,.tp-txtv_i:focus{background-color:var(--in-bg-f)}.tp-colswv_sw:active,.tp-p2dpv_p:active,.tp-txtv_i:active{background-color:var(--in-bg-a)}.tp-colswv_sw:disabled,.tp-p2dpv_p:disabled,.tp-txtv_i:disabled{opacity:0.5}.tp-grlv_g,.tp-sglv_i,.tp-mllv_i{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);width:100%}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono,Source Code Pro,Menlo,Courier,monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #2f3137);--bs-sh: var(--tp-base-shadow-color, rgba(0,0,0,0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #2f3137);--cnt-bg: var(--tp-container-background-color, rgba(187,188,196,0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187,188,196,0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187,188,196,0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187,188,196,0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(0,0,0,0.2));--in-bg-a: var(--tp-input-background-color-active, rgba(0,0,0,0.35));--in-bg-f: var(--tp-input-background-color-focus, rgba(0,0,0,0.3));--in-bg-h: var(--tp-input-background-color-hover, rgba(0,0,0,0.25));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187,188,196,0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0,0,0,0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187,188,196,0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(0,0,0,0.2))}.tp-fldv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-rotv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1 * var(--cnt-v-p))}.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-fldv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-rotv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-fldv_c>.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv{margin-left:4px}.tp-fldv_c>.tp-fldv>.tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-fldv_c .tp-fldv>.tp-fldv_c,.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-fldv_c>.tp-tabv>.tp-tabv_i,.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-fldv_c .tp-tabv>.tp-tabv_c,.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-fldv_b,.tp-rotv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:calc(var(--cnt-h-p) + 8px);padding-right:calc(2px * 2 + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-fldv_b:hover,.tp-rotv_b:hover{background-color:var(--cnt-bg-h)}.tp-fldv_b:focus,.tp-rotv_b:focus{background-color:var(--cnt-bg-f)}.tp-fldv_b:active,.tp-rotv_b:active{background-color:var(--cnt-bg-a)}.tp-fldv_b:disabled,.tp-rotv_b:disabled{opacity:0.5}.tp-fldv_m,.tp-rotv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:'';display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px) / 2 - 2px);margin:auto;opacity:0.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m,.tp-rotv.tp-rotv-expanded .tp-rotv_m{transform:none}.tp-fldv_c,.tp-rotv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c,.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c{display:none}.tp-fldv.tp-fldv-expanded>.tp-fldv_c,.tp-rotv.tp-rotv-expanded .tp-rotv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-coltxtv_m,.tp-lstv{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-coltxtv_mm,.tp-lstv_m{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-coltxtv_mm svg,.tp-lstv_m svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-coltxtv_mm svg path,.tp-lstv_m svg path{fill:currentColor}.tp-coltxtv_w,.tp-pndtxtv{display:flex}.tp-coltxtv_c,.tp-pndtxtv_a{width:100%}.tp-coltxtv_c+.tp-coltxtv_c,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-pndtxtv_a{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:0.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1 * var(--cnt-h-p));right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:'';height:2px;left:calc(-1 * var(--cnt-h-p));position:absolute;right:calc(-1 * var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us) * 4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,0.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0,0,0,0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,0.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,0.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,0.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,0.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br)}.tp-colswv.tp-v-disabled{opacity:0.5}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,0.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:'';display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us) * 3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left 0.05s, top 0.05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:0.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:0.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:0.5}.tp-mllv_i{display:block;height:calc(var(--bld-us) * 3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:0.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1 * var(--cnt-h-p));right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:0.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:0.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:0.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:'';display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:'';display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:'';display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:0.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:'';height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:'';height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:0.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:0.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:0.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:'';height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:0.1;position:absolute;top:0;transition:border-radius 0.1s, height 0.1s, transform 0.1s, width 0.1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:'';font-size:0.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(2px * 2 + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1 * var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1 * var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}"),this.pool_.getAll().forEach((t=>{this.embedPluginStyle_(t)})),this.registerPlugin({plugins:[Lo,So,Nt,ko]})}},t.SeparatorApi=_t,t.SliderApi=zo,t.TabApi=Tt,t.TabPageApi=Rt,t.TextApi=Eo,t.TpChangeEvent=i,t.VERSION=Bo,Object.defineProperty(t,"__esModule",{value:!0})}(e)}},n={};function i(e){var o=n[e];if(void 0!==o)return o.exports;var r=n[e]={exports:{}};return t[e].call(r.exports,r,r.exports,i),r.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;i.g.importScripts&&(t=i.g.location+"");var e=i.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");n.length&&(t=n[n.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t})(),(()=>{"use strict";var t,n=(t=function(t,e){for(var n=["webgl","experimental-webgl","webkit-3d","moz-webgl"],i=null,o=0;o<n.length;++o){try{i=t.getContext(n[o],e)}catch(t){}if(i)break}return i},{create3DContext:t,setupWebGL:(e,n,i)=>{i=i||function(t){var e=document.getElementsByTagName("body")[0];if(e){var n=window.WebGLRenderingContext?'It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org">Click here for more information.</a>':'This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>';t&&(n+="<br/><br/>Status: "+t),e.innerHTML=function(t){return'<div style="margin: auto; width:500px;z-index:10000;margin-top:20em;text-align:center;">'+t+"</div>"}(n)}},e.addEventListener&&e.addEventListener("webglcontextcreationerror",(function(t){i(t.statusMessage)}),!1);var o=t(e,n);return o||(window.WebGLRenderingContext,i("")),o}}),o=function(){var t={enable:{0:!0},disable:{0:!0},getParameter:{0:!0},drawArrays:{0:!0},drawElements:{0:!0,2:!0},createShader:{0:!0},getShaderParameter:{1:!0},getProgramParameter:{1:!0},getVertexAttrib:{1:!0},vertexAttribPointer:{2:!0},bindTexture:{0:!0},activeTexture:{0:!0},getTexParameter:{0:!0,1:!0},texParameterf:{0:!0,1:!0},texParameteri:{0:!0,1:!0,2:!0},texImage2D:{0:!0,2:!0,6:!0,7:!0},texSubImage2D:{0:!0,6:!0,7:!0},copyTexImage2D:{0:!0,2:!0},copyTexSubImage2D:{0:!0},generateMipmap:{0:!0},bindBuffer:{0:!0},bufferData:{0:!0,2:!0},bufferSubData:{0:!0},getBufferParameter:{0:!0,1:!0},pixelStorei:{0:!0,1:!0},readPixels:{4:!0,5:!0},bindRenderbuffer:{0:!0},bindFramebuffer:{0:!0},checkFramebufferStatus:{0:!0},framebufferRenderbuffer:{0:!0,1:!0,2:!0},framebufferTexture2D:{0:!0,1:!0,2:!0},getFramebufferAttachmentParameter:{0:!0,1:!0,2:!0},getRenderbufferParameter:{0:!0,1:!0},renderbufferStorage:{0:!0,1:!0},clear:{0:!0},depthFunc:{0:!0},blendFunc:{0:!0,1:!0},blendFuncSeparate:{0:!0,1:!0,2:!0,3:!0},blendEquation:{0:!0},blendEquationSeparate:{0:!0,1:!0},stencilFunc:{0:!0},stencilFuncSeparate:{0:!0,1:!0},stencilMaskSeparate:{0:!0},stencilOp:{0:!0,1:!0,2:!0},stencilOpSeparate:{0:!0,1:!0,2:!0,3:!0},cullFace:{0:!0},frontFace:{0:!0}},e=null;function n(t){if(null==e)for(var n in e={},t)"number"==typeof t[n]&&(e[t[n]]=n)}function i(){if(null==e)throw"WebGLDebugUtils.init(ctx) not called"}function o(t){i();var n=e[t];return void 0!==n?n:"*UNKNOWN WebGL ENUM (0x"+t.toString(16)+")"}function r(e,n,i){var r=t[e];return void 0!==r&&r[n]?o(i):i.toString()}function s(t){var e=t.getParameter(t.MAX_VERTEX_ATTRIBS),n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n);for(var i=0;i<e;++i)t.disableVertexAttribArray(i),t.vertexAttribPointer(i,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(i,0);t.deleteBuffer(n);var o=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);for(i=0;i<o;++i)t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null);for(t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),t.colorMask(!0,!0,!0,!0),t.cullFace(t.BACK),t.depthFunc(t.LESS),t.depthMask(!0),t.depthRange(0,1),t.frontFace(t.CCW),t.hint(t.GENERATE_MIPMAP_HINT,t.DONT_CARE),t.lineWidth(1),t.pixelStorei(t.PACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.UNPACK_COLORSPACE_CONVERSION_WEBGL&&t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.BROWSER_DEFAULT_WEBGL),t.polygonOffset(0,0),t.sampleCoverage(1,!1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilMask(4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.viewport(0,0,t.canvas.clientWidth,t.canvas.clientHeight),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT);t.getError(););}return{init:n,mightBeEnum:function(t){return i(),void 0!==e[t]},glEnumToString:o,glFunctionArgToString:r,makeDebugContext:function(t,e){n(t),e=e||function(t,e,n){for(var i,s="",a=0;a<n.length;++a)s+=(0==a?"":", ")+r(e,a,n[a]);i="WebGL error "+o(t)+" in "+e+"("+s+")",window.console&&window.console.log&&window.console.log(i)};var i={};function s(t,n){return function(){var o=t[n].apply(t,arguments),r=t.getError();return 0!=r&&(i[r]=!0,e(r,n,arguments)),o}}var a={};for(var l in t)"function"==typeof t[l]?a[l]=s(t,l):a[l]=t[l];return a.getError=function(){for(var e in i)if(i[e])return i[e]=!1,e;return t.NO_ERROR},a},makeLostContextSimulatingContext:function(t){var e={},n=1,i=!1,o=[],r=void 0,a=void 0,l=void 0,c={};function p(t){for(var e=0;e<t.length;++e){var i=t[e];if((o=i)instanceof WebGLBuffer||o instanceof WebGLFramebuffer||o instanceof WebGLProgram||o instanceof WebGLRenderbuffer||o instanceof WebGLShader||o instanceof WebGLTexture)return i.__webglDebugContextLostId__==n}var o;return!0}function h(t,e){var n=t[e];return function(){if(!i){if(!p(arguments))return void(c[t.INVALID_OPERATION]=!0);var e=n.apply(t,arguments);return e}}}for(var u in t)"function"==typeof t[u]?e[u]=h(t,u):e[u]=t[u];function d(t){return{statusMessage:t}}e.loseContext=function(){if(!i){for(i=!0,++n;t.getError(););!function(){for(var t=Object.keys(c),e=0;e<t.length;++e)delete glErrorShdow_[t]}(),c[t.CONTEXT_LOST_WEBGL]=!0,setTimeout((function(){r&&r(d("context lost"))}),0)}},e.restoreContext=function(){if(i){if(!a)throw"You can not restore the context without a listener";setTimeout((function(){if(function(){for(var e=0;e<o.length;++e){var n=o[e];n instanceof WebGLBuffer?t.deleteBuffer(n):n instanceof WebctxFramebuffer?t.deleteFramebuffer(n):n instanceof WebctxProgram?t.deleteProgram(n):n instanceof WebctxRenderbuffer?t.deleteRenderbuffer(n):n instanceof WebctxShader?t.deleteShader(n):n instanceof WebctxTexture&&t.deleteTexture(n)}}(),s(t),i=!1,a){var e=a;a=l,l=void 0,e(d("context restored"))}}),0)}},e.getError=function(){if(!i)for(;e=t.getError();)c[e]=!0;for(var e in c)if(c[e])return delete c[e],e;return t.NO_ERROR};for(var v=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],m=0;m<v.length;++m)e[b=v[m]]=function(e){return function(){if(i)return null;var r=e.apply(t,arguments);return r.__webglDebugContextLostId__=n,o.push(r),r}}(t[b]);var g=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(m=0;m<g.length;++m)e[b=g[m]]=function(e){return function(){return i?null:e.apply(t,arguments)}}(e[b]);var f,x=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(m=0;m<x.length;++m){var b;e[b=x[m]]=function(e){return function(){return!i&&e.apply(t,arguments)}}(e[b])}function w(t){return"function"==typeof t?t:function(e){t.handleEvent(e)}}return e.checkFramebufferStatus=(f=e.checkFramebufferStatus,function(){return i?t.FRAMEBUFFER_UNSUPPORTED:f.apply(t,arguments)}),e.getAttribLocation=function(e){return function(){return i?-1:e.apply(t,arguments)}}(e.getAttribLocation),e.getVertexAttribOffset=function(e){return function(){return i?0:e.apply(t,arguments)}}(e.getVertexAttribOffset),e.isContextLost=function(){return i},e.registerOnContextLostListener=function(t){r=w(t)},e.registerOnContextRestoredListener=function(t){i?l=w(t):a=w(t)},e},resetToInitialState:s}}();function r(t,e,n){var i=t.createShader(e);if(null==i)return console.log("unable to create shader"),null;if(t.shaderSource(i,n),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS)){var o=t.getShaderInfoLog(i);return console.log("Failed to compile shader: "+o),t.deleteShader(i),null}return i}class s{constructor(t){var e=new Float32Array(3);t&&"object"==typeof t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2]),this.elements=e}set(t){var e,n,i;if(i=this.elements,(n=Array.isArray(t)?t:t.elements)!==i){for(e=0;e<3;++e)i[e]=n[e];return this}}add(t){for(var e=0;e<3;e++)this.elements[e]+=t.elements[e];return this}sub(t){for(var e=0;e<3;e++)this.elements[e]-=t.elements[e];return this}div(t){for(var e=0;e<3;e++)this.elements[e]/=t;return this}mul(t){for(var e=0;e<3;e++)this.elements[e]*=t;return this}static dot(t,e){let n=0;for(var i=0;i<3;i++)n+=t.elements[i]*e.elements[i];return n}static cross(t,e){let n=t.elements,i=e.elements,o=n[1]*i[2]-n[2]*i[1],r=-1*(n[0]*i[2]-n[2]*i[0]),a=n[0]*i[1]-n[1]*i[0];return new s([o,r,a])}magnitude(){let t=0;for(var e=0;e<3;e++)t+=this.elements[e]*this.elements[e];return t=Math.sqrt(t),t}normalize(){return this.div(this.magnitude()),this}}class a{constructor(t){var e=new Float32Array(4);t&&"object"==typeof t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),this.elements=e}}class l{constructor(t){var e,n,i;if(t&&"object"==typeof t&&t.hasOwnProperty("elements")){for(n=t.elements,i=new Float32Array(16),e=0;e<16;++e)i[e]=n[e];this.elements=i}else this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}setIdentity(){var t=this.elements;return t[0]=1,t[4]=0,t[8]=0,t[12]=0,t[1]=0,t[5]=1,t[9]=0,t[13]=0,t[2]=0,t[6]=0,t[10]=1,t[14]=0,t[3]=0,t[7]=0,t[11]=0,t[15]=1,this}set(t){var e,n,i;if((n=t.elements)!==(i=this.elements)){for(e=0;e<16;++e)i[e]=n[e];return this}}multiply(t){var e,n,i,o,r,s,a,l;if(n=this.elements,i=this.elements,n===(o=t.elements))for(o=new Float32Array(16),e=0;e<16;++e)o[e]=n[e];for(e=0;e<4;e++)r=i[e],s=i[e+4],a=i[e+8],l=i[e+12],n[e]=r*o[0]+s*o[1]+a*o[2]+l*o[3],n[e+4]=r*o[4]+s*o[5]+a*o[6]+l*o[7],n[e+8]=r*o[8]+s*o[9]+a*o[10]+l*o[11],n[e+12]=r*o[12]+s*o[13]+a*o[14]+l*o[15];return this}concat(t){return this.multiply(t)}multiplyVector3(t){var e=this.elements,n=t.elements,i=new s,o=i.elements;return o[0]=n[0]*e[0]+n[1]*e[4]+n[2]*e[8]+e[12],o[1]=n[0]*e[1]+n[1]*e[5]+n[2]*e[9]+e[13],o[2]=n[0]*e[2]+n[1]*e[6]+n[2]*e[10]+e[14],i}multiplyVector4(t){var e=this.elements,n=t.elements,i=new a,o=i.elements;return o[0]=n[0]*e[0]+n[1]*e[4]+n[2]*e[8]+n[3]*e[12],o[1]=n[0]*e[1]+n[1]*e[5]+n[2]*e[9]+n[3]*e[13],o[2]=n[0]*e[2]+n[1]*e[6]+n[2]*e[10]+n[3]*e[14],o[3]=n[0]*e[3]+n[1]*e[7]+n[2]*e[11]+n[3]*e[15],i}transpose(){var t,e;return e=(t=this.elements)[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setInverseOf(t){var e,n,i,o,r;if(n=t.elements,i=this.elements,(o=new Float32Array(16))[0]=n[5]*n[10]*n[15]-n[5]*n[11]*n[14]-n[9]*n[6]*n[15]+n[9]*n[7]*n[14]+n[13]*n[6]*n[11]-n[13]*n[7]*n[10],o[4]=-n[4]*n[10]*n[15]+n[4]*n[11]*n[14]+n[8]*n[6]*n[15]-n[8]*n[7]*n[14]-n[12]*n[6]*n[11]+n[12]*n[7]*n[10],o[8]=n[4]*n[9]*n[15]-n[4]*n[11]*n[13]-n[8]*n[5]*n[15]+n[8]*n[7]*n[13]+n[12]*n[5]*n[11]-n[12]*n[7]*n[9],o[12]=-n[4]*n[9]*n[14]+n[4]*n[10]*n[13]+n[8]*n[5]*n[14]-n[8]*n[6]*n[13]-n[12]*n[5]*n[10]+n[12]*n[6]*n[9],o[1]=-n[1]*n[10]*n[15]+n[1]*n[11]*n[14]+n[9]*n[2]*n[15]-n[9]*n[3]*n[14]-n[13]*n[2]*n[11]+n[13]*n[3]*n[10],o[5]=n[0]*n[10]*n[15]-n[0]*n[11]*n[14]-n[8]*n[2]*n[15]+n[8]*n[3]*n[14]+n[12]*n[2]*n[11]-n[12]*n[3]*n[10],o[9]=-n[0]*n[9]*n[15]+n[0]*n[11]*n[13]+n[8]*n[1]*n[15]-n[8]*n[3]*n[13]-n[12]*n[1]*n[11]+n[12]*n[3]*n[9],o[13]=n[0]*n[9]*n[14]-n[0]*n[10]*n[13]-n[8]*n[1]*n[14]+n[8]*n[2]*n[13]+n[12]*n[1]*n[10]-n[12]*n[2]*n[9],o[2]=n[1]*n[6]*n[15]-n[1]*n[7]*n[14]-n[5]*n[2]*n[15]+n[5]*n[3]*n[14]+n[13]*n[2]*n[7]-n[13]*n[3]*n[6],o[6]=-n[0]*n[6]*n[15]+n[0]*n[7]*n[14]+n[4]*n[2]*n[15]-n[4]*n[3]*n[14]-n[12]*n[2]*n[7]+n[12]*n[3]*n[6],o[10]=n[0]*n[5]*n[15]-n[0]*n[7]*n[13]-n[4]*n[1]*n[15]+n[4]*n[3]*n[13]+n[12]*n[1]*n[7]-n[12]*n[3]*n[5],o[14]=-n[0]*n[5]*n[14]+n[0]*n[6]*n[13]+n[4]*n[1]*n[14]-n[4]*n[2]*n[13]-n[12]*n[1]*n[6]+n[12]*n[2]*n[5],o[3]=-n[1]*n[6]*n[11]+n[1]*n[7]*n[10]+n[5]*n[2]*n[11]-n[5]*n[3]*n[10]-n[9]*n[2]*n[7]+n[9]*n[3]*n[6],o[7]=n[0]*n[6]*n[11]-n[0]*n[7]*n[10]-n[4]*n[2]*n[11]+n[4]*n[3]*n[10]+n[8]*n[2]*n[7]-n[8]*n[3]*n[6],o[11]=-n[0]*n[5]*n[11]+n[0]*n[7]*n[9]+n[4]*n[1]*n[11]-n[4]*n[3]*n[9]-n[8]*n[1]*n[7]+n[8]*n[3]*n[5],o[15]=n[0]*n[5]*n[10]-n[0]*n[6]*n[9]-n[4]*n[1]*n[10]+n[4]*n[2]*n[9]+n[8]*n[1]*n[6]-n[8]*n[2]*n[5],0==(r=n[0]*o[0]+n[1]*o[4]+n[2]*o[8]+n[3]*o[12]))return this;for(r=1/r,e=0;e<16;e++)i[e]=o[e]*r;return this}invert(){return this.setInverseOf(this)}setOrtho(t,e,n,i,o,r){var s,a,l,c;if(t===e||n===i||o===r)throw"null frustum";return a=1/(e-t),l=1/(i-n),c=1/(r-o),(s=this.elements)[0]=2*a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*l,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=-2*c,s[11]=0,s[12]=-(e+t)*a,s[13]=-(i+n)*l,s[14]=-(r+o)*c,s[15]=1,this}ortho(t,e,n,i,o,r){return this.concat((new l).setOrtho(t,e,n,i,o,r))}setFrustum(t,e,n,i,o,r){var s,a,l,c;if(t===e||i===n||o===r)throw"null frustum";if(o<=0)throw"near <= 0";if(r<=0)throw"far <= 0";return a=1/(e-t),l=1/(i-n),c=1/(r-o),(s=this.elements)[0]=2*o*a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*o*l,s[6]=0,s[7]=0,s[8]=(e+t)*a,s[9]=(i+n)*l,s[10]=-(r+o)*c,s[11]=-1,s[12]=0,s[13]=0,s[14]=-2*o*r*c,s[15]=0,this}frustum(t,e,n,i,o,r){return this.concat((new l).setFrustum(t,e,n,i,o,r))}setPerspective(t,e,n,i){var o,r,s,a;if(n===i||0===e)throw"null frustum";if(n<=0)throw"near <= 0";if(i<=0)throw"far <= 0";if(t=Math.PI*t/180/2,0===(s=Math.sin(t)))throw"null frustum";return r=1/(i-n),a=Math.cos(t)/s,(o=this.elements)[0]=a/e,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=a,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-(i+n)*r,o[11]=-1,o[12]=0,o[13]=0,o[14]=-2*n*i*r,o[15]=0,this}perspective(t,e,n,i){return this.concat((new l).setPerspective(t,e,n,i))}setScale(t,e,n){var i=this.elements;return i[0]=t,i[4]=0,i[8]=0,i[12]=0,i[1]=0,i[5]=e,i[9]=0,i[13]=0,i[2]=0,i[6]=0,i[10]=n,i[14]=0,i[3]=0,i[7]=0,i[11]=0,i[15]=1,this}scale(t,e,n){var i=this.elements;return i[0]*=t,i[4]*=e,i[8]*=n,i[1]*=t,i[5]*=e,i[9]*=n,i[2]*=t,i[6]*=e,i[10]*=n,i[3]*=t,i[7]*=e,i[11]*=n,this}setTranslate(t,e,n){var i=this.elements;return i[0]=1,i[4]=0,i[8]=0,i[12]=t,i[1]=0,i[5]=1,i[9]=0,i[13]=e,i[2]=0,i[6]=0,i[10]=1,i[14]=n,i[3]=0,i[7]=0,i[11]=0,i[15]=1,this}translate(t,e,n){var i=this.elements;return i[12]+=i[0]*t+i[4]*e+i[8]*n,i[13]+=i[1]*t+i[5]*e+i[9]*n,i[14]+=i[2]*t+i[6]*e+i[10]*n,i[15]+=i[3]*t+i[7]*e+i[11]*n,this}setRotate(t,e,n,i){var o,r,s,a,l,c,p,h,u,d,v,m;return t=Math.PI*t/180,o=this.elements,r=Math.sin(t),s=Math.cos(t),0!==e&&0===n&&0===i?(e<0&&(r=-r),o[0]=1,o[4]=0,o[8]=0,o[12]=0,o[1]=0,o[5]=s,o[9]=-r,o[13]=0,o[2]=0,o[6]=r,o[10]=s,o[14]=0,o[3]=0,o[7]=0,o[11]=0,o[15]=1):0===e&&0!==n&&0===i?(n<0&&(r=-r),o[0]=s,o[4]=0,o[8]=r,o[12]=0,o[1]=0,o[5]=1,o[9]=0,o[13]=0,o[2]=-r,o[6]=0,o[10]=s,o[14]=0,o[3]=0,o[7]=0,o[11]=0,o[15]=1):0===e&&0===n&&0!==i?(i<0&&(r=-r),o[0]=s,o[4]=-r,o[8]=0,o[12]=0,o[1]=r,o[5]=s,o[9]=0,o[13]=0,o[2]=0,o[6]=0,o[10]=1,o[14]=0,o[3]=0,o[7]=0,o[11]=0,o[15]=1):(1!==(a=Math.sqrt(e*e+n*n+i*i))&&(e*=l=1/a,n*=l,i*=l),c=1-s,p=e*n,h=n*i,u=i*e,d=e*r,v=n*r,m=i*r,o[0]=e*e*c+s,o[1]=p*c+m,o[2]=u*c-v,o[3]=0,o[4]=p*c-m,o[5]=n*n*c+s,o[6]=h*c+d,o[7]=0,o[8]=u*c+v,o[9]=h*c-d,o[10]=i*i*c+s,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1),this}rotate=function(t,e,n,i){return this.concat((new l).setRotate(t,e,n,i))};setLookAt(t,e,n,i,o,r,s,a,l){var c,p,h,u,d,v,m,g,f,x,b,w;return p=i-t,h=o-e,u=r-n,v=(h*=d=1/Math.sqrt(p*p+h*h+u*u))*l-(u*=d)*a,m=u*s-(p*=d)*l,g=p*a-h*s,x=(m*=f=1/Math.sqrt(v*v+m*m+g*g))*u-(g*=f)*h,b=g*p-(v*=f)*u,w=v*h-m*p,(c=this.elements)[0]=v,c[1]=x,c[2]=-p,c[3]=0,c[4]=m,c[5]=b,c[6]=-h,c[7]=0,c[8]=g,c[9]=w,c[10]=-u,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,this.translate(-t,-e,-n)}lookAt(t,e,n,i,o,r,s,a,c){return this.concat((new l).setLookAt(t,e,n,i,o,r,s,a,c))}dropShadow(t,e){var n=new l,i=n.elements,o=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3];return i[0]=o-e[0]*t[0],i[1]=-e[1]*t[0],i[2]=-e[2]*t[0],i[3]=-e[3]*t[0],i[4]=-e[0]*t[1],i[5]=o-e[1]*t[1],i[6]=-e[2]*t[1],i[7]=-e[3]*t[1],i[8]=-e[0]*t[2],i[9]=-e[1]*t[2],i[10]=o-e[2]*t[2],i[11]=-e[3]*t[2],i[12]=-e[0]*t[3],i[13]=-e[1]*t[3],i[14]=-e[2]*t[3],i[15]=o-e[3]*t[3],this.concat(n)}dropShadowDirectionally=function(t,e,n,i,o,r,s,a,l){var c=i*t+o*e+r*n;return this.dropShadow([t,e,n,-c],[s,a,l,0])}}let c=new l,p=new l,h=new l,u=new s;class d{constructor(t,e,n){Array.isArray(t)?this.value=new Float32Array(t):this.value=t,this.countPerVertex=e,this.name=n,this.buffer=null,this.location=null}}class v{constructor(t,e,n){Array.isArray(t)?("int"===n&&(this.value=new Uint16Array(t)),this.value=new Float32Array(t)):null===t?("int"===n&&(this.value=new Uint16Array(e)),this.value=new Float32Array(e)):this.value=t,this.count=e,this.type=n,this.location=null}}class m{constructor(t=[0,0,0],e=[0,0,0],n=[1,1,1]){this.type="Object3D",this.position=new s(t),this.scale=new s(n),this.rotation=new s(e),this.scaleMatrix=new l,this.rotationMatrix=new l,this.translationMatrix=new l,this.parent=null,this.children=[],this.matrix=new l,this.matrixWorld=new l,this.renderMatrix=new l,this.up=new s([0,1,0]),this.drawMode="static",this.drawType="triangles",this.visible=!1,this.transparent=!1,this.attributes=[],this.uniforms={uMouse:new v(null,2,"vec2"),uRotation:new v(new l,16,"mat4"),uTime:new v(null,1,"float"),uResolution:new v(null,2,"vec2"),viewMatrix:new v(null,16,"mat4"),projectionMatrix:new v(null,16,"mat4"),modelMatrix:new v(null,16,"mat4"),uColor:new v(new Float32Array([1,1,1]),3,"vec3"),uAmbientIntensity:new v(null,1,"float"),uAmbientColor:new v(null,3,"vec3"),uPointLightIntensity:new v(null,1,"float"),uPointLightColor:new v(null,3,"vec3"),uPointLightPos:new v(null,3,"vec3"),uSpecularExponent:new v(null,1,"float"),uSpotLightIntensity:new v(null,1,"float"),uSpotLightColor:new v(null,3,"vec3"),uSpotLightPos:new v(null,3,"vec3"),uSpotSpecularExponent:new v(null,1,"float"),uSpotLightTarget:new v(null,3,"vec3"),uSpotLightAngle:new v(null,1,"float"),uCamPos:new v(null,3,"vec3")},this.indices=null,this.indexBuffer=null,this.indexLocation=null,this.userData={},this.program=null,this.vertexShader="#define GLSLIFY 1\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 modelMatrix;\n\nattribute vec3 aPosition;\nattribute vec3 normal;\n\nvarying vec3 vNormal;\nvarying vec3 vPosition;\n\nfloat transpose(float m) {\n  return m;\n}\n\nmat2 transpose(mat2 m) {\n  return mat2(m[0][0], m[1][0],\n              m[0][1], m[1][1]);\n}\n\nmat3 transpose(mat3 m) {\n  return mat3(m[0][0], m[1][0], m[2][0],\n              m[0][1], m[1][1], m[2][1],\n              m[0][2], m[1][2], m[2][2]);\n}\n\nmat4 transpose(mat4 m) {\n  return mat4(m[0][0], m[1][0], m[2][0], m[3][0],\n              m[0][1], m[1][1], m[2][1], m[3][1],\n              m[0][2], m[1][2], m[2][2], m[3][2],\n              m[0][3], m[1][3], m[2][3], m[3][3]);\n}\n\nfloat inverse(float m) {\n  return 1.0 / m;\n}\n\nmat2 inverse(mat2 m) {\n  return mat2(m[1][1],-m[0][1],\n             -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n}\n\nmat3 inverse(mat3 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n  float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n  float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n              b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n              b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nmat4 inverse(mat4 m) {\n  float\n      a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n      a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n      a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n      a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n      b00 = a00 * a11 - a01 * a10,\n      b01 = a00 * a12 - a02 * a10,\n      b02 = a00 * a13 - a03 * a10,\n      b03 = a01 * a12 - a02 * a11,\n      b04 = a01 * a13 - a03 * a11,\n      b05 = a02 * a13 - a03 * a12,\n      b06 = a20 * a31 - a21 * a30,\n      b07 = a20 * a32 - a22 * a30,\n      b08 = a20 * a33 - a23 * a30,\n      b09 = a21 * a32 - a22 * a31,\n      b10 = a21 * a33 - a23 * a31,\n      b11 = a22 * a33 - a23 * a32,\n\n      det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4(\n      a11 * b11 - a12 * b10 + a13 * b09,\n      a02 * b10 - a01 * b11 - a03 * b09,\n      a31 * b05 - a32 * b04 + a33 * b03,\n      a22 * b04 - a21 * b05 - a23 * b03,\n      a12 * b08 - a10 * b11 - a13 * b07,\n      a00 * b11 - a02 * b08 + a03 * b07,\n      a32 * b02 - a30 * b05 - a33 * b01,\n      a20 * b05 - a22 * b02 + a23 * b01,\n      a10 * b10 - a11 * b08 + a13 * b06,\n      a01 * b08 - a00 * b10 - a03 * b06,\n      a30 * b04 - a31 * b02 + a33 * b00,\n      a21 * b02 - a20 * b04 - a23 * b00,\n      a11 * b07 - a10 * b09 - a12 * b06,\n      a00 * b09 - a01 * b07 + a02 * b06,\n      a31 * b01 - a30 * b03 - a32 * b00,\n      a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n\nvoid main() {\n  vNormal = transpose(inverse(mat3(modelMatrix))) * normal;\n  vPosition = vec4(modelMatrix * vec4(aPosition, 1.0)).xyz;\n\n  gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(aPosition, 1.0);\n}",this.fragmentShader="precision mediump float;\n#define GLSLIFY 1\n\nuniform vec2 uResolution;\nuniform vec3 uColor;\nuniform float uAmbientIntensity;\nuniform vec3 uAmbientColor;\nuniform float uPointLightIntensity;\nuniform vec3 uPointLightColor;\nuniform vec3 uPointLightPos;\nuniform float uSpecularExponent;\n\nuniform float uSpotLightIntensity;\nuniform vec3 uSpotLightColor;\nuniform vec3 uSpotLightPos;\nuniform float uSpotSpecularExponent;\nuniform float uSpotLightAngle;\nuniform vec3 uSpotLightTarget;\n\nuniform vec3 uCamPos;\n\nvarying vec3 vNormal;\nvarying vec3 vPosition;\n\nvoid main() {\n  vec3 normal = normalize(vNormal);\n  vec3 spotLightTarget = normalize(uSpotLightTarget - uSpotLightPos);\n\n  vec3 lightDir = normalize(uPointLightPos - vPosition);\n  vec3 spotLightDir = -normalize(vPosition - uSpotLightPos);\n\n  vec3 ambient = uAmbientColor * uAmbientIntensity;\n\n  vec3 diffuse = clamp(uPointLightIntensity * uPointLightColor * dot(lightDir, normal), 0.0, 1.0);\n\n  vec3 reflection = normalize(2.0 * dot(normal, lightDir) * normal - lightDir);\n  vec3 viewDir = normalize(uCamPos - vPosition);\n  float specularHighlight = pow(clamp(dot(reflection, viewDir), 0.0, 1.0), uSpecularExponent);\n  vec3 specular = specularHighlight * uPointLightColor;\n\n  float multiplier = pow(max(0.0, uSpotLightAngle - dot(spotLightTarget, spotLightDir)), 5.0);\n\n  vec3 spotDiffuse = clamp(uSpotLightColor * uSpotLightIntensity * multiplier * dot(spotLightDir, normal), 0.0, 1.0);\n\n  gl_FragColor = vec4((ambient + diffuse + specular + spotDiffuse) * uColor, 1.0);\n}",this.autoUpdateMatrix=!0,this.calculateScaleMatrix(),this.calculateRotationMatrix(),this.calculateTranslationMatrix(),this.recalculateMatrix()}add(t){if(Array.isArray(t)&&t.length>0)for(let e of t)this.add(e);else this.children.push(t),t.parent=this}remove(t){let e=this.children.indexOf(t);t.parent=null,this.children.splice(e,1)}getAlphaOrderedChildren(){return this.children.sort(((t,e)=>t.transparent?1:-1))}setPosition(t,e,n){if(Array.isArray(t))for(let e=0;e<3;e++)this.position.elements[e]=t[e];else t.elements?this.position.set(t):(this.position.elements[0]=t,this.position.elements[1]=e,this.position.elements[2]=n);this.calculateTranslationMatrix()}getPosition(){return[...this.position.elements]}getWorldPosition(){if(!this.parent)return this.getPosition();var t=this.parent.getWorldPosition();return u.set(t),u.add(this.position),[...u.elements]}setScale(t,e,n){if(Array.isArray(t))for(let e=0;e<3;e++)this.scale.elements[e]=t[e];else t.elements?this.scale.set(t):(this.scale.elements[0]=t,this.scale.elements[1]=e,this.scale.elements[2]=n);this.calculateScaleMatrix()}getScale(){return[...this.scale.elements]}setRotation(t,e,n){if(Array.isArray(t))for(let e=0;e<3;e++)this.rotation.elements[e]=t[e];else t.elements?this.rotation.set(t):(this.rotation.elements[0]=t,this.rotation.elements[1]=e,this.rotation.elements[2]=n);this.calculateRotationMatrix()}getRotation(){return[...this.rotation.elements]}setUpDirection(t,e,n){if(Array.isArray(t))for(let e=0;e<3;e++)this.up.elements[e]=t[e];else t.elements?this.up.set(t):(this.up.elements[0]=t,this.up.elements[1]=e,this.up.elements[2]=n)}getUpDirection(){return[...this.up.elements]}setShaderProgram(t,e,n){this.program=function(t,e,n){var i=r(t,t.VERTEX_SHADER,e),o=r(t,t.FRAGMENT_SHADER,n);if(!i||!o)return null;var s=t.createProgram();if(!s)return null;if(t.attachShader(s,i),t.attachShader(s,o),t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS)){var a=t.getProgramInfoLog(s);return console.log("Failed to link program: "+a),t.deleteProgram(s),t.deleteShader(o),t.deleteShader(i),null}return s}(t,e,n);for(let e in this.uniforms)this.uniforms[e].location=t.getUniformLocation(this.program,e);for(let e of this.attributes)e.location=t.getAttribLocation(this.program,e.name);this.program||console.warn(`Failed to compile program for ${this}`)}traverse(t){t(this);for(let e of this.getAlphaOrderedChildren())e.traverse(t)}setColor(t,e,n){if(Array.isArray(t))for(let e=0;e<3;e++)this.uniforms.uColor.value[e]=t[e];else t.elements?this.uniforms.uColor.value.set(t):(this.uniforms.uColor.value[0]=t,this.uniforms.uColor.value[1]=e,this.uniforms.uColor.value[2]=n)}calculateScaleMatrix(){this.scaleMatrix.setScale(...this.scale.elements)}calculateRotationMatrix(){this.rotationMatrix.setRotate(this.rotation.elements[0],1,0,0),this.rotationMatrix.rotate(this.rotation.elements[1],0,1,0),this.rotationMatrix.rotate(this.rotation.elements[2],0,0,1),this.uniforms.uRotation.value=this.rotationMatrix.elements}calculateTranslationMatrix(){this.translationMatrix.setTranslate(...this.position.elements)}getScaleMatrix(){return c.set(this.scaleMatrix)}getRotationMatrix(){return p.set(this.rotationMatrix)}getTranslationMatrix(){return h.set(this.translationMatrix)}getMatrix(){return this.calculateMatrix(),this.matrix}getMatrixWorld(){return this.calculateWorldMatrix(),this.matrixWorld}calculateMatrix(){this.matrix.set(this.translationMatrix).multiply(this.rotationMatrix).multiply(this.scaleMatrix)}calculateWorldMatrix(){null!==this.parent?this.matrixWorld.set(this.parent.getMatrixWorld()).multiply(this.translationMatrix).multiply(this.rotationMatrix):this.matrixWorld.set(this.translationMatrix).multiply(this.rotationMatrix)}recalculateMatrix(){this.autoUpdateMatrix&&this.calculateMatrix(),this.calculateWorldMatrix(),this.renderMatrix.set(this.matrixWorld).multiply(this.scaleMatrix),this.uniforms.modelMatrix.value.set(this.renderMatrix.elements)}}class g extends m{constructor(t=1,e=1,n=1,i=1,o=[0,0,0],r=[0,0,0],s=[1,1,1]){super(o,r,s),this.type="plane",this.visible=!0,this.drawType="triangles";const a=t/2,l=e/2,c=Math.floor(n),p=Math.floor(i),h=c+1,u=p+1,v=t/c,m=e/p,g=[],f=[],x=[],b=[];for(let t=0;t<u;t++){const e=t*m-l;for(let n=0;n<h;n++){let i=n*v-a;g.push(i,-e,0),b.push(0,0,1),x.push(n/c),x.push(1-t/p)}}for(let t=0;t<p;t++)for(let e=0;e<c;e++){let n=e+h*t,i=e+h*(t+1),o=e+1+h*(t+1),r=e+1+h*t;f.push(n,i,r),f.push(i,o,r)}this.attributes.push(new d(g,3,"aPosition")),this.attributes.push(new d(x,2,"uv")),this.attributes.push(new d(b,3,"normal")),this.indices=new Uint16Array(f)}}const f='#define GLSLIFY 1\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 modelMatrix;\nuniform float uTime;\nuniform vec3 uCameraPos;\n\nattribute vec3 aPosition;\nattribute vec2 uv;\nattribute vec3 normal;\n\nvarying vec3 vNormal;\nvarying vec3 vPos;\nvarying float height;\nvarying float vFogDist;\n\nfloat transpose(float m) {\n  return m;\n}\n\nmat2 transpose(mat2 m) {\n  return mat2(m[0][0], m[1][0],\n              m[0][1], m[1][1]);\n}\n\nmat3 transpose(mat3 m) {\n  return mat3(m[0][0], m[1][0], m[2][0],\n              m[0][1], m[1][1], m[2][1],\n              m[0][2], m[1][2], m[2][2]);\n}\n\nmat4 transpose(mat4 m) {\n  return mat4(m[0][0], m[1][0], m[2][0], m[3][0],\n              m[0][1], m[1][1], m[2][1], m[3][1],\n              m[0][2], m[1][2], m[2][2], m[3][2],\n              m[0][3], m[1][3], m[2][3], m[3][3]);\n}\n\nfloat inverse(float m) {\n  return 1.0 / m;\n}\n\nmat2 inverse(mat2 m) {\n  return mat2(m[1][1],-m[0][1],\n             -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n}\n\nmat3 inverse(mat3 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n  float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n  float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n              b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n              b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nmat4 inverse(mat4 m) {\n  float\n      a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n      a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n      a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n      a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n      b00 = a00 * a11 - a01 * a10,\n      b01 = a00 * a12 - a02 * a10,\n      b02 = a00 * a13 - a03 * a10,\n      b03 = a01 * a12 - a02 * a11,\n      b04 = a01 * a13 - a03 * a11,\n      b05 = a02 * a13 - a03 * a12,\n      b06 = a20 * a31 - a21 * a30,\n      b07 = a20 * a32 - a22 * a30,\n      b08 = a20 * a33 - a23 * a30,\n      b09 = a21 * a32 - a22 * a31,\n      b10 = a21 * a33 - a23 * a31,\n      b11 = a22 * a33 - a23 * a32,\n\n      det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4(\n      a11 * b11 - a12 * b10 + a13 * b09,\n      a02 * b10 - a01 * b11 - a03 * b09,\n      a31 * b05 - a32 * b04 + a33 * b03,\n      a22 * b04 - a21 * b05 - a23 * b03,\n      a12 * b08 - a10 * b11 - a13 * b07,\n      a00 * b11 - a02 * b08 + a03 * b07,\n      a32 * b02 - a30 * b05 - a33 * b01,\n      a20 * b05 - a22 * b02 + a23 * b01,\n      a10 * b10 - a11 * b08 + a13 * b06,\n      a01 * b08 - a00 * b10 - a03 * b06,\n      a30 * b04 - a31 * b02 + a33 * b00,\n      a21 * b02 - a20 * b04 - a23 * b00,\n      a11 * b07 - a10 * b09 - a12 * b06,\n      a00 * b09 - a01 * b07 + a02 * b06,\n      a31 * b01 - a30 * b03 - a32 * b00,\n      a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n\n//\n// GLSL textureless classic 3D noise "cnoise",\n// with an RSL-style periodic variant "pnoise".\n// Author:  Stefan Gustavson (stefan.gustavson@liu.se)\n// Version: 2011-10-11\n//\n// Many thanks to Ian McEwan of Ashima Arts for the\n// ideas for permutation and gradient selection.\n//\n// Copyright (c) 2011 Stefan Gustavson. All rights reserved.\n// Distributed under the MIT license. See LICENSE file.\n// https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289(vec3 x)\n{\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289(vec4 x)\n{\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute(vec4 x)\n{\n  return mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nvec3 fade(vec3 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\n// Classic Perlin noise\nfloat cnoise(vec3 P)\n{\n  vec3 Pi0 = floor(P); // Integer part for indexing\n  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n  Pi0 = mod289(Pi0);\n  Pi1 = mod289(Pi1);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 * (1.0 / 7.0);\n  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 * (1.0 / 7.0);\n  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n  return 2.2 * n_xyz;\n}\n\nvoid main() {\n\n  vec4 pos = modelMatrix * vec4(aPosition, 1.0);\n  float strength = clamp(cnoise(pos.xyz * 0.1), 0.0, 1.0);\n  height = smoothstep(0.0, 1.0, strength);\n  pos.y += height * 0.2;\n\n  vPos = pos.xyz;\n  vNormal = transpose(inverse(mat3(modelMatrix))) * normal;\n\n  gl_Position = projectionMatrix * viewMatrix * pos;\n  vFogDist = distance(pos.xyz, uCameraPos.xyz);\n}',x="precision mediump float;\n#define GLSLIFY 1\n\nuniform vec2 uResolution;\nuniform float uAmbientIntensity;\nuniform vec3 uAmbientColor;\nuniform float uPointLightIntensity;\nuniform vec3 uPointLightColor;\nuniform vec3 uPointLightPos;\nuniform float uSpecularExponent;\n\nuniform float uSpotLightIntensity;\nuniform vec3 uSpotLightColor;\nuniform vec3 uSpotLightPos;\nuniform float uSpotSpecularExponent;\nuniform float uSpotLightAngle;\nuniform vec3 uSpotLightTarget;\n\nuniform vec3 uCamPos;\n\nvarying vec3 vNormal;\nvarying float height;\nvarying float vFogDist;\nvarying vec3 vPos;\n\n//\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute(vec4 x) {\n     return mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat snoise(vec3 v)\n  {\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min( g.xyz, l.zxy );\n  vec3 i2 = max( g.xyz, l.zxy );\n\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod289(i);\n  vec4 p = permute( permute( permute(\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3  ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n  }\n\n#define FOG_START 5.0\n#define FOG_END 20.0\n\nvoid main() {\n  // float fogFactor = pow(smoothstep(0.0, 1.0, vFogDist), 2.0);\n  float fogFactor = clamp((FOG_END - vFogDist) / (FOG_END - FOG_START), 0.0, 1.0);\n\n  vec4 finalColor = vec4(0.0, 0.0, 0.0, 1.0);\n  vec3 col = vec3(0.702, 0.6902, 0.6667);\n  vec3 col2 = vec3(0.9255, 0.9961, 1.0);\n  vec3 darkSand = col - 0.2;\n  vec3 fogColor = vec3(0.7686, 0.7098, 0.8745);\n\n  float noise = clamp(snoise(vPos * 500.0), 0.0, 1.0);\n\n  noise = smoothstep(0.5,1.0,noise);\n\n  finalColor += vec4((1.0-noise)*col, 1.0);\n  finalColor +=  vec4(height*darkSand, 1.0);\n  finalColor += vec4(noise*col2, 1.0);\n\n  vec3 normal = normalize(vNormal);\n  vec3 spotLightTarget = normalize(uSpotLightTarget - uSpotLightPos);\n\n  vec3 lightDir = normalize(uPointLightPos - vPos);\n  vec3 spotLightDir = -normalize(vPos - uSpotLightPos);\n\n  vec3 ambient = uAmbientColor * uAmbientIntensity;\n\n  vec3 diffuse = clamp(uPointLightIntensity * uPointLightColor * dot(lightDir, normal), 0.0, 1.0);\n\n  float multiplier = pow(max(0.0, uSpotLightAngle - dot(spotLightTarget, spotLightDir)), 5.0);\n\n  vec3 spotDiffuse = clamp(uSpotLightColor * uSpotLightIntensity * multiplier * dot(spotLightDir, normal), 0.0, 1.0);\n\n  vec4 lighting = vec4(ambient + diffuse + spotDiffuse, 1.0);\n\n  finalColor *= lighting;\n  finalColor = mix(finalColor, vec4(fogColor, 1.0), 1.0 - fogFactor);\n\n  gl_FragColor = finalColor;\n}",b=new g(64,64,64,64);b.setRotation(-90,0,0),b.vertexShader=f,b.fragmentShader=x;const w="#define GLSLIFY 1\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 modelMatrix;\nuniform vec3 uCameraPos;\n\nattribute vec3 aPosition;\nattribute vec2 uv;\n\nvarying vec2 vUv;\nvarying vec3 vPos;\n\nvoid main() {\n  vec4 pos = modelMatrix * vec4(aPosition, 1.0);\n\n  vPos = pos.xyz - uCameraPos;\n  vUv = uv;\n\n  gl_Position = projectionMatrix * viewMatrix * pos;\n}",y='precision mediump float;\n#define GLSLIFY 1\n\nuniform vec2 uResolution;\nuniform float uTime;\n\nvarying vec2 vUv;\nvarying vec3 vPos;\n\n//\n// GLSL textureless classic 4D noise "cnoise",\n// with an RSL-style periodic variant "pnoise".\n// Author:  Stefan Gustavson (stefan.gustavson@liu.se)\n// Version: 2011-08-22\n//\n// Many thanks to Ian McEwan of Ashima Arts for the\n// ideas for permutation and gradient selection.\n//\n// Copyright (c) 2011 Stefan Gustavson. All rights reserved.\n// Distributed under the MIT license. See LICENSE file.\n// https://github.com/ashima/webgl-noise\n//\n\nvec4 mod289_0(vec4 x)\n{\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute_0(vec4 x)\n{\n  return mod289_0(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt_0(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nvec4 fade(vec4 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\n// Classic Perlin noise\nfloat cnoise(vec4 P)\n{\n  vec4 Pi0 = floor(P); // Integer part for indexing\n  vec4 Pi1 = Pi0 + 1.0; // Integer part + 1\n  Pi0 = mod289_0(Pi0);\n  Pi1 = mod289_0(Pi1);\n  vec4 Pf0 = fract(P); // Fractional part for interpolation\n  vec4 Pf1 = Pf0 - 1.0; // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = vec4(Pi0.zzzz);\n  vec4 iz1 = vec4(Pi1.zzzz);\n  vec4 iw0 = vec4(Pi0.wwww);\n  vec4 iw1 = vec4(Pi1.wwww);\n\n  vec4 ixy = permute_0(permute_0(ix) + iy);\n  vec4 ixy0 = permute_0(ixy + iz0);\n  vec4 ixy1 = permute_0(ixy + iz1);\n  vec4 ixy00 = permute_0(ixy0 + iw0);\n  vec4 ixy01 = permute_0(ixy0 + iw1);\n  vec4 ixy10 = permute_0(ixy1 + iw0);\n  vec4 ixy11 = permute_0(ixy1 + iw1);\n\n  vec4 gx00 = ixy00 * (1.0 / 7.0);\n  vec4 gy00 = floor(gx00) * (1.0 / 7.0);\n  vec4 gz00 = floor(gy00) * (1.0 / 6.0);\n  gx00 = fract(gx00) - 0.5;\n  gy00 = fract(gy00) - 0.5;\n  gz00 = fract(gz00) - 0.5;\n  vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);\n  vec4 sw00 = step(gw00, vec4(0.0));\n  gx00 -= sw00 * (step(0.0, gx00) - 0.5);\n  gy00 -= sw00 * (step(0.0, gy00) - 0.5);\n\n  vec4 gx01 = ixy01 * (1.0 / 7.0);\n  vec4 gy01 = floor(gx01) * (1.0 / 7.0);\n  vec4 gz01 = floor(gy01) * (1.0 / 6.0);\n  gx01 = fract(gx01) - 0.5;\n  gy01 = fract(gy01) - 0.5;\n  gz01 = fract(gz01) - 0.5;\n  vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);\n  vec4 sw01 = step(gw01, vec4(0.0));\n  gx01 -= sw01 * (step(0.0, gx01) - 0.5);\n  gy01 -= sw01 * (step(0.0, gy01) - 0.5);\n\n  vec4 gx10 = ixy10 * (1.0 / 7.0);\n  vec4 gy10 = floor(gx10) * (1.0 / 7.0);\n  vec4 gz10 = floor(gy10) * (1.0 / 6.0);\n  gx10 = fract(gx10) - 0.5;\n  gy10 = fract(gy10) - 0.5;\n  gz10 = fract(gz10) - 0.5;\n  vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);\n  vec4 sw10 = step(gw10, vec4(0.0));\n  gx10 -= sw10 * (step(0.0, gx10) - 0.5);\n  gy10 -= sw10 * (step(0.0, gy10) - 0.5);\n\n  vec4 gx11 = ixy11 * (1.0 / 7.0);\n  vec4 gy11 = floor(gx11) * (1.0 / 7.0);\n  vec4 gz11 = floor(gy11) * (1.0 / 6.0);\n  gx11 = fract(gx11) - 0.5;\n  gy11 = fract(gy11) - 0.5;\n  gz11 = fract(gz11) - 0.5;\n  vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);\n  vec4 sw11 = step(gw11, vec4(0.0));\n  gx11 -= sw11 * (step(0.0, gx11) - 0.5);\n  gy11 -= sw11 * (step(0.0, gy11) - 0.5);\n\n  vec4 g0000 = vec4(gx00.x,gy00.x,gz00.x,gw00.x);\n  vec4 g1000 = vec4(gx00.y,gy00.y,gz00.y,gw00.y);\n  vec4 g0100 = vec4(gx00.z,gy00.z,gz00.z,gw00.z);\n  vec4 g1100 = vec4(gx00.w,gy00.w,gz00.w,gw00.w);\n  vec4 g0010 = vec4(gx10.x,gy10.x,gz10.x,gw10.x);\n  vec4 g1010 = vec4(gx10.y,gy10.y,gz10.y,gw10.y);\n  vec4 g0110 = vec4(gx10.z,gy10.z,gz10.z,gw10.z);\n  vec4 g1110 = vec4(gx10.w,gy10.w,gz10.w,gw10.w);\n  vec4 g0001 = vec4(gx01.x,gy01.x,gz01.x,gw01.x);\n  vec4 g1001 = vec4(gx01.y,gy01.y,gz01.y,gw01.y);\n  vec4 g0101 = vec4(gx01.z,gy01.z,gz01.z,gw01.z);\n  vec4 g1101 = vec4(gx01.w,gy01.w,gz01.w,gw01.w);\n  vec4 g0011 = vec4(gx11.x,gy11.x,gz11.x,gw11.x);\n  vec4 g1011 = vec4(gx11.y,gy11.y,gz11.y,gw11.y);\n  vec4 g0111 = vec4(gx11.z,gy11.z,gz11.z,gw11.z);\n  vec4 g1111 = vec4(gx11.w,gy11.w,gz11.w,gw11.w);\n\n  vec4 norm00 = taylorInvSqrt_0(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));\n  g0000 *= norm00.x;\n  g0100 *= norm00.y;\n  g1000 *= norm00.z;\n  g1100 *= norm00.w;\n\n  vec4 norm01 = taylorInvSqrt_0(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));\n  g0001 *= norm01.x;\n  g0101 *= norm01.y;\n  g1001 *= norm01.z;\n  g1101 *= norm01.w;\n\n  vec4 norm10 = taylorInvSqrt_0(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));\n  g0010 *= norm10.x;\n  g0110 *= norm10.y;\n  g1010 *= norm10.z;\n  g1110 *= norm10.w;\n\n  vec4 norm11 = taylorInvSqrt_0(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));\n  g0011 *= norm11.x;\n  g0111 *= norm11.y;\n  g1011 *= norm11.z;\n  g1111 *= norm11.w;\n\n  float n0000 = dot(g0000, Pf0);\n  float n1000 = dot(g1000, vec4(Pf1.x, Pf0.yzw));\n  float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.zw));\n  float n1100 = dot(g1100, vec4(Pf1.xy, Pf0.zw));\n  float n0010 = dot(g0010, vec4(Pf0.xy, Pf1.z, Pf0.w));\n  float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));\n  float n0110 = dot(g0110, vec4(Pf0.x, Pf1.yz, Pf0.w));\n  float n1110 = dot(g1110, vec4(Pf1.xyz, Pf0.w));\n  float n0001 = dot(g0001, vec4(Pf0.xyz, Pf1.w));\n  float n1001 = dot(g1001, vec4(Pf1.x, Pf0.yz, Pf1.w));\n  float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));\n  float n1101 = dot(g1101, vec4(Pf1.xy, Pf0.z, Pf1.w));\n  float n0011 = dot(g0011, vec4(Pf0.xy, Pf1.zw));\n  float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.zw));\n  float n0111 = dot(g0111, vec4(Pf0.x, Pf1.yzw));\n  float n1111 = dot(g1111, Pf1);\n\n  vec4 fade_xyzw = fade(Pf0);\n  vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);\n  vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);\n  vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);\n  vec2 n_yzw = mix(n_zw.xy, n_zw.zw, fade_xyzw.y);\n  float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);\n  return 2.2 * n_xyzw;\n}\n\n//\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec4 mod289_1(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0; }\n\nfloat mod289_1(float x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0; }\n\nvec4 permute_1(vec4 x) {\n     return mod289_1(((x*34.0)+1.0)*x);\n}\n\nfloat permute_1(float x) {\n     return mod289_1(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt_1(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat taylorInvSqrt_1(float r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nvec4 grad4(float j, vec4 ip)\n  {\n  const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n  vec4 p,s;\n\n  p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n  p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n  s = vec4(lessThan(p, vec4(0.0)));\n  p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\n\n  return p;\n  }\n\n// (sqrt(5) - 1)/4 = F4, used once below\n#define F4 0.309016994374947451\n\nfloat snoise(vec4 v)\n  {\n  const vec4  C = vec4( 0.138196601125011,  // (5 - sqrt(5))/20  G4\n                        0.276393202250021,  // 2 * G4\n                        0.414589803375032,  // 3 * G4\n                       -0.447213595499958); // -1 + 4 * G4\n\n// First corner\n  vec4 i  = floor(v + dot(v, vec4(F4)) );\n  vec4 x0 = v -   i + dot(i, C.xxxx);\n\n// Other corners\n\n// Rank sorting originally contributed by Bill Licea-Kane, AMD (formerly ATI)\n  vec4 i0;\n  vec3 isX = step( x0.yzw, x0.xxx );\n  vec3 isYZ = step( x0.zww, x0.yyz );\n//  i0.x = dot( isX, vec3( 1.0 ) );\n  i0.x = isX.x + isX.y + isX.z;\n  i0.yzw = 1.0 - isX;\n//  i0.y += dot( isYZ.xy, vec2( 1.0 ) );\n  i0.y += isYZ.x + isYZ.y;\n  i0.zw += 1.0 - isYZ.xy;\n  i0.z += isYZ.z;\n  i0.w += 1.0 - isYZ.z;\n\n  // i0 now contains the unique values 0,1,2,3 in each channel\n  vec4 i3 = clamp( i0, 0.0, 1.0 );\n  vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\n  vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\n\n  //  x0 = x0 - 0.0 + 0.0 * C.xxxx\n  //  x1 = x0 - i1  + 1.0 * C.xxxx\n  //  x2 = x0 - i2  + 2.0 * C.xxxx\n  //  x3 = x0 - i3  + 3.0 * C.xxxx\n  //  x4 = x0 - 1.0 + 4.0 * C.xxxx\n  vec4 x1 = x0 - i1 + C.xxxx;\n  vec4 x2 = x0 - i2 + C.yyyy;\n  vec4 x3 = x0 - i3 + C.zzzz;\n  vec4 x4 = x0 + C.wwww;\n\n// Permutations\n  i = mod289_1(i);\n  float j0 = permute_1( permute_1( permute_1( permute_1(i.w) + i.z) + i.y) + i.x);\n  vec4 j1 = permute_1( permute_1( permute_1( permute_1 (\n             i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n           + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n           + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n           + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\n\n// Gradients: 7x7x6 points over a cube, mapped onto a 4-cross polytope\n// 7*7*6 = 294, which is close to the ring size 17*17 = 289.\n  vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n  vec4 p0 = grad4(j0,   ip);\n  vec4 p1 = grad4(j1.x, ip);\n  vec4 p2 = grad4(j1.y, ip);\n  vec4 p3 = grad4(j1.z, ip);\n  vec4 p4 = grad4(j1.w, ip);\n\n// Normalise gradients\n  vec4 norm = taylorInvSqrt_1(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n  p4 *= taylorInvSqrt_1(dot(p4,p4));\n\n// Mix contributions from the five corners\n  vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\n  vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4)            ), 0.0);\n  m0 = m0 * m0;\n  m1 = m1 * m1;\n  return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n               + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n\n  }\n\n#define S smoothstep\n\nfloat rand2_1(vec2 p) {\n  p = fract(p * vec2(123.34, 456.21));\n  p += dot(p, p + 45.32);\n\n  return fract(p.x * p.y);\n}\n\nvec3 Star(vec2 uv, float rand, float time) {\n  float d = length(uv);\n  float size = 0.02 + pow(rand, 5.0) * 0.03 * sin(uTime * 0.01 * rand + 100.0);\n\n  float star = pow(size / d, 2.0);\n\n  vec3 col1 = vec3(1.0, 0.7765, 0.7765);\n  vec3 col2 = vec3(0.6588, 0.902, 1.0);\n\n  float col1Str = fract(rand * 21.4);\n  return mix(col1, col2, col1Str) * star;\n}\n\nvec4 Stars(vec2 uv, float uTime) {\n  vec4 Stars = vec4(0.0);\n  vec2 gv = fract(uv) - 0.5;\n  vec2 id = floor(uv);\n\n    for (int y = -1; y <= 1; y++) {\n      for (int x = -1; x <= 1; x++) {\n        vec2 offset = vec2(x,y);\n\n        float n = rand2_1(id + offset);\n        Stars += vec4(Star(gv - offset - vec2(n, fract(n * 69.0)) + 0.5, n, uTime), 1.0);\n      }\n    }\n\n  return Stars;\n}\n\nfloat calcHeight(vec2 uv, float depth) {\n  float rand = rand2_1(vec2(fract(depth * 345.23), depth * -123.45)) * 35.0;\n  float h = (uv.y - 3.0) * 0.3 + sin((uv.x + depth * 10.0 * rand) * 0.00005) * sin((uv.x + depth * 5.0) * 0.1)*40.3 * rand;\n\n  return h;\n}\n\nvec4 Mountains(vec2 uv) {\n  vec4 mtns = vec4(0.0);\n  vec3 mtnColor =vec3(0.6078, 0.6078, 0.6078);\n\n  const float numLayers = 3.0;\n\n  float distToCorner = 1.0 - (abs(uv.x - 100.0) / 100.0);\n\n  for (float i = 0.0; i <= 1.0; i += 1.0/(numLayers-1.0)) {\n    float mtn = S(0.005, -0.005, calcHeight(uv, i) - distToCorner * 3.0);\n    float brightness = i + 0.2;\n\n    mtns = mix(mtns, vec4(mtnColor * brightness, mtn), mtn);\n  }\n\n  return vec4(mtns);\n}\n\nvoid main() {\n  float fogStr = S(0.92, 0.98, 1.0 - vUv.y);\n  vec4 finalColor = vec4(0.0588, 0.0314, 0.1059, 1.0);\n  vec4 cloudColor = vec4(0.0588, 0.0353, 0.0941, 1.0);\n  vec4 mtnColor =vec4(0.8941, 0.8941, 0.8941, 1.0);\n  vec4 fogColor = vec4(0.7686, 0.7098, 0.8745, 1.0);\n\n  vec3 pos = vPos * 0.05;\n  vec2 uv = vUv * 200.0;\n\n  float cloudStr = clamp(cnoise(vec4(pos, uTime * 0.0005)), 0.0, 1.0);\n  cloudStr += clamp(snoise(vec4(pos * 0.5, uTime * 0.0005 + 10000.0)), 0.0, 1.0);\n  float noise = clamp(cnoise(vec4(pos, uTime * 0.0005)), 0.0, 1.0);\n  noise += clamp(snoise(vec4(pos * 0.5, uTime * 0.0005 + 10000.0)), 0.0, 1.0);\n\n  vec4 mtns = Mountains(uv);\n\n  finalColor += S(0.0, 0.7, cloudStr) * cloudColor;\n  finalColor += Stars(uv, uTime) * max(S(0.1, 0.6, noise), 0.1);\n  finalColor = mix(finalColor, mtns, mtns.a);\n  finalColor = mix(finalColor, fogColor, fogStr);\n  finalColor.rb += normalize(vPos.xy) * 0.05 * (1.0 - fogStr);\n\n  gl_FragColor = finalColor;\n}',_=new m;_.floor=b;const P=new g(64,64);P.setPosition(0,32,32),P.setRotation(0,180,0),P.vertexShader="#define GLSLIFY 1\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 modelMatrix;\nuniform vec3 uCameraPos;\n\nattribute vec3 aPosition;\nattribute vec2 uv;\n\nvarying vec2 vUv;\nvarying vec3 vPos;\n\nvoid main() {\n  vec4 pos = modelMatrix * vec4(aPosition, 1.0);\n\n  vPos = pos.xyz - uCameraPos;\n  vUv = uv;\n\n  gl_Position = projectionMatrix * viewMatrix * pos;\n}",P.fragmentShader='precision mediump float;\n#define GLSLIFY 1\n\nuniform vec2 uResolution;\nuniform float uTime;\n\nvarying vec2 vUv;\nvarying vec3 vPos;\n\n//\n// GLSL textureless classic 4D noise "cnoise",\n// with an RSL-style periodic variant "pnoise".\n// Author:  Stefan Gustavson (stefan.gustavson@liu.se)\n// Version: 2011-08-22\n//\n// Many thanks to Ian McEwan of Ashima Arts for the\n// ideas for permutation and gradient selection.\n//\n// Copyright (c) 2011 Stefan Gustavson. All rights reserved.\n// Distributed under the MIT license. See LICENSE file.\n// https://github.com/ashima/webgl-noise\n//\n\nvec4 mod289_1(vec4 x)\n{\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute_1(vec4 x)\n{\n  return mod289_1(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt_1(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nvec4 fade(vec4 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\n// Classic Perlin noise\nfloat cnoise(vec4 P)\n{\n  vec4 Pi0 = floor(P); // Integer part for indexing\n  vec4 Pi1 = Pi0 + 1.0; // Integer part + 1\n  Pi0 = mod289_1(Pi0);\n  Pi1 = mod289_1(Pi1);\n  vec4 Pf0 = fract(P); // Fractional part for interpolation\n  vec4 Pf1 = Pf0 - 1.0; // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = vec4(Pi0.zzzz);\n  vec4 iz1 = vec4(Pi1.zzzz);\n  vec4 iw0 = vec4(Pi0.wwww);\n  vec4 iw1 = vec4(Pi1.wwww);\n\n  vec4 ixy = permute_1(permute_1(ix) + iy);\n  vec4 ixy0 = permute_1(ixy + iz0);\n  vec4 ixy1 = permute_1(ixy + iz1);\n  vec4 ixy00 = permute_1(ixy0 + iw0);\n  vec4 ixy01 = permute_1(ixy0 + iw1);\n  vec4 ixy10 = permute_1(ixy1 + iw0);\n  vec4 ixy11 = permute_1(ixy1 + iw1);\n\n  vec4 gx00 = ixy00 * (1.0 / 7.0);\n  vec4 gy00 = floor(gx00) * (1.0 / 7.0);\n  vec4 gz00 = floor(gy00) * (1.0 / 6.0);\n  gx00 = fract(gx00) - 0.5;\n  gy00 = fract(gy00) - 0.5;\n  gz00 = fract(gz00) - 0.5;\n  vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);\n  vec4 sw00 = step(gw00, vec4(0.0));\n  gx00 -= sw00 * (step(0.0, gx00) - 0.5);\n  gy00 -= sw00 * (step(0.0, gy00) - 0.5);\n\n  vec4 gx01 = ixy01 * (1.0 / 7.0);\n  vec4 gy01 = floor(gx01) * (1.0 / 7.0);\n  vec4 gz01 = floor(gy01) * (1.0 / 6.0);\n  gx01 = fract(gx01) - 0.5;\n  gy01 = fract(gy01) - 0.5;\n  gz01 = fract(gz01) - 0.5;\n  vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);\n  vec4 sw01 = step(gw01, vec4(0.0));\n  gx01 -= sw01 * (step(0.0, gx01) - 0.5);\n  gy01 -= sw01 * (step(0.0, gy01) - 0.5);\n\n  vec4 gx10 = ixy10 * (1.0 / 7.0);\n  vec4 gy10 = floor(gx10) * (1.0 / 7.0);\n  vec4 gz10 = floor(gy10) * (1.0 / 6.0);\n  gx10 = fract(gx10) - 0.5;\n  gy10 = fract(gy10) - 0.5;\n  gz10 = fract(gz10) - 0.5;\n  vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);\n  vec4 sw10 = step(gw10, vec4(0.0));\n  gx10 -= sw10 * (step(0.0, gx10) - 0.5);\n  gy10 -= sw10 * (step(0.0, gy10) - 0.5);\n\n  vec4 gx11 = ixy11 * (1.0 / 7.0);\n  vec4 gy11 = floor(gx11) * (1.0 / 7.0);\n  vec4 gz11 = floor(gy11) * (1.0 / 6.0);\n  gx11 = fract(gx11) - 0.5;\n  gy11 = fract(gy11) - 0.5;\n  gz11 = fract(gz11) - 0.5;\n  vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);\n  vec4 sw11 = step(gw11, vec4(0.0));\n  gx11 -= sw11 * (step(0.0, gx11) - 0.5);\n  gy11 -= sw11 * (step(0.0, gy11) - 0.5);\n\n  vec4 g0000 = vec4(gx00.x,gy00.x,gz00.x,gw00.x);\n  vec4 g1000 = vec4(gx00.y,gy00.y,gz00.y,gw00.y);\n  vec4 g0100 = vec4(gx00.z,gy00.z,gz00.z,gw00.z);\n  vec4 g1100 = vec4(gx00.w,gy00.w,gz00.w,gw00.w);\n  vec4 g0010 = vec4(gx10.x,gy10.x,gz10.x,gw10.x);\n  vec4 g1010 = vec4(gx10.y,gy10.y,gz10.y,gw10.y);\n  vec4 g0110 = vec4(gx10.z,gy10.z,gz10.z,gw10.z);\n  vec4 g1110 = vec4(gx10.w,gy10.w,gz10.w,gw10.w);\n  vec4 g0001 = vec4(gx01.x,gy01.x,gz01.x,gw01.x);\n  vec4 g1001 = vec4(gx01.y,gy01.y,gz01.y,gw01.y);\n  vec4 g0101 = vec4(gx01.z,gy01.z,gz01.z,gw01.z);\n  vec4 g1101 = vec4(gx01.w,gy01.w,gz01.w,gw01.w);\n  vec4 g0011 = vec4(gx11.x,gy11.x,gz11.x,gw11.x);\n  vec4 g1011 = vec4(gx11.y,gy11.y,gz11.y,gw11.y);\n  vec4 g0111 = vec4(gx11.z,gy11.z,gz11.z,gw11.z);\n  vec4 g1111 = vec4(gx11.w,gy11.w,gz11.w,gw11.w);\n\n  vec4 norm00 = taylorInvSqrt_1(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));\n  g0000 *= norm00.x;\n  g0100 *= norm00.y;\n  g1000 *= norm00.z;\n  g1100 *= norm00.w;\n\n  vec4 norm01 = taylorInvSqrt_1(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));\n  g0001 *= norm01.x;\n  g0101 *= norm01.y;\n  g1001 *= norm01.z;\n  g1101 *= norm01.w;\n\n  vec4 norm10 = taylorInvSqrt_1(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));\n  g0010 *= norm10.x;\n  g0110 *= norm10.y;\n  g1010 *= norm10.z;\n  g1110 *= norm10.w;\n\n  vec4 norm11 = taylorInvSqrt_1(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));\n  g0011 *= norm11.x;\n  g0111 *= norm11.y;\n  g1011 *= norm11.z;\n  g1111 *= norm11.w;\n\n  float n0000 = dot(g0000, Pf0);\n  float n1000 = dot(g1000, vec4(Pf1.x, Pf0.yzw));\n  float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.zw));\n  float n1100 = dot(g1100, vec4(Pf1.xy, Pf0.zw));\n  float n0010 = dot(g0010, vec4(Pf0.xy, Pf1.z, Pf0.w));\n  float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));\n  float n0110 = dot(g0110, vec4(Pf0.x, Pf1.yz, Pf0.w));\n  float n1110 = dot(g1110, vec4(Pf1.xyz, Pf0.w));\n  float n0001 = dot(g0001, vec4(Pf0.xyz, Pf1.w));\n  float n1001 = dot(g1001, vec4(Pf1.x, Pf0.yz, Pf1.w));\n  float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));\n  float n1101 = dot(g1101, vec4(Pf1.xy, Pf0.z, Pf1.w));\n  float n0011 = dot(g0011, vec4(Pf0.xy, Pf1.zw));\n  float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.zw));\n  float n0111 = dot(g0111, vec4(Pf0.x, Pf1.yzw));\n  float n1111 = dot(g1111, Pf1);\n\n  vec4 fade_xyzw = fade(Pf0);\n  vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);\n  vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);\n  vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);\n  vec2 n_yzw = mix(n_zw.xy, n_zw.zw, fade_xyzw.y);\n  float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);\n  return 2.2 * n_xyzw;\n}\n\n//\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec4 mod289_0(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0; }\n\nfloat mod289_0(float x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0; }\n\nvec4 permute_0(vec4 x) {\n     return mod289_0(((x*34.0)+1.0)*x);\n}\n\nfloat permute_0(float x) {\n     return mod289_0(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt_0(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat taylorInvSqrt_0(float r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nvec4 grad4(float j, vec4 ip)\n  {\n  const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n  vec4 p,s;\n\n  p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n  p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n  s = vec4(lessThan(p, vec4(0.0)));\n  p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\n\n  return p;\n  }\n\n// (sqrt(5) - 1)/4 = F4, used once below\n#define F4 0.309016994374947451\n\nfloat snoise(vec4 v)\n  {\n  const vec4  C = vec4( 0.138196601125011,  // (5 - sqrt(5))/20  G4\n                        0.276393202250021,  // 2 * G4\n                        0.414589803375032,  // 3 * G4\n                       -0.447213595499958); // -1 + 4 * G4\n\n// First corner\n  vec4 i  = floor(v + dot(v, vec4(F4)) );\n  vec4 x0 = v -   i + dot(i, C.xxxx);\n\n// Other corners\n\n// Rank sorting originally contributed by Bill Licea-Kane, AMD (formerly ATI)\n  vec4 i0;\n  vec3 isX = step( x0.yzw, x0.xxx );\n  vec3 isYZ = step( x0.zww, x0.yyz );\n//  i0.x = dot( isX, vec3( 1.0 ) );\n  i0.x = isX.x + isX.y + isX.z;\n  i0.yzw = 1.0 - isX;\n//  i0.y += dot( isYZ.xy, vec2( 1.0 ) );\n  i0.y += isYZ.x + isYZ.y;\n  i0.zw += 1.0 - isYZ.xy;\n  i0.z += isYZ.z;\n  i0.w += 1.0 - isYZ.z;\n\n  // i0 now contains the unique values 0,1,2,3 in each channel\n  vec4 i3 = clamp( i0, 0.0, 1.0 );\n  vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\n  vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\n\n  //  x0 = x0 - 0.0 + 0.0 * C.xxxx\n  //  x1 = x0 - i1  + 1.0 * C.xxxx\n  //  x2 = x0 - i2  + 2.0 * C.xxxx\n  //  x3 = x0 - i3  + 3.0 * C.xxxx\n  //  x4 = x0 - 1.0 + 4.0 * C.xxxx\n  vec4 x1 = x0 - i1 + C.xxxx;\n  vec4 x2 = x0 - i2 + C.yyyy;\n  vec4 x3 = x0 - i3 + C.zzzz;\n  vec4 x4 = x0 + C.wwww;\n\n// Permutations\n  i = mod289_0(i);\n  float j0 = permute_0( permute_0( permute_0( permute_0(i.w) + i.z) + i.y) + i.x);\n  vec4 j1 = permute_0( permute_0( permute_0( permute_0 (\n             i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n           + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n           + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n           + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\n\n// Gradients: 7x7x6 points over a cube, mapped onto a 4-cross polytope\n// 7*7*6 = 294, which is close to the ring size 17*17 = 289.\n  vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n  vec4 p0 = grad4(j0,   ip);\n  vec4 p1 = grad4(j1.x, ip);\n  vec4 p2 = grad4(j1.y, ip);\n  vec4 p3 = grad4(j1.z, ip);\n  vec4 p4 = grad4(j1.w, ip);\n\n// Normalise gradients\n  vec4 norm = taylorInvSqrt_0(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n  p4 *= taylorInvSqrt_0(dot(p4,p4));\n\n// Mix contributions from the five corners\n  vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\n  vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4)            ), 0.0);\n  m0 = m0 * m0;\n  m1 = m1 * m1;\n  return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n               + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n\n  }\n\n#define S smoothstep\n\nmat2 rot(float angle) {\n  float s = sin(angle), c = cos(angle);\n\n  return mat2(c,-s,s,c);\n}\n\nfloat rand2_1(vec2 p) {\n  p = fract(p * vec2(123.34, 456.21));\n  p += dot(p, p + 45.32);\n\n  return fract(p.x * p.y);\n}\n\nvec3 Star(vec2 uv, float rand, float time) {\n  float d = length(uv);\n  float size = 0.02 + pow(rand, 5.0) * 0.03 * sin(uTime * 0.01 * rand + 100.0);\n\n  float star = pow(size / d, 2.0);\n\n  vec3 col1 = vec3(1.0, 0.7765, 0.7765);\n  vec3 col2 = vec3(0.6588, 0.902, 1.0);\n\n  float col1Str = fract(rand * 21.4);\n  return mix(col1, col2, col1Str) * star;\n}\n\nvec4 Stars(vec2 uv, float uTime) {\n  vec4 Stars = vec4(0.0);\n  vec2 gv = fract(uv) - 0.5;\n  vec2 id = floor(uv);\n\n    for (int y = -1; y <= 1; y++) {\n      for (int x = -1; x <= 1; x++) {\n        vec2 offset = vec2(x,y);\n\n        float n = rand2_1(id + offset);\n        Stars += vec4(Star(gv - offset - vec2(n, fract(n * 69.0)) + 0.5, n, uTime), 1.0);\n      }\n    }\n\n  return Stars;\n}\n\nvoid main() {\n  float fogStr = S(0.92, 0.98, 1.0 - vUv.y);\n  vec4 finalColor = vec4(0.0588, 0.0314, 0.1059, 1.0);\n  vec4 cloudColor = vec4(0.0588, 0.0353, 0.0941, 1.0);\n  vec4 cloudColor2 =vec4(0.102, 0.0392, 0.098, 1.0);\n  vec4 fogColor = vec4(0.7686, 0.7098, 0.8745, 1.0);\n\n  vec3 pos = vPos * 0.05;\n  vec2 uv = vUv * 200.0;\n  float d = distance(vUv, vec2(0.5, 0.15));\n  float size = 0.25;\n  float blackHole = S(0.99, 1.0, size * 0.98 / d);\n\n  float cloudStr = clamp(cnoise(vec4(pos, uTime * 0.0005)), 0.0, 1.0);\n  cloudStr += clamp(snoise(vec4(pos * 0.5, uTime * 0.0005 + 10000.0)), 0.0, 1.0);\n  float noise = clamp(cnoise(vec4(pos, uTime * 0.0005)), 0.0, 1.0);\n  noise += clamp(snoise(vec4(pos * 0.5, uTime * 0.0005 + 10000.0)), 0.0, 1.0);\n\n  finalColor += Stars(uv, uTime) * max(S(0.1, 0.6, noise), 0.1) * (1.0 - blackHole);\n  finalColor += S(0.0, 0.7, cloudStr) * cloudColor * (1.0 - blackHole);\n  finalColor = mix(finalColor, fogColor, fogStr);\n\n  vec3 flareColor = vec3(0.7686, 0.7098, 0.8745);\n\n  pos = vPos;\n  pos.xy *= rot(d * 50.0);\n  pos.xy *= rot(uTime * 0.001);\n\n  noise = cnoise(vec4(pos, uTime * 0.005));\n\n  float innerSize = 0.002 * abs(sin(uTime * 0.005));\n  float str = min(pow(size / d, 20.0 * (sin(uTime * 0.0075) + 1.5)), 1.0) - blackHole;\n  float flareStr = S(0.0, 0.3, noise * str);\n\n  float glow = S(0.3, 0.2, d) - blackHole;\n  float innerGlow = min(sqrt((innerSize / d)), 1.0);\n\n  finalColor += str; // black hole\n  finalColor += flareStr * vec4(flareColor, 1.0); // outer flare\n  finalColor += vec4(0.149, 0.0, 1.0, 1.0) * glow;\n  finalColor += vec4(0.2863, 0.0, 0.0, 1.0) * innerGlow * blackHole;\n\n  finalColor.rb += normalize(vPos.xy) * 0.05 * (1.0 - blackHole) * (1.0 - fogStr);\n\n  gl_FragColor = finalColor;\n}',P.transparent=!1,P.depthTest=!1;const C=new g(64,64);C.setPosition(0,32,-32),C.setRotation(0,0,0),C.vertexShader="#define GLSLIFY 1\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 modelMatrix;\nuniform vec3 uCameraPos;\n\nattribute vec3 aPosition;\nattribute vec2 uv;\n\nvarying vec2 vUv;\nvarying vec3 vPos;\n\nvoid main() {\n  vec4 pos = modelMatrix * vec4(aPosition, 1.0);\n\n  vPos = pos.xyz - uCameraPos;\n  vUv = uv;\n\n  gl_Position = projectionMatrix * viewMatrix * pos;\n}",C.fragmentShader='precision mediump float;\n#define GLSLIFY 1\n\nuniform vec2 uResolution;\nuniform float uTime;\n\nvarying vec2 vUv;\nvarying vec3 vPos;\n\n//\n// GLSL textureless classic 4D noise "cnoise",\n// with an RSL-style periodic variant "pnoise".\n// Author:  Stefan Gustavson (stefan.gustavson@liu.se)\n// Version: 2011-08-22\n//\n// Many thanks to Ian McEwan of Ashima Arts for the\n// ideas for permutation and gradient selection.\n//\n// Copyright (c) 2011 Stefan Gustavson. All rights reserved.\n// Distributed under the MIT license. See LICENSE file.\n// https://github.com/ashima/webgl-noise\n//\n\nvec4 mod289_1(vec4 x)\n{\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute_1(vec4 x)\n{\n  return mod289_1(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt_1(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nvec4 fade(vec4 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\n// Classic Perlin noise\nfloat cnoise(vec4 P)\n{\n  vec4 Pi0 = floor(P); // Integer part for indexing\n  vec4 Pi1 = Pi0 + 1.0; // Integer part + 1\n  Pi0 = mod289_1(Pi0);\n  Pi1 = mod289_1(Pi1);\n  vec4 Pf0 = fract(P); // Fractional part for interpolation\n  vec4 Pf1 = Pf0 - 1.0; // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = vec4(Pi0.zzzz);\n  vec4 iz1 = vec4(Pi1.zzzz);\n  vec4 iw0 = vec4(Pi0.wwww);\n  vec4 iw1 = vec4(Pi1.wwww);\n\n  vec4 ixy = permute_1(permute_1(ix) + iy);\n  vec4 ixy0 = permute_1(ixy + iz0);\n  vec4 ixy1 = permute_1(ixy + iz1);\n  vec4 ixy00 = permute_1(ixy0 + iw0);\n  vec4 ixy01 = permute_1(ixy0 + iw1);\n  vec4 ixy10 = permute_1(ixy1 + iw0);\n  vec4 ixy11 = permute_1(ixy1 + iw1);\n\n  vec4 gx00 = ixy00 * (1.0 / 7.0);\n  vec4 gy00 = floor(gx00) * (1.0 / 7.0);\n  vec4 gz00 = floor(gy00) * (1.0 / 6.0);\n  gx00 = fract(gx00) - 0.5;\n  gy00 = fract(gy00) - 0.5;\n  gz00 = fract(gz00) - 0.5;\n  vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);\n  vec4 sw00 = step(gw00, vec4(0.0));\n  gx00 -= sw00 * (step(0.0, gx00) - 0.5);\n  gy00 -= sw00 * (step(0.0, gy00) - 0.5);\n\n  vec4 gx01 = ixy01 * (1.0 / 7.0);\n  vec4 gy01 = floor(gx01) * (1.0 / 7.0);\n  vec4 gz01 = floor(gy01) * (1.0 / 6.0);\n  gx01 = fract(gx01) - 0.5;\n  gy01 = fract(gy01) - 0.5;\n  gz01 = fract(gz01) - 0.5;\n  vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);\n  vec4 sw01 = step(gw01, vec4(0.0));\n  gx01 -= sw01 * (step(0.0, gx01) - 0.5);\n  gy01 -= sw01 * (step(0.0, gy01) - 0.5);\n\n  vec4 gx10 = ixy10 * (1.0 / 7.0);\n  vec4 gy10 = floor(gx10) * (1.0 / 7.0);\n  vec4 gz10 = floor(gy10) * (1.0 / 6.0);\n  gx10 = fract(gx10) - 0.5;\n  gy10 = fract(gy10) - 0.5;\n  gz10 = fract(gz10) - 0.5;\n  vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);\n  vec4 sw10 = step(gw10, vec4(0.0));\n  gx10 -= sw10 * (step(0.0, gx10) - 0.5);\n  gy10 -= sw10 * (step(0.0, gy10) - 0.5);\n\n  vec4 gx11 = ixy11 * (1.0 / 7.0);\n  vec4 gy11 = floor(gx11) * (1.0 / 7.0);\n  vec4 gz11 = floor(gy11) * (1.0 / 6.0);\n  gx11 = fract(gx11) - 0.5;\n  gy11 = fract(gy11) - 0.5;\n  gz11 = fract(gz11) - 0.5;\n  vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);\n  vec4 sw11 = step(gw11, vec4(0.0));\n  gx11 -= sw11 * (step(0.0, gx11) - 0.5);\n  gy11 -= sw11 * (step(0.0, gy11) - 0.5);\n\n  vec4 g0000 = vec4(gx00.x,gy00.x,gz00.x,gw00.x);\n  vec4 g1000 = vec4(gx00.y,gy00.y,gz00.y,gw00.y);\n  vec4 g0100 = vec4(gx00.z,gy00.z,gz00.z,gw00.z);\n  vec4 g1100 = vec4(gx00.w,gy00.w,gz00.w,gw00.w);\n  vec4 g0010 = vec4(gx10.x,gy10.x,gz10.x,gw10.x);\n  vec4 g1010 = vec4(gx10.y,gy10.y,gz10.y,gw10.y);\n  vec4 g0110 = vec4(gx10.z,gy10.z,gz10.z,gw10.z);\n  vec4 g1110 = vec4(gx10.w,gy10.w,gz10.w,gw10.w);\n  vec4 g0001 = vec4(gx01.x,gy01.x,gz01.x,gw01.x);\n  vec4 g1001 = vec4(gx01.y,gy01.y,gz01.y,gw01.y);\n  vec4 g0101 = vec4(gx01.z,gy01.z,gz01.z,gw01.z);\n  vec4 g1101 = vec4(gx01.w,gy01.w,gz01.w,gw01.w);\n  vec4 g0011 = vec4(gx11.x,gy11.x,gz11.x,gw11.x);\n  vec4 g1011 = vec4(gx11.y,gy11.y,gz11.y,gw11.y);\n  vec4 g0111 = vec4(gx11.z,gy11.z,gz11.z,gw11.z);\n  vec4 g1111 = vec4(gx11.w,gy11.w,gz11.w,gw11.w);\n\n  vec4 norm00 = taylorInvSqrt_1(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));\n  g0000 *= norm00.x;\n  g0100 *= norm00.y;\n  g1000 *= norm00.z;\n  g1100 *= norm00.w;\n\n  vec4 norm01 = taylorInvSqrt_1(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));\n  g0001 *= norm01.x;\n  g0101 *= norm01.y;\n  g1001 *= norm01.z;\n  g1101 *= norm01.w;\n\n  vec4 norm10 = taylorInvSqrt_1(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));\n  g0010 *= norm10.x;\n  g0110 *= norm10.y;\n  g1010 *= norm10.z;\n  g1110 *= norm10.w;\n\n  vec4 norm11 = taylorInvSqrt_1(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));\n  g0011 *= norm11.x;\n  g0111 *= norm11.y;\n  g1011 *= norm11.z;\n  g1111 *= norm11.w;\n\n  float n0000 = dot(g0000, Pf0);\n  float n1000 = dot(g1000, vec4(Pf1.x, Pf0.yzw));\n  float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.zw));\n  float n1100 = dot(g1100, vec4(Pf1.xy, Pf0.zw));\n  float n0010 = dot(g0010, vec4(Pf0.xy, Pf1.z, Pf0.w));\n  float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));\n  float n0110 = dot(g0110, vec4(Pf0.x, Pf1.yz, Pf0.w));\n  float n1110 = dot(g1110, vec4(Pf1.xyz, Pf0.w));\n  float n0001 = dot(g0001, vec4(Pf0.xyz, Pf1.w));\n  float n1001 = dot(g1001, vec4(Pf1.x, Pf0.yz, Pf1.w));\n  float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));\n  float n1101 = dot(g1101, vec4(Pf1.xy, Pf0.z, Pf1.w));\n  float n0011 = dot(g0011, vec4(Pf0.xy, Pf1.zw));\n  float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.zw));\n  float n0111 = dot(g0111, vec4(Pf0.x, Pf1.yzw));\n  float n1111 = dot(g1111, Pf1);\n\n  vec4 fade_xyzw = fade(Pf0);\n  vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);\n  vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);\n  vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);\n  vec2 n_yzw = mix(n_zw.xy, n_zw.zw, fade_xyzw.y);\n  float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);\n  return 2.2 * n_xyzw;\n}\n\n//\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec4 mod289_0(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0; }\n\nfloat mod289_0(float x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0; }\n\nvec4 permute_0(vec4 x) {\n     return mod289_0(((x*34.0)+1.0)*x);\n}\n\nfloat permute_0(float x) {\n     return mod289_0(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt_0(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat taylorInvSqrt_0(float r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nvec4 grad4(float j, vec4 ip)\n  {\n  const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n  vec4 p,s;\n\n  p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n  p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n  s = vec4(lessThan(p, vec4(0.0)));\n  p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\n\n  return p;\n  }\n\n// (sqrt(5) - 1)/4 = F4, used once below\n#define F4 0.309016994374947451\n\nfloat snoise(vec4 v)\n  {\n  const vec4  C = vec4( 0.138196601125011,  // (5 - sqrt(5))/20  G4\n                        0.276393202250021,  // 2 * G4\n                        0.414589803375032,  // 3 * G4\n                       -0.447213595499958); // -1 + 4 * G4\n\n// First corner\n  vec4 i  = floor(v + dot(v, vec4(F4)) );\n  vec4 x0 = v -   i + dot(i, C.xxxx);\n\n// Other corners\n\n// Rank sorting originally contributed by Bill Licea-Kane, AMD (formerly ATI)\n  vec4 i0;\n  vec3 isX = step( x0.yzw, x0.xxx );\n  vec3 isYZ = step( x0.zww, x0.yyz );\n//  i0.x = dot( isX, vec3( 1.0 ) );\n  i0.x = isX.x + isX.y + isX.z;\n  i0.yzw = 1.0 - isX;\n//  i0.y += dot( isYZ.xy, vec2( 1.0 ) );\n  i0.y += isYZ.x + isYZ.y;\n  i0.zw += 1.0 - isYZ.xy;\n  i0.z += isYZ.z;\n  i0.w += 1.0 - isYZ.z;\n\n  // i0 now contains the unique values 0,1,2,3 in each channel\n  vec4 i3 = clamp( i0, 0.0, 1.0 );\n  vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\n  vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\n\n  //  x0 = x0 - 0.0 + 0.0 * C.xxxx\n  //  x1 = x0 - i1  + 1.0 * C.xxxx\n  //  x2 = x0 - i2  + 2.0 * C.xxxx\n  //  x3 = x0 - i3  + 3.0 * C.xxxx\n  //  x4 = x0 - 1.0 + 4.0 * C.xxxx\n  vec4 x1 = x0 - i1 + C.xxxx;\n  vec4 x2 = x0 - i2 + C.yyyy;\n  vec4 x3 = x0 - i3 + C.zzzz;\n  vec4 x4 = x0 + C.wwww;\n\n// Permutations\n  i = mod289_0(i);\n  float j0 = permute_0( permute_0( permute_0( permute_0(i.w) + i.z) + i.y) + i.x);\n  vec4 j1 = permute_0( permute_0( permute_0( permute_0 (\n             i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n           + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n           + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n           + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\n\n// Gradients: 7x7x6 points over a cube, mapped onto a 4-cross polytope\n// 7*7*6 = 294, which is close to the ring size 17*17 = 289.\n  vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n  vec4 p0 = grad4(j0,   ip);\n  vec4 p1 = grad4(j1.x, ip);\n  vec4 p2 = grad4(j1.y, ip);\n  vec4 p3 = grad4(j1.z, ip);\n  vec4 p4 = grad4(j1.w, ip);\n\n// Normalise gradients\n  vec4 norm = taylorInvSqrt_0(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n  p4 *= taylorInvSqrt_0(dot(p4,p4));\n\n// Mix contributions from the five corners\n  vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\n  vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4)            ), 0.0);\n  m0 = m0 * m0;\n  m1 = m1 * m1;\n  return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n               + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n\n  }\n\n#define S smoothstep\n\nmat2 rot(float angle) {\n  float s = sin(angle), c = cos(angle);\n\n  return mat2(c,-s,s,c);\n}\n\nfloat rand2_1(vec2 p) {\n  p = fract(p * vec2(123.34, 456.21));\n  p += dot(p, p + 45.32);\n\n  return fract(p.x * p.y);\n}\n\nvec3 Star(vec2 uv, float rand, float time) {\n  float d = length(uv);\n  float size = 0.02 + pow(rand, 5.0) * 0.03 * sin(uTime * 0.01 * rand + 100.0);\n\n  float star = pow(size / d, 2.0);\n\n  vec3 col1 = vec3(1.0, 0.7765, 0.7765);\n  vec3 col2 = vec3(0.6588, 0.902, 1.0);\n\n  float col1Str = fract(rand * 21.4);\n  return mix(col1, col2, col1Str) * star;\n}\n\nvec4 Stars(vec2 uv, float uTime) {\n  vec4 Stars = vec4(0.0);\n  vec2 gv = fract(uv) - 0.5;\n  vec2 id = floor(uv);\n\n    for (int y = -1; y <= 1; y++) {\n      for (int x = -1; x <= 1; x++) {\n        vec2 offset = vec2(x,y);\n\n        float n = rand2_1(id + offset);\n        Stars += vec4(Star(gv - offset - vec2(n, fract(n * 69.0)) + 0.5, n, uTime), 1.0);\n      }\n    }\n\n  return Stars;\n}\n\nvoid main() {\n  float fogStr = S(0.92, 0.98, 1.0 - vUv.y);\n  vec4 finalColor = vec4(0.0588, 0.0314, 0.1059, 1.0);\n  vec4 cloudColor = vec4(0.0588, 0.0353, 0.0941, 1.0);\n  vec4 cloudColor2 =vec4(0.102, 0.0392, 0.098, 1.0);\n  vec4 fogColor = vec4(0.7686, 0.7098, 0.8745, 1.0);\n\n  vec3 pos = vPos * 0.05;\n  vec2 uv = vUv * 200.0;\n  float d = distance(vUv, vec2(0.5, 0.15));\n  float size = 0.25;\n  float blackHole = S(0.99, 1.0, size * 0.98 / d);\n\n  float cloudStr = clamp(cnoise(vec4(pos, uTime * 0.0005)), 0.0, 1.0);\n  cloudStr += clamp(snoise(vec4(pos * 0.5, uTime * 0.0005 + 10000.0)), 0.0, 1.0);\n  float noise = clamp(cnoise(vec4(pos, uTime * 0.0005)), 0.0, 1.0);\n  noise += clamp(snoise(vec4(pos * 0.5, uTime * 0.0005 + 10000.0)), 0.0, 1.0);\n\n  finalColor += Stars(uv, uTime) * max(S(0.1, 0.6, noise), 0.1) * (1.0 - blackHole);\n  finalColor += S(0.0, 0.7, cloudStr) * cloudColor * (1.0 - blackHole);\n  finalColor = mix(finalColor, fogColor, fogStr);\n\n  vec3 flareColor = vec3(0.7686, 0.7098, 0.8745);\n\n  pos = vPos;\n  pos.xy *= rot(uTime * 0.0005);\n\n  noise = cnoise(vec4(pos, uTime * 0.005));\n\n  float innerSize = 0.002 * abs(sin(uTime * 0.005));\n  float str = min(pow(size / d, 20.0 * (sin(uTime * -0.0075) + 1.5)), 1.0) - blackHole;\n  float flareStr = S(0.0, 0.3, noise * str);\n\n  float glow = S(0.3, 0.2, d) - blackHole;\n  float innerGlow = min(sqrt((innerSize / d)), 1.0);\n\n  finalColor += str; // black hole\n  finalColor += flareStr * vec4(flareColor, 1.0); // outer flare\n  finalColor += vec4(0.2863, 0.0, 0.0, 1.0) * glow;\n  finalColor += vec4(0.149, 0.0, 1.0, 1.0) * innerGlow * blackHole;\n\n  finalColor.rb += normalize(vPos.xy) * 0.05 * (1.0 - blackHole) * (1.0 - fogStr);\n\n  gl_FragColor = finalColor;\n}',C.transparent=!1,C.depthTest=!1;const z=new g(64,64);z.setPosition(32,32,0),z.setRotation(0,-90,0),z.vertexShader=w,z.fragmentShader=y,z.transparent=!1,z.depthTest=!1;const E=new g(64,64);E.setPosition(-32,32,0),E.setRotation(0,90,0),E.vertexShader=w,E.fragmentShader=y,E.transparent=!1,E.depthTest=!1;const S=new g(64,64);S.setPosition(0,64,0),S.setRotation(90,0,0),S.vertexShader="#define GLSLIFY 1\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 modelMatrix;\nuniform vec3 uCameraPos;\n\nattribute vec3 aPosition;\nattribute vec2 uv;\n\nvarying vec2 vUv;\nvarying vec3 vPos;\n\nvoid main() {\n  vec4 pos = modelMatrix * vec4(aPosition, 1.0);\n\n  vPos = pos.xyz - uCameraPos;\n  vUv = uv;\n\n  gl_Position = projectionMatrix * viewMatrix * pos;\n}",S.fragmentShader='precision mediump float;\n#define GLSLIFY 1\n\nuniform vec2 uResolution;\nuniform float uTime;\n\nvarying vec2 vUv;\nvarying vec3 vPos;\n\n//\n// GLSL textureless classic 4D noise "cnoise",\n// with an RSL-style periodic variant "pnoise".\n// Author:  Stefan Gustavson (stefan.gustavson@liu.se)\n// Version: 2011-08-22\n//\n// Many thanks to Ian McEwan of Ashima Arts for the\n// ideas for permutation and gradient selection.\n//\n// Copyright (c) 2011 Stefan Gustavson. All rights reserved.\n// Distributed under the MIT license. See LICENSE file.\n// https://github.com/ashima/webgl-noise\n//\n\nvec4 mod289_0(vec4 x)\n{\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute_0(vec4 x)\n{\n  return mod289_0(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt_0(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nvec4 fade(vec4 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\n// Classic Perlin noise\nfloat cnoise(vec4 P)\n{\n  vec4 Pi0 = floor(P); // Integer part for indexing\n  vec4 Pi1 = Pi0 + 1.0; // Integer part + 1\n  Pi0 = mod289_0(Pi0);\n  Pi1 = mod289_0(Pi1);\n  vec4 Pf0 = fract(P); // Fractional part for interpolation\n  vec4 Pf1 = Pf0 - 1.0; // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = vec4(Pi0.zzzz);\n  vec4 iz1 = vec4(Pi1.zzzz);\n  vec4 iw0 = vec4(Pi0.wwww);\n  vec4 iw1 = vec4(Pi1.wwww);\n\n  vec4 ixy = permute_0(permute_0(ix) + iy);\n  vec4 ixy0 = permute_0(ixy + iz0);\n  vec4 ixy1 = permute_0(ixy + iz1);\n  vec4 ixy00 = permute_0(ixy0 + iw0);\n  vec4 ixy01 = permute_0(ixy0 + iw1);\n  vec4 ixy10 = permute_0(ixy1 + iw0);\n  vec4 ixy11 = permute_0(ixy1 + iw1);\n\n  vec4 gx00 = ixy00 * (1.0 / 7.0);\n  vec4 gy00 = floor(gx00) * (1.0 / 7.0);\n  vec4 gz00 = floor(gy00) * (1.0 / 6.0);\n  gx00 = fract(gx00) - 0.5;\n  gy00 = fract(gy00) - 0.5;\n  gz00 = fract(gz00) - 0.5;\n  vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);\n  vec4 sw00 = step(gw00, vec4(0.0));\n  gx00 -= sw00 * (step(0.0, gx00) - 0.5);\n  gy00 -= sw00 * (step(0.0, gy00) - 0.5);\n\n  vec4 gx01 = ixy01 * (1.0 / 7.0);\n  vec4 gy01 = floor(gx01) * (1.0 / 7.0);\n  vec4 gz01 = floor(gy01) * (1.0 / 6.0);\n  gx01 = fract(gx01) - 0.5;\n  gy01 = fract(gy01) - 0.5;\n  gz01 = fract(gz01) - 0.5;\n  vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);\n  vec4 sw01 = step(gw01, vec4(0.0));\n  gx01 -= sw01 * (step(0.0, gx01) - 0.5);\n  gy01 -= sw01 * (step(0.0, gy01) - 0.5);\n\n  vec4 gx10 = ixy10 * (1.0 / 7.0);\n  vec4 gy10 = floor(gx10) * (1.0 / 7.0);\n  vec4 gz10 = floor(gy10) * (1.0 / 6.0);\n  gx10 = fract(gx10) - 0.5;\n  gy10 = fract(gy10) - 0.5;\n  gz10 = fract(gz10) - 0.5;\n  vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);\n  vec4 sw10 = step(gw10, vec4(0.0));\n  gx10 -= sw10 * (step(0.0, gx10) - 0.5);\n  gy10 -= sw10 * (step(0.0, gy10) - 0.5);\n\n  vec4 gx11 = ixy11 * (1.0 / 7.0);\n  vec4 gy11 = floor(gx11) * (1.0 / 7.0);\n  vec4 gz11 = floor(gy11) * (1.0 / 6.0);\n  gx11 = fract(gx11) - 0.5;\n  gy11 = fract(gy11) - 0.5;\n  gz11 = fract(gz11) - 0.5;\n  vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);\n  vec4 sw11 = step(gw11, vec4(0.0));\n  gx11 -= sw11 * (step(0.0, gx11) - 0.5);\n  gy11 -= sw11 * (step(0.0, gy11) - 0.5);\n\n  vec4 g0000 = vec4(gx00.x,gy00.x,gz00.x,gw00.x);\n  vec4 g1000 = vec4(gx00.y,gy00.y,gz00.y,gw00.y);\n  vec4 g0100 = vec4(gx00.z,gy00.z,gz00.z,gw00.z);\n  vec4 g1100 = vec4(gx00.w,gy00.w,gz00.w,gw00.w);\n  vec4 g0010 = vec4(gx10.x,gy10.x,gz10.x,gw10.x);\n  vec4 g1010 = vec4(gx10.y,gy10.y,gz10.y,gw10.y);\n  vec4 g0110 = vec4(gx10.z,gy10.z,gz10.z,gw10.z);\n  vec4 g1110 = vec4(gx10.w,gy10.w,gz10.w,gw10.w);\n  vec4 g0001 = vec4(gx01.x,gy01.x,gz01.x,gw01.x);\n  vec4 g1001 = vec4(gx01.y,gy01.y,gz01.y,gw01.y);\n  vec4 g0101 = vec4(gx01.z,gy01.z,gz01.z,gw01.z);\n  vec4 g1101 = vec4(gx01.w,gy01.w,gz01.w,gw01.w);\n  vec4 g0011 = vec4(gx11.x,gy11.x,gz11.x,gw11.x);\n  vec4 g1011 = vec4(gx11.y,gy11.y,gz11.y,gw11.y);\n  vec4 g0111 = vec4(gx11.z,gy11.z,gz11.z,gw11.z);\n  vec4 g1111 = vec4(gx11.w,gy11.w,gz11.w,gw11.w);\n\n  vec4 norm00 = taylorInvSqrt_0(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));\n  g0000 *= norm00.x;\n  g0100 *= norm00.y;\n  g1000 *= norm00.z;\n  g1100 *= norm00.w;\n\n  vec4 norm01 = taylorInvSqrt_0(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));\n  g0001 *= norm01.x;\n  g0101 *= norm01.y;\n  g1001 *= norm01.z;\n  g1101 *= norm01.w;\n\n  vec4 norm10 = taylorInvSqrt_0(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));\n  g0010 *= norm10.x;\n  g0110 *= norm10.y;\n  g1010 *= norm10.z;\n  g1110 *= norm10.w;\n\n  vec4 norm11 = taylorInvSqrt_0(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));\n  g0011 *= norm11.x;\n  g0111 *= norm11.y;\n  g1011 *= norm11.z;\n  g1111 *= norm11.w;\n\n  float n0000 = dot(g0000, Pf0);\n  float n1000 = dot(g1000, vec4(Pf1.x, Pf0.yzw));\n  float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.zw));\n  float n1100 = dot(g1100, vec4(Pf1.xy, Pf0.zw));\n  float n0010 = dot(g0010, vec4(Pf0.xy, Pf1.z, Pf0.w));\n  float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));\n  float n0110 = dot(g0110, vec4(Pf0.x, Pf1.yz, Pf0.w));\n  float n1110 = dot(g1110, vec4(Pf1.xyz, Pf0.w));\n  float n0001 = dot(g0001, vec4(Pf0.xyz, Pf1.w));\n  float n1001 = dot(g1001, vec4(Pf1.x, Pf0.yz, Pf1.w));\n  float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));\n  float n1101 = dot(g1101, vec4(Pf1.xy, Pf0.z, Pf1.w));\n  float n0011 = dot(g0011, vec4(Pf0.xy, Pf1.zw));\n  float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.zw));\n  float n0111 = dot(g0111, vec4(Pf0.x, Pf1.yzw));\n  float n1111 = dot(g1111, Pf1);\n\n  vec4 fade_xyzw = fade(Pf0);\n  vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);\n  vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);\n  vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);\n  vec2 n_yzw = mix(n_zw.xy, n_zw.zw, fade_xyzw.y);\n  float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);\n  return 2.2 * n_xyzw;\n}\n\n//\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec4 mod289_1(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0; }\n\nfloat mod289_1(float x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0; }\n\nvec4 permute_1(vec4 x) {\n     return mod289_1(((x*34.0)+1.0)*x);\n}\n\nfloat permute_1(float x) {\n     return mod289_1(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt_1(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat taylorInvSqrt_1(float r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nvec4 grad4(float j, vec4 ip)\n  {\n  const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n  vec4 p,s;\n\n  p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n  p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n  s = vec4(lessThan(p, vec4(0.0)));\n  p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\n\n  return p;\n  }\n\n// (sqrt(5) - 1)/4 = F4, used once below\n#define F4 0.309016994374947451\n\nfloat snoise(vec4 v)\n  {\n  const vec4  C = vec4( 0.138196601125011,  // (5 - sqrt(5))/20  G4\n                        0.276393202250021,  // 2 * G4\n                        0.414589803375032,  // 3 * G4\n                       -0.447213595499958); // -1 + 4 * G4\n\n// First corner\n  vec4 i  = floor(v + dot(v, vec4(F4)) );\n  vec4 x0 = v -   i + dot(i, C.xxxx);\n\n// Other corners\n\n// Rank sorting originally contributed by Bill Licea-Kane, AMD (formerly ATI)\n  vec4 i0;\n  vec3 isX = step( x0.yzw, x0.xxx );\n  vec3 isYZ = step( x0.zww, x0.yyz );\n//  i0.x = dot( isX, vec3( 1.0 ) );\n  i0.x = isX.x + isX.y + isX.z;\n  i0.yzw = 1.0 - isX;\n//  i0.y += dot( isYZ.xy, vec2( 1.0 ) );\n  i0.y += isYZ.x + isYZ.y;\n  i0.zw += 1.0 - isYZ.xy;\n  i0.z += isYZ.z;\n  i0.w += 1.0 - isYZ.z;\n\n  // i0 now contains the unique values 0,1,2,3 in each channel\n  vec4 i3 = clamp( i0, 0.0, 1.0 );\n  vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\n  vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\n\n  //  x0 = x0 - 0.0 + 0.0 * C.xxxx\n  //  x1 = x0 - i1  + 1.0 * C.xxxx\n  //  x2 = x0 - i2  + 2.0 * C.xxxx\n  //  x3 = x0 - i3  + 3.0 * C.xxxx\n  //  x4 = x0 - 1.0 + 4.0 * C.xxxx\n  vec4 x1 = x0 - i1 + C.xxxx;\n  vec4 x2 = x0 - i2 + C.yyyy;\n  vec4 x3 = x0 - i3 + C.zzzz;\n  vec4 x4 = x0 + C.wwww;\n\n// Permutations\n  i = mod289_1(i);\n  float j0 = permute_1( permute_1( permute_1( permute_1(i.w) + i.z) + i.y) + i.x);\n  vec4 j1 = permute_1( permute_1( permute_1( permute_1 (\n             i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n           + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n           + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n           + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\n\n// Gradients: 7x7x6 points over a cube, mapped onto a 4-cross polytope\n// 7*7*6 = 294, which is close to the ring size 17*17 = 289.\n  vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n  vec4 p0 = grad4(j0,   ip);\n  vec4 p1 = grad4(j1.x, ip);\n  vec4 p2 = grad4(j1.y, ip);\n  vec4 p3 = grad4(j1.z, ip);\n  vec4 p4 = grad4(j1.w, ip);\n\n// Normalise gradients\n  vec4 norm = taylorInvSqrt_1(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n  p4 *= taylorInvSqrt_1(dot(p4,p4));\n\n// Mix contributions from the five corners\n  vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\n  vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4)            ), 0.0);\n  m0 = m0 * m0;\n  m1 = m1 * m1;\n  return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n               + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n\n  }\n\n#define S smoothstep\n\nfloat rand2_1(vec2 p) {\n  p = fract(p * vec2(123.34, 456.21));\n  p += dot(p, p + 45.32);\n\n  return fract(p.x * p.y);\n}\n\nvec3 Star(vec2 uv, float rand, float time) {\n  float d = length(uv);\n  float size = 0.02 + pow(rand, 5.0) * 0.03 * sin(uTime * 0.01 * rand + 100.0);\n\n  float star = pow(size / d, 2.0);\n\n  vec3 col1 = vec3(1.0, 0.7765, 0.7765);\n  vec3 col2 = vec3(0.6588, 0.902, 1.0);\n\n  float col1Str = fract(rand * 21.4);\n  return mix(col1, col2, col1Str) * star;\n}\n\nvec4 Stars(vec2 uv, float uTime) {\n  vec4 Stars = vec4(0.0);\n  vec2 gv = fract(uv) - 0.5;\n  vec2 id = floor(uv);\n\n    for (int y = -1; y <= 1; y++) {\n      for (int x = -1; x <= 1; x++) {\n        vec2 offset = vec2(x,y);\n\n        float n = rand2_1(id + offset);\n        Stars += vec4(Star(gv - offset - vec2(n, fract(n * 69.0)) + 0.5, n, uTime), 1.0);\n      }\n    }\n\n  return Stars;\n}\n\nvoid main() {\n  vec4 finalColor = vec4(0.0588, 0.0314, 0.1059, 1.0);\n  vec4 cloudColor = vec4(0.0588, 0.0353, 0.0941, 1.0);\n  vec4 cloudColor2 =vec4(0.102, 0.0392, 0.098, 1.0);\n  vec4 fogColor = vec4(0.7686, 0.7098, 0.8745, 1.0);\n\n  vec3 pos = vPos * 0.05;\n  vec2 uv = vUv * 200.0;\n\n  float cloudStr = clamp(cnoise(vec4(pos, uTime * 0.0005)), 0.0, 1.0);\n  cloudStr += clamp(snoise(vec4(pos * 0.5, uTime * 0.0005 + 10000.0)), 0.0, 1.0);\n  float noise = clamp(cnoise(vec4(pos, uTime * 0.0005)), 0.0, 1.0);\n  noise += clamp(snoise(vec4(pos * 0.5, uTime * 0.0005 + 10000.0)), 0.0, 1.0);\n  \n\n  finalColor += Stars(uv, uTime) * max(S(0.1, 0.6, noise), 0.1);\n  finalColor += S(0.0, 0.7, cloudStr) * cloudColor;\n\n  finalColor.rb += normalize(vPos.xy) * 0.05;\n\n  gl_FragColor = finalColor;\n}',S.transparent=!1,S.depthTest=!1,_.add([b,P,z,E,C,S]);var A=new s,M=i(466),L=i.n(M),k=i(498),V=new s,B=new s;new s,new s;class R extends m{constructor(t=[0,0,0],e=[0,0,0],n=[1,1,1]){super(t,e,n),this.type="cube",this.visible=!0,this.attributes.push(new d(new Float32Array([-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5]),3,"aPosition")),this.attributes.push(new d(new Float32Array([0,1,0,0,1,0,0,1,1,0,1,1,0,1,0,0,1,0,0,1,1,0,1,1,0,1,0,0,1,0,0,1,1,0,1,1,1,0,1,1,0,1,1,0,0,1,0,0,0,1,0,0,1,1,1,1,0,0,1,0,0,1,0,0,1,0,0,1,1,0,1,1]),2,"uv")),this.attributes.push(new d(new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0]),3,"normal"));let i=[];for(let t=0;t<36;t++)i.push(t);this.indices=new Uint16Array(i)}}const T='#define GLSLIFY 1\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 modelMatrix;\nuniform float uTime;\nuniform vec3 uCameraPos;\n\nattribute vec3 aPosition;\nattribute vec2 uv;\nattribute vec3 normal;\n\nvarying vec3 vNormal;\nvarying vec3 vPos;\nvarying vec2 vUv;\nvarying float vFogDist;\n\n//\n// GLSL textureless classic 3D noise "cnoise",\n// with an RSL-style periodic variant "pnoise".\n// Author:  Stefan Gustavson (stefan.gustavson@liu.se)\n// Version: 2011-10-11\n//\n// Many thanks to Ian McEwan of Ashima Arts for the\n// ideas for permutation and gradient selection.\n//\n// Copyright (c) 2011 Stefan Gustavson. All rights reserved.\n// Distributed under the MIT license. See LICENSE file.\n// https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289(vec3 x)\n{\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289(vec4 x)\n{\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute(vec4 x)\n{\n  return mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nvec3 fade(vec3 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\n// Classic Perlin noise\nfloat cnoise(vec3 P)\n{\n  vec3 Pi0 = floor(P); // Integer part for indexing\n  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n  Pi0 = mod289(Pi0);\n  Pi1 = mod289(Pi1);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 * (1.0 / 7.0);\n  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 * (1.0 / 7.0);\n  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n  return 2.2 * n_xyz;\n}\n\nfloat transpose(float m) {\n  return m;\n}\n\nmat2 transpose(mat2 m) {\n  return mat2(m[0][0], m[1][0],\n              m[0][1], m[1][1]);\n}\n\nmat3 transpose(mat3 m) {\n  return mat3(m[0][0], m[1][0], m[2][0],\n              m[0][1], m[1][1], m[2][1],\n              m[0][2], m[1][2], m[2][2]);\n}\n\nmat4 transpose(mat4 m) {\n  return mat4(m[0][0], m[1][0], m[2][0], m[3][0],\n              m[0][1], m[1][1], m[2][1], m[3][1],\n              m[0][2], m[1][2], m[2][2], m[3][2],\n              m[0][3], m[1][3], m[2][3], m[3][3]);\n}\n\nfloat inverse(float m) {\n  return 1.0 / m;\n}\n\nmat2 inverse(mat2 m) {\n  return mat2(m[1][1],-m[0][1],\n             -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n}\n\nmat3 inverse(mat3 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n  float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n  float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n              b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n              b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nmat4 inverse(mat4 m) {\n  float\n      a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n      a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n      a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n      a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n      b00 = a00 * a11 - a01 * a10,\n      b01 = a00 * a12 - a02 * a10,\n      b02 = a00 * a13 - a03 * a10,\n      b03 = a01 * a12 - a02 * a11,\n      b04 = a01 * a13 - a03 * a11,\n      b05 = a02 * a13 - a03 * a12,\n      b06 = a20 * a31 - a21 * a30,\n      b07 = a20 * a32 - a22 * a30,\n      b08 = a20 * a33 - a23 * a30,\n      b09 = a21 * a32 - a22 * a31,\n      b10 = a21 * a33 - a23 * a31,\n      b11 = a22 * a33 - a23 * a32,\n\n      det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4(\n      a11 * b11 - a12 * b10 + a13 * b09,\n      a02 * b10 - a01 * b11 - a03 * b09,\n      a31 * b05 - a32 * b04 + a33 * b03,\n      a22 * b04 - a21 * b05 - a23 * b03,\n      a12 * b08 - a10 * b11 - a13 * b07,\n      a00 * b11 - a02 * b08 + a03 * b07,\n      a32 * b02 - a30 * b05 - a33 * b01,\n      a20 * b05 - a22 * b02 + a23 * b01,\n      a10 * b10 - a11 * b08 + a13 * b06,\n      a01 * b08 - a00 * b10 - a03 * b06,\n      a30 * b04 - a31 * b02 + a33 * b00,\n      a21 * b02 - a20 * b04 - a23 * b00,\n      a11 * b07 - a10 * b09 - a12 * b06,\n      a00 * b09 - a01 * b07 + a02 * b06,\n      a31 * b01 - a30 * b03 - a32 * b00,\n      a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n\nvoid main() {\n  vec4 pos = modelMatrix * vec4(aPosition, 1.0);\n\n  vPos = pos.xyz;\n  vNormal = transpose(inverse(mat3(modelMatrix))) * normal;\n  vUv = uv;\n\n  gl_Position = projectionMatrix * viewMatrix * pos;\n  vFogDist = distance(pos.xyz, uCameraPos.xyz);\n}',I="precision mediump float;\n#define GLSLIFY 1\n\nuniform vec2 uResolution;\nuniform sampler2D uTexture;\nuniform float uAmbientIntensity;\nuniform vec3 uAmbientColor;\nuniform float uPointLightIntensity;\nuniform vec3 uPointLightColor;\nuniform vec3 uPointLightPos;\nuniform float uSpecularExponent;\n\nuniform float uSpotLightIntensity;\nuniform vec3 uSpotLightColor;\nuniform vec3 uSpotLightPos;\nuniform float uSpotSpecularExponent;\nuniform float uSpotLightAngle;\nuniform vec3 uSpotLightTarget;\n\nuniform vec3 uCamPos;\n\nvarying vec3 vNormal;\nvarying float vFogDist;\nvarying vec3 vPos;\nvarying vec2 vUv;\n\n#define FOG_START 5.0\n#define FOG_END 20.0\n\nvoid main() {\n  float fogFactor = clamp((FOG_END - vFogDist) / (FOG_END - FOG_START), 0.0, 1.0);\n\n  vec3 fogColor = vec3(0.7686, 0.7098, 0.8745);\n\n  vec4 texColor = texture2D(uTexture, vUv * 0.2);\n\n  vec3 normal = normalize(vNormal);\n  vec3 spotLightTarget = normalize(uSpotLightTarget - uSpotLightPos);\n\n  vec3 lightDir = normalize(uPointLightPos - vPos);\n  vec3 spotLightDir = -normalize(vPos - uSpotLightPos);\n\n  vec3 ambient = uAmbientColor * uAmbientIntensity;\n\n  vec3 diffuse = clamp(uPointLightIntensity * uPointLightColor * dot(lightDir, normal), 0.0, 1.0);\n\n  vec3 reflection = normalize(2.0 * dot(normal, lightDir) * normal - lightDir);\n  vec3 viewDir = normalize(uCamPos - vPos);\n  float specularHighlight = pow(clamp(dot(reflection, viewDir), 0.0, 1.0), uSpecularExponent);\n  vec3 specular = specularHighlight * uPointLightColor;\n\n  float multiplier = pow(max(0.0, uSpotLightAngle - dot(spotLightTarget, spotLightDir)), 5.0);\n\n  vec3 spotDiffuse = clamp(uSpotLightColor * uSpotLightIntensity * multiplier * dot(spotLightDir, normal), 0.0, 1.0);\n\n  vec4 lighting = vec4(ambient + diffuse + specular + spotDiffuse, 1.0);\n\n  vec4 color = texColor * lighting;\n\n  gl_FragColor = mix(color, vec4(fogColor, 1.0), 1.0 - fogFactor);\n}";let F=new s;class q extends R{constructor(t=[0,0,0],e=[0,0,0],n=[1,1,1]){return super(t,e,n),this.type="rock",this.setColor([.2,.2,.4]),this.vertexShader=T,this.fragmentShader=I,this}getWorldPosition(){return[...F.set(this.position).add(this.parent.position).elements]}setWorldPosition(){}}new s,new s;class N extends m{constructor(t=3,e=[0,0,0],n=[0,0,0],i=[.5,.25,.325]){super(e,n);let o=i[0],r=i[1],s=1.2*Math.random();for(let e=1;e<=t;e++)if(e%2==0)for(let n=0;n<e;n++){let a=new q([(e/2-.5-n)*o+s,(t-1-e)*r+r/2+s,0],[0,0,0],[i[0],i[1],i[2]+.1*e]);this.add(a)}else for(let n=0;n<e;n++){let a=new q([(Math.floor(e/2)-n)*o+s,(t-1-e)*r+r/2+s,0],[0,0,0],[i[0],i[1],i[2]+.1*e]);this.add(a)}return this}}var j=i(125);const D=i.p+"assets/images/6049f97796b7b1ad892adb3bafeb5b59.jpg",O="precision mediump float;\n#define GLSLIFY 1\n\nuniform vec3 uColor;\n\nvoid main() {\n  float d = distance(gl_PointCoord, vec2(0.5)) * 2.0;\n  float brightness = pow(clamp(1.0 - d, 0.0, 1.0), 2.0);\n\n  vec3 color = uColor * brightness;\n\n  gl_FragColor = vec4(color, brightness);\n}",U="#define GLSLIFY 1\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 modelMatrix;\n\nattribute vec3 aPosition;\n\nvoid main() {\n  gl_PointSize = 40.0;\n  gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(aPosition, 1.0);\n}",W="#define GLSLIFY 1\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 uRotation;\n\nattribute vec3 aPosition;\nattribute vec3 aColor;\nattribute vec3 normal;\n\nvarying vec3 vNormal;\n\nfloat transpose(float m) {\n  return m;\n}\n\nmat2 transpose(mat2 m) {\n  return mat2(m[0][0], m[1][0],\n              m[0][1], m[1][1]);\n}\n\nmat3 transpose(mat3 m) {\n  return mat3(m[0][0], m[1][0], m[2][0],\n              m[0][1], m[1][1], m[2][1],\n              m[0][2], m[1][2], m[2][2]);\n}\n\nmat4 transpose(mat4 m) {\n  return mat4(m[0][0], m[1][0], m[2][0], m[3][0],\n              m[0][1], m[1][1], m[2][1], m[3][1],\n              m[0][2], m[1][2], m[2][2], m[3][2],\n              m[0][3], m[1][3], m[2][3], m[3][3]);\n}\n\nfloat inverse(float m) {\n  return 1.0 / m;\n}\n\nmat2 inverse(mat2 m) {\n  return mat2(m[1][1],-m[0][1],\n             -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n}\n\nmat3 inverse(mat3 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n  float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n  float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n              b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n              b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nmat4 inverse(mat4 m) {\n  float\n      a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n      a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n      a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n      a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n      b00 = a00 * a11 - a01 * a10,\n      b01 = a00 * a12 - a02 * a10,\n      b02 = a00 * a13 - a03 * a10,\n      b03 = a01 * a12 - a02 * a11,\n      b04 = a01 * a13 - a03 * a11,\n      b05 = a02 * a13 - a03 * a12,\n      b06 = a20 * a31 - a21 * a30,\n      b07 = a20 * a32 - a22 * a30,\n      b08 = a20 * a33 - a23 * a30,\n      b09 = a21 * a32 - a22 * a31,\n      b10 = a21 * a33 - a23 * a31,\n      b11 = a22 * a33 - a23 * a32,\n\n      det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4(\n      a11 * b11 - a12 * b10 + a13 * b09,\n      a02 * b10 - a01 * b11 - a03 * b09,\n      a31 * b05 - a32 * b04 + a33 * b03,\n      a22 * b04 - a21 * b05 - a23 * b03,\n      a12 * b08 - a10 * b11 - a13 * b07,\n      a00 * b11 - a02 * b08 + a03 * b07,\n      a32 * b02 - a30 * b05 - a33 * b01,\n      a20 * b05 - a22 * b02 + a23 * b01,\n      a10 * b10 - a11 * b08 + a13 * b06,\n      a01 * b08 - a00 * b10 - a03 * b06,\n      a30 * b04 - a31 * b02 + a33 * b00,\n      a21 * b02 - a20 * b04 - a23 * b00,\n      a11 * b07 - a10 * b09 - a12 * b06,\n      a00 * b09 - a01 * b07 + a02 * b06,\n      a31 * b01 - a30 * b03 - a32 * b00,\n      a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n\nvoid main() {\n  vNormal = transpose(inverse(mat3(modelMatrix))) * normal;\n\n  gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(aPosition, 1.0);\n}",G="precision mediump float;\n#define GLSLIFY 1\n\nvarying vec3 vNormal;\n\nvoid main() {\n  vec3 normal = normalize(vNormal);\n  gl_FragColor = vec4(normal, 1.0);\n}";var H=new s;const K=new j.Vec3(0,1,0);var Y=new j.Vec3;const X=document.querySelector("#webgl"),Z=new class{constructor(t){null!==t?(t.width=window.innerWidth,t.height=window.innerHeight,this.gl=function(t,e){var i=n.setupWebGL(t);return i?((arguments.length<2||e)&&(i=o.makeDebugContext(i)),i):null}(t,!1,{alpha:!0,premultipliedAlpha:!0}),window.addEventListener("resize",(t=>{this.gl.canvas.width=t.target.innerWidth,this.gl.canvas.height=t.target.innerHeight,this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height)})),this.gl?(this.viewMatrixLocation=null,this.projectionMatrixLocation=null,this.resolutionLocation=null,this.lights={ambient:{intensity:null,color:null},point:{intensity:null,color:null,position:null,specularExponent:null},spot:{intensity:null,color:null,position:null,specularExponent:null,target:null,angle:null}},this.gl.clearColor(0,0,0,1),this.gl.enable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.BLEND),this.gl.enable(this.gl.CULL_FACE),this.gl.blendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.cullFace(this.gl.BACK),this.clear()):console.warn("Could not get the webGL context!")):console.warn("Could not find the canvas element!")}clear(){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}setClearColor(t,e,n,i){"object"==typeof t?this.gl.clearColor(t):this.gl.clearColor(t,e,n,i)}renderObject(t,e){if(0==t.depthTest&&this.gl.disable(this.gl.DEPTH_TEST),t.autoUpdateMatrix&&t.recalculateMatrix(),1==t.transparent?this.gl.depthMask(!1):this.gl.depthMask(!0),!1===t.visible)return void this.gl.enable(this.gl.DEPTH_TEST);t.program||(null!==t.vertexShader&&null!==t.fragmentShader?t.setShaderProgram(this.gl,t.vertexShader,t.fragmentShader):console.error("Could not compile shader for object:",t)),this.gl.useProgram(t.program),this.gl.program=t.program,t.uniforms.viewMatrix.value.set(e.viewMatrix.elements),t.uniforms.projectionMatrix.value.set(e.projectionMatrix.elements),t.uniforms.uResolution.value.set([this.gl.canvas.width,this.gl.canvas.height]);let n=this.gl.DYNAMIC_DRAW;var i=this.gl.TRIANGLES;switch(t.drawMode){case"static":n=this.gl.STATIC_DRAW;break;case"stream":n=this.gl.STREAM_DRAW;break;default:n=this.gl.DYNAMIC_DRAW}switch(t.drawType){case"triangles":i=this.gl.TRIANGLES;break;case"triangle_fan":i=this.gl.TRIANGLE_FAN;break;case"triangle_strip":i=this.gl.TRIANGLE_STRIP;break;case"lines":i=this.gl.LINES;break;case"lines_strip":i=this.gl.LINE_STRIP;break;case"lines_loop":i=this.gl.LINE_LOOP;break;default:i=this.gl.POINTS}for(let e of t.attributes){null===e.buffer&&(e.buffer=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,e.value,n),null===e.location&&(e.location=this.gl.getAttribLocation(this.gl.program,e.name));const t=e.location;-1!==t&&(this.gl.vertexAttribPointer(t,e.countPerVertex,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(t))}const o=t.uniforms;for(let n in o){null===o[n].location&&(o[n].location=this.gl.getUniformLocation(this.gl.program,n)),"uAmbientIntensity"===n&&null!==this.lights.ambient.intensity&&(o[n].value[0]=this.lights.ambient.intensity),"uAmbientColor"===n&&null!==this.lights.ambient.color&&(o[n].value=this.lights.ambient.color),"uPointLightIntensity"===n&&null!==this.lights.point.intensity&&(o[n].value[0]=this.lights.point.intensity),"uPointLightColor"===n&&null!==this.lights.point.color&&(o[n].value=this.lights.point.color),"uPointLightPos"===n&&null!==this.lights.point.position&&(o[n].value=this.lights.point.position),"uSpecularExponent"===n&&null!==this.lights.point.specularExponent&&(o[n].value[0]=this.lights.point.specularExponent),"uSpotLightIntensity"===n&&null!==this.lights.spot.intensity&&(o[n].value[0]=this.lights.spot.intensity),"uSpotLightColor"===n&&null!==this.lights.spot.color&&(o[n].value=this.lights.spot.color),"uSpotLightPos"===n&&null!==this.lights.spot.position&&(o[n].value=this.lights.spot.position),"uSpotSpecularExponent"===n&&null!==this.lights.spot.specularExponent&&(o[n].value[0]=this.lights.spot.specularExponent),"uSpotLightAngle"===n&&null!==this.lights.spot.angle&&(o[n].value[0]=this.lights.spot.angle*Math.PI/180),"uSpotLightTarget"===n&&null!==this.lights.spot.target&&(o[n].value=this.lights.spot.target),"uCamPos"===n&&(o[n].value=e.position.elements);let i=o[n].location;switch(o[n].type){case"float":this.gl.uniform1f(i,...o[n].value);break;case"vec2":this.gl.uniform2f(i,...o[n].value);break;case"vec3":this.gl.uniform3f(i,...o[n].value);break;case"vec4":this.gl.uniform4f(i,...o[n].value);break;case"mat3":this.gl.uniformMatrix3fv(i,!1,o[n].value);break;case"mat4":this.gl.uniformMatrix4fv(i,!1,o[n].value);break;case"int":"uTexture"===n&&(this.gl.bindTexture(this.gl.TEXTURE_2D,t.texture),this.gl.activeTexture(this.gl.TEXTURE0)),this.gl.uniform1i(i,...o[n].value);break;default:console.warn(`There was an error in the typing of your uniform ${n}`)}}null!==t.indices&&(null===t.indexBuffer&&(t.indexBuffer=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,t.indexBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,t.indices,this.gl.DYNAMIC_DRAW),this.gl.drawElements(i,t.indices.length,this.gl.UNSIGNED_SHORT,0)),this.gl.enable(this.gl.DEPTH_TEST)}render(t,e){this.clear();let n=[],i=[],o=[];t.traverse((t=>{"ambient light"===t.type&&(this.lights.ambient.intensity=t.intensity,this.lights.ambient.color=t.uniforms.uColor.value),"point light"===t.type&&(this.lights.point.intensity=t.intensity,this.lights.point.color=t.uniforms.uColor.value,this.lights.point.position=t.position.elements,this.lights.point.specularExponent=t.specularExponent),"spot light"===t.type&&(this.lights.spot.intensity=t.intensity,this.lights.spot.color=t.uniforms.uColor.value,this.lights.spot.position=t.position.elements,this.lights.spot.specularExponent=t.specularExponent,this.lights.spot.target=t.target,this.lights.spot.angle=t.cutoffAngle),0!=t.depthTest?1!=t.transparent?i.push(t):o.push(t):n.push(t)}));for(let t of n)this.renderObject(t,e);for(let t of i)this.renderObject(t,e);for(let t of o)this.renderObject(t,e)}}(X);Z.setClearColor(.0588,.0314,.1059,1);const $=new class extends m{constructor(t=[0,0,0],e=[0,0,0],n=60,i=.01,o=100,r=[0,0,0]){super(t,r),window.addEventListener("resize",(t=>{this.aspect=t.target.innerWidth/t.target.innerHeight,this.calculateViewProjection()})),this.type="camera",this.aspect=window.innerWidth/window.innerHeight,this.fov=n,this.near=i,this.far=o,this.lastRotation=new s(r),this.viewMatrix=new l,this.projectionMatrix=new l,this.target=new s(e),this.calculateViewProjection()}calculateViewProjection(){this.viewMatrix.setLookAt(...this.position.elements,...this.target.elements,...this.up.elements),this.projectionMatrix.setPerspective(this.fov,this.aspect,this.near,this.far)}setRotation(t,e,n){super.setRotation(t,e,n),A.set(this.target),A.sub(this.position);let i=A.magnitude(),o=Math.acos(A.elements[1]/i),r=Math.atan2(A.elements[2],A.elements[0]);A.set(this.lastRotation),A.sub(this.rotation);let s=A.elements;o+=s[0]*Math.PI/180,r+=s[1]*Math.PI/180;const a=i*Math.cos(r)*Math.sin(o),l=i*Math.cos(o),c=i*Math.sin(r)*Math.sin(o);A.set([a,l,c]),this.target.set(this.position),this.target.add(A),this.lastRotation.set(this.rotation),this.calculateViewProjection()}setPosition(t,e,n){super.setPosition(t,e,n),this.calculateViewProjection()}}([0,2,0],[0,1.5,4]),Q=new class extends m{constructor(t=[0,0,0],e=[0,0,1],n=15,i=[1,1,1],o=1,r=30){return super(t),this.type="spot light",this.drawType="points",this.vertexShader=U,this.fragmentShader=O,this.setColor(i),this.intensity=o,this.specularExponent=r,this.cutoffAngle=n,this.target=e,this.attributes.push(new d(new Float32Array(t),3,"aPosition")),this.indices=new Uint16Array([0]),this}}([0,2,-3]);Q.setColor(.1,.2,.75),Q.visible=!0;const J=new class extends m{constructor(t=[1,1,1],e=1){return super(),this.type="ambient light",this.setColor(t),this.intensity=e,this}};J.intensity=.5;const tt=new class extends m{constructor(t=[0,0,0],e=[1,1,1],n=1,i=30){return super(t),this.type="point light",this.drawType="points",this.transparent=!0,this.setColor(e),this.intensity=n,this.specularExponent=i,this.vertexShader=U,this.fragmentShader=O,this.attributes.push(new d(new Float32Array(t),3,"aPosition")),this.indices=new Uint16Array([0]),this}}([5,8,5]);tt.setColor(1,.7765,.7765),tt.visible=!0;const et=new class extends m{constructor(t,e){super(t,e,[1,1,1]),this.type="scene",this.autoUpdateMatrix=!0,this.visible=!1}},nt=[];for(let t=0;t<6;t++){let t=8*Math.random()+4;Math.random()>.5&&(t*=-1);let e=8*Math.random()+4;Math.random()>.5&&(e*=-1);let n=new N(Math.floor(3*Math.random()+3),[t,0,e],[0,90*Math.random(),0]);nt.push(n),et.add(n)}const it=new class extends m{constructor(t,e,n,i=[0,0,0],o=[0,0,0],r=[1,1,1]){super(i,o,r),this.visible=!0,e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));let a=0;const l=[],c=new s,p=new s,h=[],u=[],v=[],m=[];for(let i=0;i<=n;i++){const o=[],r=i/n;let s=0;0==i?s=.5/e:i==n&&(s=-.5/e);for(let n=0;n<=e;n++){const i=n/e;c.elements[0]=-t*Math.cos(i*Math.PI*2)*Math.sin(r*Math.PI),c.elements[1]=t*Math.cos(r*Math.PI),c.elements[2]=t*Math.sin(i*Math.PI*2)*Math.sin(r*Math.PI),u.push(...c.elements),p.set(c).normalize(),v.push(...p.elements),m.push(i+s,1-r),o.push(a++)}l.push(o)}for(let t=0;t<n;t++)for(let i=0;i<e;i++){const e=l[t][i+1],o=l[t][i],r=l[t+1][i],s=l[t+1][i+1];0!==t&&h.push(e,o,s),t!==n-1&&h.push(o,r,s)}this.attributes.push(new d(new Float32Array(u),3,"aPosition")),this.attributes.push(new d(new Float32Array(m),2,"uv")),this.attributes.push(new d(new Float32Array(v),3,"normal")),this.indices=new Uint16Array(h)}}(1,20,20);it.setPosition(0,1.5,4),it.setColor(.5,.5,.5),et.add([_,Q,tt,J,it]);const ot=new j.World;ot.gravity.set(0,-9.82,0);const rt=new j.Material("rock"),st=new j.Material("sand"),at=new j.ContactMaterial(rt,st,{friction:.8,restitution:.01}),lt=new j.ContactMaterial(rt,rt,{friction:1,restitution:0});ot.addContactMaterial(at),ot.addContactMaterial(lt);const ct=new j.Body({mass:0,position:new j.Vec3(0,0,0),material:st}),pt=new j.Plane;ct.quaternion.setFromAxisAngle(new j.Vec3(-1,0,0),.5*Math.PI);const ht=new j.Body({mass:0,position:new j.Vec3(0,2,-3),material:rt}),ut=new j.Box(new j.Vec3(.5,3.5,1));ht.addShape(ut),ct.addShape(pt),ot.addBody(ct),ot.addBody(ht);for(let t of nt)for(let e of t.children){let[t,n,i]=e.getScale(),[o,r,s]=e.getWorldPosition();e.userData.body=new j.Body({mass:1,position:new j.Vec3(o,r,s),material:rt}),e.userData.shape=new j.Box(new j.Vec3(t/2,n/2,i/2)),e.userData.body.addShape(e.userData.shape),ot.addBody(e.userData.body)}const dt=new class{constructor(t=0){this.stats=new(L()),this.stats.showPanel(t),document.body.appendChild(this.stats.dom),this.begin=this.stats.begin,this.end=this.stats.end}}(0),vt=new k.Pane({title:"Config"}),mt={rotation:{x:0,y:0,z:0},normals:!1},gt={color:{r:127.5,g:127.5,b:127.5},position:{x:0,y:1.5,z:4}},ft={color:{r:255,g:255,b:255},intensity:.5,on:!0},xt={color:{r:255,g:198,b:198},position:{x:0,y:0,z:0},intensity:1,specularExponent:30,on:!0,autoRotate:!0},bt={color:{r:25.1,g:55,b:191.25},target:{x:0,y:0,z:0},position:{x:0,y:2,z:-3},intensity:1,angle:15,on:!0},wt={ambient:{r:255,g:255,b:255},point:{r:255,g:198,b:198},spot:{r:25.1,g:55,b:191.25},autoRotate:!0},yt=vt.addFolder({title:"Scene",expanded:!1}),_t=vt.addFolder({title:"Sphere",expanded:!1}),Pt=vt.addFolder({title:"Lights",expanded:!1}),Ct=Pt.addFolder({title:"Ambient Light",expanded:!1}),zt=Pt.addFolder({title:"Point Light",expanded:!1}),Et=Pt.addFolder({title:"Spot Light",expanded:!1});yt.addInput(mt,"rotation").on("change",(t=>{let{x:e,y:n,z:i}=t.value;et.setRotation(e,n,i)})),yt.addInput(mt,"normals").on("change",(t=>{if(t.value){for(let t of nt)for(let e of t.children)e.setShaderProgram(Z.gl,W,G);it.setShaderProgram(Z.gl,W,G),_.floor.setShaderProgram(Z.gl,W,G)}else{for(let t of nt)for(let e of t.children)e.setShaderProgram(Z.gl,T,I);it.program=null,_.floor.setShaderProgram(Z.gl,f,x)}})),_t.addInput(gt,"position").on("change",(t=>{let{x:e,y:n,z:i}=t.value;it.setPosition(e,n,i)})),_t.addInput(gt,"color").on("change",(t=>{let{r:e,g:n,b:i}=t.value;it.setColor(e/255,n/255,i/255)})),Ct.addInput(ft,"color").on("change",(t=>{let{r:e,g:n,b:i}=t.value;wt.ambient={r:e/255,g:n/255,b:i/255},ft.on&&J.setColor(e/255,n/255,i/255)})),Ct.addInput(ft,"intensity").on("change",(t=>{J.intensity=t.value})),Ct.addInput(ft,"on").on("change",(t=>{if(t.value){let{r:t,g:e,b:n}=wt.ambient;J.setColor(t,e,n)}else J.setColor(0,0,0)})),zt.addInput(xt,"color").on("change",(t=>{let{r:e,g:n,b:i}=t.value;wt.point={r:e/255,g:n/255,b:i/255},xt.on&&tt.setColor(e/255,n/255,i/255)}));let St=zt.addInput(bt,"position",{hidden:!0}).on("change",(t=>{let{x:e,y:n,z:i}=t.value;tt.setPosition(e,n,i)}));zt.addInput(xt,"intensity").on("change",(t=>{tt.intensity=t.value})),zt.addInput(xt,"specularExponent").on("change",(t=>{tt.specularExponent=t.value})),zt.addInput(xt,"autoRotate").on("change",(t=>{t.value?(St.hidden=!0,wt.autoRotate=!0):(St.hidden=!1,wt.autoRotate=!1)})),zt.addInput(xt,"on").on("change",(t=>{if(t.value){let{r:t,g:e,b:n}=wt.point;tt.setColor(t,e,n)}else tt.setColor(0,0,0)})),Et.addInput(bt,"color").on("change",(t=>{let{r:e,g:n,b:i}=t.value;wt.spot={r:e/255,g:n/255,b:i/255},bt.on&&Q.setColor(e/255,n/255,i/255)})),Et.addInput(bt,"target").on("change",(t=>{let{x:e,y:n,z:i}=t.value;Q.target=[e,n,i]})),Et.addInput(bt,"position").on("change",(t=>{let{x:e,y:n,z:i}=t.value;Q.setPosition(e,n,i)})),Et.addInput(bt,"intensity").on("change",(t=>{Q.intensity=t.value})),Et.addInput(bt,"angle").on("change",(t=>{Q.cutoffAngle=t.value})),Et.addInput(bt,"on").on("change",(t=>{if(t.value){let{r:t,g:e,b:n}=wt.spot;Q.setColor(t,e,n)}else Q.setColor(0,0,0)}));const At=new class extends class{constructor(t,e,n,i=!1){if(t&&e)return this.canvas=e,this.camera=t,this.camBody=n,this.state={locked:!1,left:!1,right:!1,up:!1,down:!1,lookLeft:!1,lookRight:!1,moveY:i},e.onpointerdown=t=>{0==t.button&&e.requestPointerLock({unadjustedMovement:!0})},document.onpointerlockchange=t=>{document.pointerLockElement===e?this.state.locked=!0:this.state.locked=!1},document.onkeydown=t=>{if(this.state.locked)switch(t.key){case"a":this.state.left=!0;break;case"s":this.state.down=!0;break;case"w":this.state.up=!0;break;case"d":this.state.right=!0;break;case"q":this.state.lookLeft=!0;break;case"e":this.state.lookRight=!0}},document.onkeyup=t=>{if(this.state.locked)switch(t.key){case"a":this.state.left=!1;break;case"s":this.state.down=!1;break;case"w":this.state.up=!1;break;case"d":this.state.right=!1;break;case"q":this.state.lookLeft=!1;break;case"e":this.state.lookRight=!1}},e.onpointermove=e=>{if(this.state.locked){const[n,i,o]=t.getRotation();let r=.06*e.movementX,s=.06*e.movementY;t.setRotation(n-s,i-r,o)}},this;console.error("Camera constructor arguments are null")}getLock=()=>{0==e.button&&this.canvas.requestPointerLock({unadjustedMovement:!0})};update(){if(this.state.left){const[t,e,n]=this.camera.getPosition();V.set(this.camera.target);let i=V.sub(this.camera.position).normalize(),o=s.cross(i,this.camera.up).div(-13);V.set([t,e,n]).add(o),this.camera.target.add(o),this.camera.setPosition(V)}if(this.state.right){const[t,e,n]=this.camera.getPosition();V.set(this.camera.target);let i=V.sub(this.camera.position).normalize(),o=s.cross(i,this.camera.up).div(13);V.set([t,e,n]).add(o),this.camera.target.add(o),this.camera.setPosition(V)}if(this.state.up){const[t,e,n]=this.camera.getPosition();V.set(this.camera.target);let i=V.sub(this.camera.position);this.state.moveY||(i.elements[1]=0),i.normalize(),B.set(i);let o=B.div(13);V.set([t,e,n]).add(o),this.camera.target.add(o),this.camera.setPosition(V)}if(this.state.down){const[t,e,n]=this.camera.getPosition();V.set(this.camera.target);let i=V.sub(this.camera.position);this.state.moveY||(i.elements[1]=0),i.normalize(),B.set(i);let o=B.div(-13);V.set([t,e,n]).add(o),this.camera.target.add(o),this.camera.setPosition(V)}if(this.state.lookLeft){const[t,e,n]=this.camera.getRotation();let i=-.75;this.camera.setRotation(t,e-i,n)}if(this.state.lookRight){const[t,e,n]=this.camera.getRotation();let i=.75;this.camera.setRotation(t,e-i,n)}}}{constructor(t,e,n,i){return super(t,e,i,!1),this.world=n,this}update=()=>{super.update();let[,t]=this.world.getPosition(),[e,n,i]=this.camera.getPosition();this.world.setPosition([e,t,i]);for(let t of this.world.children)t.uniforms.uCameraPos||(t.uniforms.uCameraPos=new v(this.camera.getPosition(),3,"vec3")),t.uniforms.uCameraPos.value=this.camera.getPosition()}}($,Z.gl.canvas,_,ht),Mt={time:Date.now(),delta:0},Lt=()=>{dt.begin(),Mt.delta=Date.now()-Mt.time,Mt.time=Date.now(),wt.autoRotate&&tt.setPosition(10*Math.cos(5e-4*Mt.time),3,10*Math.sin(5e-4*Mt.time));for(let t of _.children)t.uniforms.uTime.value[0]+=.05*Mt.delta;ot.step(1/60,Mt.delta/1e3,3),ht.position.set(...$.getPosition());let[,t]=$.getRotation();ht.quaternion.setFromAxisAngle(K,t%360*Math.PI/180);for(let t of nt)for(let e of t.children){H.set(e.userData.body.position.toArray()).sub(e.parent.position),e.setPosition(...H.elements),e.userData.body.quaternion.toEuler(Y);let[t,n,i]=Y.toArray();e.setRotation(180*t/Math.PI,180*n/Math.PI,180*i/Math.PI),e.uniforms.uCamPos.value=$.getPosition()}At.update(),Z.render(et,$),dt.end(),requestAnimationFrame(Lt)};((t,e,n)=>{const i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i);const o=new Uint8Array([30,30,30,255]);t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,o);const r=new Image;r.onload=function(){t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let t of n)for(let e of t.children)e.uniforms.uTexture=new v([0],1,"int"),e.image=r,e.texture=i;Lt()},r.src=e})(Z.gl,D,nt)})()})();